<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.beyondunreal.com/Legacy:Quaternion by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 07:56:06 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>Legacy:Quaternion - Unreal Wiki</title>
<meta name="generator" content="MediaWiki 1.25.1" />
<link rel="alternate" type="application/x-wiki" title="Edit" href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion" />
<link rel="edit" title="Edit" href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion" />
<link rel="shortcut icon" href="w/uewiki-favicon.png" />
<link rel="search" type="application/opensearchdescription+xml" href="w/opensearch_desc.php" title="Unreal Wiki" />
<link rel="EditURI" type="application/rsd+xml" href="w/api251f.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Legacy_Quaternion.html" />
<link rel="copyright" href="Unreal_Wiki_Copyrights.html" />
<link rel="alternate" type="application/atom+xml" title="Unreal Wiki Atom feed" href="https://wiki.beyondunreal.com/Special:RecentChanges?feed=atom" />
<link rel="stylesheet" href="w/load2743.css?debug=false&amp;lang=en&amp;modules=ext.geshi.language.uscript%7Cmediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if IE 6]><link rel="stylesheet" href="/w/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/w/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="w/load484a.css?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=monobook&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: wiki:resourceloader:filter:minify-css:7:29b70323345a439ab9ed7007e0c178a6 */</style>
<script src="w/load9316.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"Legacy","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":100,"wgPageName":"Legacy:Quaternion","wgTitle":"Quaternion","wgCurRevisionId":46325,"wgRevisionId":46325,"wgArticleId":2568,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Legacy:Quaternion","wgRelevantArticleId":2568,"wgIsProbablyEditable":true,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgCategoryTreePageCategoryOptions":"{\"mode\":0,\"hideprefix\":20,\"showcount\":true,\"namespaces\":false}"});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: wiki:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-100 ns-subject page-Legacy_Quaternion skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
									<div id="siteNotice"><div id="localNotice" lang="en" dir="ltr"><p>Always snap to grid
</p></div></div>
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Legacy:Quaternion</h1>

				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Unreal Wiki, The Unreal Engine Documentation Site</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>Quaternions are a mathematical construct that represents a rotation in three dimensions. It is not as intuitive as the Euler angles that are used for most of the rotation within Unrealscript. A <a href="Legacy_Rotator.html" title="Legacy:Rotator">rotator</a>, is a rotation using Euler angles and is the "standard" type of rotation within Unrealscript. <a href="Legacy_UT2003.html" title="Legacy:UT2003" class="mw-redirect">UT2003</a> has native support for Quaternions, though through custom scripts you can use <a href="Legacy_Quaternions_In_Unreal_Tournament.html" title="Legacy:Quaternions In Unreal Tournament">quaternions in Unreal Tournament</a> too.</p>
<p></p>
<div id="toc" class="toc">
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#How_they_work"><span class="tocnumber">1</span> <span class="toctext">How they work</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#The_Practical_Way"><span class="tocnumber">1.1</span> <span class="toctext">The Practical Way</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#The_Technical_Way"><span class="tocnumber">1.2</span> <span class="toctext">The Technical Way</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Built-In_Quaternion_Functions"><span class="tocnumber">2</span> <span class="toctext">Built-In Quaternion Functions</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Other_Useful_Functions"><span class="tocnumber">3</span> <span class="toctext">Other Useful Functions</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#Identity_Quaternion"><span class="tocnumber">3.1</span> <span class="toctext">Identity Quaternion</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Converting_a_Rotator_to_a_Quaternion"><span class="tocnumber">3.2</span> <span class="toctext">Converting a Rotator to a Quaternion</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Converting_Quaternion_to_a_Rotator"><span class="tocnumber">3.3</span> <span class="toctext">Converting Quaternion to a Rotator</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Normalizing_a_Quaternion"><span class="tocnumber">3.4</span> <span class="toctext">Normalizing a Quaternion</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Slerp_Between_Quaternions"><span class="tocnumber">3.5</span> <span class="toctext">Slerp Between Quaternions</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#Discussion"><span class="tocnumber">4</span> <span class="toctext">Discussion</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="#Related_Topics"><span class="tocnumber">5</span> <span class="toctext">Related Topics</span></a></li>
<li class="toclevel-1 tocsection-13"><a href="#Related_Links"><span class="tocnumber">6</span> <span class="toctext">Related Links</span></a></li>
</ul>
</div>
<p></p>
<h2><span class="mw-headline" id="How_they_work">How they work</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=1" title="Edit section: How they work">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>There are two ways to explain a quaternion: the technical way and the practical way. I much prefer the practical way for purposes of Unrealscript because the mathematical expression of a quaternion is for most purposes irrelevant within Unrealscript.</p>
<h3><span class="mw-headline" id="The_Practical_Way">The Practical Way</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=2" title="Edit section: The Practical Way">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This explanation assumes you have a working knowledge of <a href="Legacy_Rotator.html" title="Legacy:Rotator">rotators</a> and <a href="Legacy_Vector.html" title="Legacy:Vector">vectors</a>. As you know, you can cast a rotator to a vector or vice versa. Because a vector has a direction, it can be used store the facing of an object. However, a vector stores only the actual facing of the object, and not the complete rotation of the object. A vector-based "rotation" always has roll set to 0 for all intents and purposes. Technically, it does not have a roll component but it will gain a roll of 0 when cast back into a rotator. Vectors, however, have an advantage over rotators - they never suffer from "gimbal lock." To experience Gimbal Lock you can simply look straight up or down inside the game and note that your rotation is halted when you are looking directly up or directly down. Vector rotation does not suffer from this, but it lacks the roll component, which sometimes you want to retain. This is where a quaternion can be useful. A quaternion is basically a vector with a roll component tacked on. The rotation of an object defined by a quaternion is the facing as defined by the vector, rolled by the roll component of the quaternion. This is best demonstrated with a picture:</p>
<div class="center">
<div class="floatnone"><a href="File_Legacy_Quaternion.html" class="image"><img alt="Legacy Quaternion.png" src="w/images/Legacy_Quaternion.png" width="76" height="86" /></a></div>
</div>
<h3><span class="mw-headline" id="The_Technical_Way">The Technical Way</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=3" title="Edit section: The Technical Way">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Quaternions encode spatial rotations by four real numbers (or two complex numbers), whereas the linear representation of these transformations as 3x3 matrices requires nine. Interpolating the quaternionic representation of a sequence of rotations is more natural than doing so for the familiar Euler angles, such as yaw, pitch, and roll. The quaternions occupy a smooth, seamless, isotropic space which is a generalization of the surface of a sphere. Thus, there is no need for special care to avoid singularities, such as gimbal lock.</p>
<p>A quaternion is like a <a href="http://en.wikipedia.org/wiki/complex_number" class="extiw" title="wikipedia:complex number">Wikipedia:complex number</a> ( x + iy ), but extended some more, to x + iy + jz + kw. Similarly to complex numbers, i<sup>2</sup> = j<sup>2</sup> = k<sup>2</sup> = ijk = -1. Note the xyzw might be in different places: some writers use w for the real part; some writers treat the ijk part as a vector and consider the quaternion to be essentially (scalar, vector).</p>
<p>So what does this have to do with the 3D world? Well, a rotation has 4 numbers too: 3 give the axis of rotation as a vector, and the 4th gives how far you rotate, as an angle.</p>
<p>It turns out that when you multiply two quaternions, the product represents the rotation obtained by combining the two original rotations the two original quaternions represented.</p>
<h2><span class="mw-headline" id="Built-In_Quaternion_Functions">Built-In Quaternion Functions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=4" title="Edit section: Built-In Quaternion Functions">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<dl>
<dt>Quat QuatProduct (Quat A, Quat B) [static]&#160;</dt>
<dd>Multiplies two Quaternions together. Interestingly enough, this will return a Quaternion representing the addition of the two rotations that the original Quaternions represented. So, for example you had one quaternion representing Yaw 0, Pitch 0, Roll 90 degrees, and a quaternion representing Yaw 90 degrees, Pitch 0, and Roll 0, you will end up with Yaw 90 degrees, Pitch 0, and Roll 90 degrees. Though this is a simple example that would not be hard to do without using quaternions, it could be more complicated if both angles were jutting out at arbitrary angles unknown at compile time. Note that multiplication of quaternions is not commutative. To apply a rotation A followed by a rotation B, use the result of QuatProduct(B, A).</dd>
</dl>
<dl>
<dt>Quat QuatInvert (Quat A) [static]&#160;</dt>
<dd>Inverts a Quaternion. The restlt will be facing the opposite direction and be rolled the opposite direction about it's axis.</dd>
<dt>vector QuatRotateVector (Quat A, vector B) [static]&#160;</dt>
<dd>Rotates the given vector around the axis specified by the Quaternion, by the amount specified by the quaternion.</dd>
<dt>Quat QuatFindBetween (Vector A, Vector B) [static]&#160;</dt>
<dd>If vector A and vector B both have lengths of 1, this will return a quaternion representing a rotation that can turn the first vector into the second. So, for instance, QuatRotateVector( QuatFindBetween( A, B ), A ) would return B.</dd>
<dt>Quat QuatFromAxisAndAngle (Vector Axis, Float Angle) [static]&#160;</dt>
<dd>Allows you to manually specify a quaternion by providing the axis (aka the facing of the quaternion) as a vector and the "roll" of that axis. (aka facing) Because Quaternions use radians for their "roll," I believe that the angle must be specified in radians.</dd>
</dl>
<p><b>Shambler:</b> N.B. QuatFindBetween seems to have a bug with inverted input vectors, QuatFindBetween(vect(-1,0,0), vect(1,0,0)) will return a quaternion with absoloutly no rotational info.</p>
<h2><span class="mw-headline" id="Other_Useful_Functions">Other Useful Functions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=5" title="Edit section: Other Useful Functions">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Identity_Quaternion">Identity Quaternion</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=6" title="Edit section: Identity Quaternion">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>An identity quaternion is just like an identity matrix in that multiplication with it produces an ouput equal to the input.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">static</span> <span class="kw1">final</span> <span class="kw1">function</span> <span class="kw5">quat</span> QuatIdentity<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw1">local</span> <span class="kw5">quat</span> result;
	result.<span class="me0">x</span> <span class="sy0">=</span> <span class="nu0">0</span>;
	result.<span class="me0">y</span> <span class="sy0">=</span> <span class="nu0">0</span>;
	result.<span class="me0">z</span> <span class="sy0">=</span> <span class="nu0">0</span>;
	result.<span class="me0">w</span> <span class="sy0">=</span> <span class="nu0">1</span>;
	<span class="kw2">return</span> result;
<span class="br0">}</span>
</pre></div>
</div>
<p><b>Foxpaw:</b> No offense, but what is the point of this function? Why would one need an identity quaternion?</p>
<p><b>Mychaeel:</b> That's a bit like asking "What does one need the number 1 for?" &#160;:-)</p>
<p><b>Pingz:</b> It's like setting a float to 1 so that anything multiplyed with it returns itself insted of zero. Just like an identity matrix. Saying q = QuatIdentity(); was much nicer than putting all that junk inline.</p>
<p><b>Foxpaw:</b> Yeah, but what is the point of multiplying something by 1? The 1 is err. something about "tacit rules of a number." Anyways.. if something is multiplied by 1, then the result will always be the same as the other operand, so why bother? Wouldn't it be better to save the cycles and just remove the expression entirely?</p>
<p><b>Tarquin:</b> You might want to check if something is <i>equal</i> to the identity.</p>
<p><b>Mychaeel:</b> Foxpaw, stop a minute to <i>think</i>. Is multiplying a variable with the unity value <i>constant</i> really the only thing that comes into your mind?</p>
<p><b>Dirk Fist:</b> It can be used as a place holder, in a chain for a missing componnent</p>
<p><b>Searcher:</b> Foxpaw, I came to this page searching for an identity quaternion - because I needed to reset the orientation of an object via a function that took a quaternion as an argument.</p>
<h3><span class="mw-headline" id="Converting_a_Rotator_to_a_Quaternion">Converting a Rotator to a Quaternion</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=7" title="Edit section: Converting a Rotator to a Quaternion">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This function converts the specified rotation into a quaternion representing that rotation.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">const</span> URotToRadian<span class="sy0">=</span><span class="nu0">0.000095873799</span>;
 
<span class="kw1">static</span> <span class="kw1">final</span> postoperator <span class="kw5">float</span> URotations<span class="br0">(</span> <span class="kw5">float</span> URots <span class="br0">)</span>
<span class="br0">{</span> <span class="kw2">return</span> URots <span class="sy0">*</span> URottoRadian; <span class="br0">}</span>
 
<span class="kw1">static</span> <span class="kw1">function</span> <span class="kw5">Quat</span> RotToQuat<span class="br0">(</span> <span class="kw5">rotator</span> <span class="kw3">Rot</span> <span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">Quat</span> X, Y, Z;
 
  X <span class="sy0">=</span> <span class="kw3">QuatFromAxisAndAngle</span><span class="br0">(</span> <span class="kw3">Vect</span><span class="br0">(</span><span class="nu0">1</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span>, <span class="kw3">Rot</span>.<span class="me0">Roll</span> URotations <span class="br0">)</span>;
  Y <span class="sy0">=</span> <span class="kw3">QuatFromAxisAndAngle</span><span class="br0">(</span> <span class="kw3">Vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">1</span>,<span class="nu0">0</span><span class="br0">)</span>, <span class="kw3">Rot</span>.<span class="me0">Pitch</span> URotations <span class="br0">)</span>;
  Z <span class="sy0">=</span> <span class="kw3">QuatFromAxisAndAngle</span><span class="br0">(</span> <span class="kw3">Vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">1</span><span class="br0">)</span>, <span class="kw3">Rot</span>.<span class="me0">Yaw</span> URotations <span class="br0">)</span>;
 
  X <span class="sy0">=</span> <span class="kw3">QuatProduct</span><span class="br0">(</span> X, Y <span class="br0">)</span>;
  X <span class="sy0">=</span> <span class="kw3">QuatProduct</span><span class="br0">(</span> X, Z <span class="br0">)</span>;
 
  <span class="kw2">return</span> X;
<span class="br0">}</span>
</pre></div>
</div>
<h3><span class="mw-headline" id="Converting_Quaternion_to_a_Rotator">Converting Quaternion to a Rotator</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=8" title="Edit section: Converting Quaternion to a Rotator">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Returns a normalized rotator from the input quaternion.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="co1">// 65535 / 2PI</span>
<span class="kw1">const</span> RADIANS_TO_UU <span class="sy0">=</span> 10430.21919552736082f;
 
<span class="co1">// 65535 / 4</span>
<span class="kw1">const</span> UU_90_DEGREES <span class="sy0">=</span> 16383.75f;
 
<span class="kw1">static</span> <span class="kw1">final</span> <span class="kw1">function</span> <span class="kw5">Rotator</span> <span class="kw3">QuatToRotator</span><span class="br0">(</span> <span class="kw5">quat</span> Q <span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw1">local</span> <span class="kw5">float</span> x, y, z, w, s;
	<span class="kw1">local</span> <span class="kw5">rotator</span> result;
 
	x <span class="sy0">=</span> Q.<span class="me0">x</span>;
	y <span class="sy0">=</span> Q.<span class="me0">y</span>;
	z <span class="sy0">=</span> Q.<span class="me0">z</span>;
	w <span class="sy0">=</span> Q.<span class="me0">w</span>;
	s <span class="sy0">=</span> 2.0f <span class="sy0">*</span> <span class="br0">(</span> w <span class="sy0">*</span> y <span class="sy0">-</span> x <span class="sy0">*</span> z <span class="br0">)</span>;
 
	<span class="co1">// It is invalid to pass values outside</span>
	<span class="co1">// of the range -1,1 to asin()... so don't.</span>
	<span class="kw2">if</span> <span class="br0">(</span> s <span class="sy0">&lt;</span> 1.0f <span class="br0">)</span> <span class="br0">{</span>
 
		<span class="kw2">if</span> <span class="br0">(</span> <span class="sy0">-</span>1.0f <span class="sy0">&lt;</span> s <span class="br0">)</span> <span class="br0">{</span>
 
			result.<span class="me0">yaw</span>		<span class="sy0">=</span> <span class="kw3">atan</span><span class="br0">(</span> 2.0f<span class="sy0">*</span><span class="br0">(</span>x<span class="sy0">*</span>y<span class="sy0">+</span>w<span class="sy0">*</span>z<span class="br0">)</span>, 1.0f<span class="sy0">-</span>2.0f<span class="sy0">*</span><span class="br0">(</span>y<span class="sy0">*</span>y<span class="sy0">+</span>z<span class="sy0">*</span>z<span class="br0">)</span> <span class="br0">)</span> <span class="sy0">*</span> RADIANS_TO_UU;
			result.<span class="me0">pitch</span>	<span class="sy0">=</span> <span class="kw3">asin</span><span class="br0">(</span> s <span class="br0">)</span> <span class="sy0">*</span> RADIANS_TO_UU;
			result.<span class="me0">roll</span>		<span class="sy0">=</span> <span class="kw3">atan</span><span class="br0">(</span> 2.0f<span class="sy0">*</span><span class="br0">(</span>y<span class="sy0">*</span>z<span class="sy0">+</span>w<span class="sy0">*</span>x<span class="br0">)</span>, 1.0f<span class="sy0">-</span>2.0f<span class="sy0">*</span><span class="br0">(</span>x<span class="sy0">*</span>x<span class="sy0">+</span>y<span class="sy0">*</span>y<span class="br0">)</span> <span class="br0">)</span> <span class="sy0">*</span> RADIANS_TO_UU;
 
		<span class="br0">}</span> <span class="kw2">else</span> <span class="br0">{</span>
 
			result.<span class="me0">yaw</span>		<span class="sy0">=</span> <span class="nu0">0</span>;
			result.<span class="me0">pitch</span>	<span class="sy0">=</span> <span class="sy0">-</span>UU_90_DEGREES;
			result.<span class="me0">roll</span>		<span class="sy0">=</span> <span class="sy0">-</span><span class="kw3">atan</span><span class="br0">(</span> 2.0f<span class="sy0">*</span><span class="br0">(</span>x<span class="sy0">*</span>y<span class="sy0">-</span>w<span class="sy0">*</span>z<span class="br0">)</span>, 1.0f<span class="sy0">-</span>2.0f<span class="sy0">*</span><span class="br0">(</span>x<span class="sy0">*</span>x<span class="sy0">+</span>z<span class="sy0">*</span>z<span class="br0">)</span> <span class="br0">)</span> <span class="sy0">*</span> RADIANS_TO_UU;
		<span class="br0">}</span>
 
	<span class="br0">}</span> <span class="kw2">else</span> <span class="br0">{</span>
 
		result.<span class="me0">yaw</span>		<span class="sy0">=</span> <span class="nu0">0</span>;
		result.<span class="me0">pitch</span>	<span class="sy0">=</span> UU_90_DEGREES;
		result.<span class="me0">roll</span>		<span class="sy0">=</span> <span class="kw3">atan</span><span class="br0">(</span> 2.0f<span class="sy0">*</span><span class="br0">(</span>x<span class="sy0">*</span>y<span class="sy0">-</span>w<span class="sy0">*</span>z<span class="br0">)</span>, 1.0f<span class="sy0">-</span>2.0f<span class="sy0">*</span><span class="br0">(</span>x<span class="sy0">*</span>x<span class="sy0">+</span>z<span class="sy0">*</span>z<span class="br0">)</span> <span class="br0">)</span> <span class="sy0">*</span> RADIANS_TO_UU;
	<span class="br0">}</span>
 
	<span class="kw2">return</span> <span class="kw3">Normalize</span><span class="br0">(</span> result <span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p><b>DemonThing:</b> Wouldn't the first lines be</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="co1">// 65536 / 2PI</span>
<span class="kw1">const</span> RADIANS_TO_UU <span class="sy0">=</span> 10430.37835047045272f;
 
<span class="co1">// 65536 / 4</span>
<span class="kw1">const</span> UU_90_DEGREES <span class="sy0">=</span> 16384.0f;
</pre></div>
</div>
<p>? I thought a full circle is 65536 = 2<sup>16</sup> UU.</p>
<p><b>MythOpus:</b> Rotations go 0 - 65535&#160;:)</p>
<p><b>Vorporeal</b> You're both incorrect. 0 - 65535 is a total of 65536 numbers. A quarter of that is 16384. Because it starts at 0, it should actually be 16383.</p>
<p><b>Wormbo:</b> That's actually not true either. If you add 4 quarter rotations you should end up with a full rotation again. Now I'm sure you will agree that 16383*4=65532, which obviously is not quite a full rotation. Beware of those "fencepost errors": 16383 is actually the largest angle within the first quarter of a full rotation. In other words, DemonThing's numbers would be the correct ones.</p>
<h3><span class="mw-headline" id="Normalizing_a_Quaternion">Normalizing a Quaternion</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=9" title="Edit section: Normalizing a Quaternion">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Returns a unit quaternion which is any quaternion with a magnitude of 1.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">static</span> <span class="kw1">final</span> <span class="kw1">function</span> <span class="kw5">quat</span> QuatNormalize<span class="br0">(</span> <span class="kw5">quat</span> q <span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw1">local</span> <span class="kw5">float</span> mag;
 
	mag <span class="sy0">=</span> <span class="br0">(</span> q.<span class="me0">x</span><span class="sy0">*</span>q.<span class="me0">x</span> <span class="br0">)</span> <span class="sy0">+</span> <span class="br0">(</span> q.<span class="me0">y</span><span class="sy0">*</span>q.<span class="me0">y</span> <span class="br0">)</span> <span class="sy0">+</span> <span class="br0">(</span> q.<span class="me0">z</span><span class="sy0">*</span>q.<span class="me0">z</span> <span class="br0">)</span> <span class="sy0">+</span> <span class="br0">(</span> q.<span class="me0">w</span><span class="sy0">*</span>q.<span class="me0">w</span> <span class="br0">)</span>;
	q.<span class="me0">x</span> <span class="sy0">=</span> q.<span class="me0">x</span> <span class="sy0">/</span> mag;
	q.<span class="me0">y</span> <span class="sy0">=</span> q.<span class="me0">y</span> <span class="sy0">/</span> mag;
	q.<span class="me0">z</span> <span class="sy0">=</span> q.<span class="me0">z</span> <span class="sy0">/</span> mag;
	q.<span class="me0">w</span> <span class="sy0">=</span> q.<span class="me0">w</span> <span class="sy0">/</span> mag;
 
	<span class="kw2">return</span> q;
<span class="br0">}</span>
</pre></div>
</div>
<h3><span class="mw-headline" id="Slerp_Between_Quaternions">Slerp Between Quaternions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=10" title="Edit section: Slerp Between Quaternions">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>This function performs a spherical linear interpolation between quaternion U and V. F is a value between 0 and 1 where 0 returns U, 1 returns V, and all other values return a smooth interpolation between them.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">static</span> <span class="kw1">final</span> <span class="kw1">function</span> <span class="kw5">quat</span> <span class="kw3">QuatSlerp</span><span class="br0">(</span> <span class="kw5">quat</span> u, <span class="kw5">quat</span> v, <span class="kw5">float</span> f <span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw1">local</span> <span class="kw5">float</span> alpha,beta,theta,sin_t,cos_t;
	<span class="kw1">local</span> <span class="kw5">int</span> 	flip;
	<span class="kw1">local</span> <span class="kw5">quat</span>	result;
 
    flip <span class="sy0">=</span> <span class="nu0">0</span>;
 
	<span class="co1">// Force the input within range.</span>
	f <span class="sy0">=</span> <span class="kw3">fmin</span><span class="br0">(</span> f, 1.0f <span class="br0">)</span>;
	f <span class="sy0">=</span> <span class="kw3">fmax</span><span class="br0">(</span> f, 0.0f <span class="br0">)</span>;
 
	cos_t <span class="sy0">=</span> u.<span class="me0">x</span><span class="sy0">*</span>v.<span class="me0">x</span><span class="sy0">+</span>u.<span class="me0">y</span><span class="sy0">*</span>v.<span class="me0">y</span><span class="sy0">+</span>u.<span class="me0">z</span><span class="sy0">*</span>v.<span class="me0">z</span><span class="sy0">+</span>u.<span class="me0">w</span><span class="sy0">*</span>v.<span class="me0">w</span>;
 
	<span class="kw2">if</span> <span class="br0">(</span> cos_t <span class="sy0">&lt;</span> 0.0f <span class="br0">)</span> <span class="br0">{</span> cos_t <span class="sy0">=</span> <span class="sy0">-</span>cos_t; flip<span class="sy0">=</span><span class="nu0">1</span>; <span class="br0">}</span>
 
	<span class="kw2">if</span> <span class="br0">(</span> <span class="br0">(</span> 1.0f <span class="sy0">-</span> cos_t <span class="br0">)</span> <span class="sy0">&lt;</span> 0.000001f <span class="br0">)</span> <span class="br0">{</span>
 
		beta 	<span class="sy0">=</span> 1.0f <span class="sy0">-</span> f;
		alpha 	<span class="sy0">=</span> f;
 
	<span class="br0">}</span> <span class="kw2">else</span> <span class="br0">{</span>
 
		theta 	<span class="sy0">=</span> <span class="kw3">acos</span><span class="br0">(</span> cos_t <span class="br0">)</span>;
		sin_t 	<span class="sy0">=</span> <span class="kw3">sin</span><span class="br0">(</span> theta <span class="br0">)</span>;
		beta 	<span class="sy0">=</span> <span class="kw3">sin</span><span class="br0">(</span> theta <span class="sy0">-</span> f <span class="sy0">*</span> theta <span class="br0">)</span> <span class="sy0">/</span> sin_t;
		alpha 	<span class="sy0">=</span> <span class="kw3">sin</span><span class="br0">(</span> f <span class="sy0">*</span> theta <span class="br0">)</span> <span class="sy0">/</span> sin_t;
	<span class="br0">}</span>
 
	<span class="kw2">if</span> <span class="br0">(</span> flip <span class="sy0">!=</span> <span class="nu0">0</span> <span class="br0">)</span> alpha <span class="sy0">=</span> <span class="sy0">-</span>alpha;
 
	result.<span class="me0">x</span> <span class="sy0">=</span> beta <span class="sy0">*</span> u.<span class="me0">x</span> <span class="sy0">+</span> alpha <span class="sy0">*</span> v.<span class="me0">x</span>;
	result.<span class="me0">y</span> <span class="sy0">=</span> beta <span class="sy0">*</span> u.<span class="me0">y</span> <span class="sy0">+</span> alpha <span class="sy0">*</span> v.<span class="me0">y</span>;
	result.<span class="me0">z</span> <span class="sy0">=</span> beta <span class="sy0">*</span> u.<span class="me0">z</span> <span class="sy0">+</span> alpha <span class="sy0">*</span> v.<span class="me0">z</span>;
	result.<span class="me0">w</span> <span class="sy0">=</span> beta <span class="sy0">*</span> u.<span class="me0">w</span> <span class="sy0">+</span> alpha <span class="sy0">*</span> v.<span class="me0">w</span>;
 
	<span class="kw2">return</span> result;
<span class="br0">}</span>
</pre></div>
</div>
<h2><span class="mw-headline" id="Discussion">Discussion</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=11" title="Edit section: Discussion">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><b>MythOpus:</b> So basically you're better off to use Quats for something like a spacecraft than using rotators+vectors? I assumed the 'gimble lock' on the player view was add intentionally and not the fault of how rotators+vectors work. I haven't really come accross that issue as of yet anyways.</p>
<p><b>Wormbo:</b> I'm pretty sure rotators work like they do because it makes most sense for on-foot movement with its fixed upward reference axis. The "gimbal lock" in player rotations when looking straight up or down is a combined result of the controls and how rotators work, because look input is directly mapped to rotator components. (up/down-&gt;pitch, left/right-&gt;yaw) This entire system assumes a hard-coded vertical axis and is not suited for games like Prey where you literally walk on walls and need a rotation system based on a local coordinate system. There is, actually, no reason to use quaternions if you're happy with vector operations to calculate your rotations. Quaternions are just a little more elegant.</p>
<h2><span class="mw-headline" id="Related_Topics">Related Topics</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=12" title="Edit section: Related Topics">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul>
<li><a href="Legacy_Built-In_Struct.html" title="Legacy:Built-In Struct">Built-In Struct</a></li>
<li><a href="Legacy_Quaternion_Rotation.html" title="Legacy:Quaternion Rotation">Quaternion Rotation</a></li>
<li><a href="Legacy_Quaternions_In_Unreal_Tournament.html" title="Legacy:Quaternions In Unreal Tournament">Quaternions In Unreal Tournament</a></li>
</ul>
<h2><span class="mw-headline" id="Related_Links">Related Links</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion?section=13" title="Edit section: Related Links">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul>
<li><a href="http://en.wikipedia.org/wiki/complex_number" class="extiw" title="wikipedia:complex number">Wikipedia:complex number</a></li>
<li><a href="http://en.wikipedia.org/wiki/quaternion" class="extiw" title="wikipedia:quaternion">Wikipedia:quaternion</a></li>
<li><a rel="nofollow" class="external text" href="http://http.cs.berkeley.edu/~laura/cs184/quat/quaternion.html">Using Quaternions to Represent Rotation</a></li>
<li><a rel="nofollow" class="external text" href="../graphics.cs.uiuc.edu/_jch/papers/vqr.pdf">Visualizing Quaternion Rotations</a></li>
<li><a rel="nofollow" class="external text" href="http://www.gamedev.net/reference/articles/article1095.asp">GameDev.net - Quaternion Powers</a></li>
</ul>

<!-- 
NewPP limit report
CPU time usage: 0.115 seconds
Real time usage: 0.120 seconds
Preprocessor visited node count: 105/1000000
Preprocessor generated node count: 176/1000000
Postâ€expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key wiki:pcache:idhash:2568-0!*!0!!en!5!* and timestamp 20161216060927 and revision id 46325
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://wiki.beyondunreal.com/Legacy:Quaternion?oldid=46325">https://wiki.beyondunreal.com/Legacy:Quaternion?oldid=46325</a>"</div>
					<div id='catlinks' class='catlinks catlinks-allhidden'></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-legacy" class="selected"><a href="Legacy_Quaternion.html">Legacy</a></li>
				<li id="ca-talk" class="new"><a href="https://wiki.beyondunreal.com/edit/Legacy_talk:Quaternion?redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-edit"><a href="https://wiki.beyondunreal.com/edit/Legacy:Quaternion" title="You can edit this page. Please use the preview button before saving [e]" accesskey="e">Edit</a></li>
				<li id="ca-history"><a href="https://wiki.beyondunreal.com/history/Legacy:Quaternion" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-createaccount"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=Legacy%3AQuaternion&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=Legacy%3AQuaternion" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="index.html" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-mainpage"><a href="index.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li>
											<li id="n-portal"><a href="Unreal_Wiki_Community_portal-2.html" title="About the project, what you can do, where to find things">Community portal</a></li>
											<li id="n-recentchanges"><a href="https://wiki.beyondunreal.com/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="https://wiki.beyondunreal.com/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
											<li id="n-Forums-.28General.29"><a href="https://forums.beyondunreal.com/forums/wiki-general.250/" rel="nofollow">Forums (General)</a></li>
											<li id="n-Forums-.28Technical.29"><a href="https://forums.beyondunreal.com/forums/wiki-technical.251/" rel="nofollow">Forums (Technical)</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="https://wiki.beyondunreal.com/" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Unreal Wiki [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="https://wiki.beyondunreal.com/Special:WhatLinksHere/Legacy:Quaternion" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="https://wiki.beyondunreal.com/Special:RecentChangesLinked/Legacy:Quaternion" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="https://wiki.beyondunreal.com/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="https://wiki.beyondunreal.com/Legacy:Quaternion?printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="https://wiki.beyondunreal.com/Legacy:Quaternion?oldid=46325" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="https://wiki.beyondunreal.com/info/Legacy:Quaternion" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="../licensebuttons.net/l/by-nc-sa/3.0/88x31.png" alt="Attribution-Noncommercial-Share Alike 3.0" width="88" height="31" /></a>
							</div>
					<div id="f-poweredbyico">
									<script async src="../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
        <!-- Home Page -->
        <ins class="adsbygoogle"
             style="display:inline-block;width:728px;height:90px"
             data-ad-client="ca-pub-9605963037553244"
             data-ad-slot="9528541415"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
							</div>
					<ul id="f-list">
									<li id="lastmod"> Last modified at 14:14, 11 April 2016.</li>
									<li id="copyright">Licensed as <a href="Unreal_Wiki_Copyrights.html" title="Unreal Wiki:Copyrights">Attribution-Noncommercial-Share Alike 3.0</a>.</li>
									<li id="privacy"><a href="Unreal_Wiki_Privacy_policy.html" title="Unreal Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="Unreal_Wiki_About.html" title="Unreal Wiki:About">About Unreal Wiki</a></li>
									<li id="disclaimer"><a href="Unreal_Wiki_General_disclaimer.html" title="Unreal Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.beyondunreal.com/w/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=monobook\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":218});
}</script></body>
<!-- Mirrored from wiki.beyondunreal.com/Legacy:Quaternion by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 07:56:29 GMT -->
</html>
