<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.beyondunreal.com/Legacy:KShip by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 09:35:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>Legacy:KShip - Unreal Wiki</title>
<meta name="generator" content="MediaWiki 1.25.1" />
<link rel="alternate" type="application/x-wiki" title="Edit" href="https://wiki.beyondunreal.com/edit/Legacy:KShip" />
<link rel="edit" title="Edit" href="https://wiki.beyondunreal.com/edit/Legacy:KShip" />
<link rel="shortcut icon" href="w/uewiki-favicon.png" />
<link rel="search" type="application/opensearchdescription+xml" href="w/opensearch_desc.php" title="Unreal Wiki" />
<link rel="EditURI" type="application/rsd+xml" href="w/api251f.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Legacy_KShip.html" />
<link rel="copyright" href="Unreal_Wiki_Copyrights.html" />
<link rel="alternate" type="application/atom+xml" title="Unreal Wiki Atom feed" href="https://wiki.beyondunreal.com/Special:RecentChanges?feed=atom" />
<link rel="stylesheet" href="w/load2743.css?debug=false&amp;lang=en&amp;modules=ext.geshi.language.uscript%7Cmediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if IE 6]><link rel="stylesheet" href="/w/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/w/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="w/load484a.css?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=monobook&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: wiki:resourceloader:filter:minify-css:7:29b70323345a439ab9ed7007e0c178a6 */</style>
<script src="w/load9316.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"Legacy","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":100,"wgPageName":"Legacy:KShip","wgTitle":"KShip","wgCurRevisionId":42913,"wgRevisionId":42913,"wgArticleId":1587,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Legacy:KShip","wgRelevantArticleId":1587,"wgIsProbablyEditable":true,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgCategoryTreePageCategoryOptions":"{\"mode\":0,\"hideprefix\":20,\"showcount\":true,\"namespaces\":false}"});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: wiki:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-100 ns-subject page-Legacy_KShip skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
									<div id="siteNotice"><div id="localNotice" lang="en" dir="ltr"><p>Gah - a solution with more questions. &#8211; EntropicLqd
</p></div></div>
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Legacy:KShip</h1>

				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Unreal Wiki, The Unreal Engine Documentation Site</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>Well this is basically my code for a space ship, thanks a lot to Daid for lending me his replication code (which turned out to come from KCar but i thank him non the less, great guy he is&#160;:D)</p>
<p>I currently use a different, more client oriented replication system, but this one here is a lot better, i havent incorporated my ship to it yet because i have some other problems that come with it that i have to solve, but since the "core" ship here is simple, ill use the better replication for you guys&#160;:)</p>
<p>(Btw i deal with all the entering/leaving of the vehicle in a parent class, this is really irrelevant to physics and is easy to do, so i left it out just so there will be less and easier to read code)</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">var</span> <span class="kw5">float</span>			Roll, CThrust, TempThrust, OldThrust; 
<span class="co1">// Throttle and Steering are already declared in KVehicle, so all we need is roll, CThrust, TempThrust, OldThrust will be explained soon</span>
<span class="co1">// BTW note that i use Throttle for Pitch alteration because it is already bound by other vehicles to the forward/backward key</span>
<span class="co1">// ok i have also incorporated a system that allows for various thrust managments, </span>
<span class="co1">//if you simply want to move forward full speed only while you press the the thrust button, you would use TempThrust. </span>
<span class="co1">//when you release the thrust button you though you should always set TempThrust to -1</span>
<span class="co1">// if you want to have a constant speed, assign it to CThrust, so every time you release the thrust button (the one that changes TempThrust) </span>
<span class="co1">// you would automatically start going at that speed (good for stuff like dogifghting and matching speeds)</span>
<span class="co1">// and lastly i added an afterburner effect, ill include it here for you guys to see although it isnt hard to do.</span>
<span class="co1">// also what i did with it was that when you afterburn and you run out of energy, while you still hold the afterburn key</span>
<span class="co1">// you would keep going at your max possible speed, and once you release it you would start going at your constant wanted speed (CThrust)</span>
<span class="co1">// Thats why i have 2 vars, bAfterburn is for after burning (holding key and having enough E), bBurn is for only holding the afterburn key with no regard to its depletion</span>
<span class="kw1">var</span> <span class="kw5">bool</span>			bAfterburn, bBurn; <span class="co1">// note that you should set both of those to true when you want to afterburn</span>
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw5">float</span>			ForwardTrust, TurnRate, AfterBurnThrust; <span class="co1">// This is basically how fast our ship turns/moves</span>
<span class="kw1">var</span> <span class="kw5">float</span>			CurRoll, CurSteering, CurThrottle, UnitAccRate; <span class="co1">// This is used for acceleration</span>
<span class="co1">// CThrust is used for ships that can assign a specific throttle value, like 75% of max speed or whatever...</span>
<span class="co1">// UnitAccRate is how much each value increases per second</span>
<span class="kw1">var</span> <span class="kw5">vector</span>			ExtraForce, ExtraTorque; <span class="co1">// Used for Karama forces pileup</span>
 
<span class="co1">// Ship replication vars and functions, thanks daid!</span>
<span class="kw1">struct</span> StructShipState
<span class="br0">{</span>
	<span class="kw1">var</span> KRBVec				ChassisPosition;
	<span class="kw1">var</span> <span class="kw5">Quat</span>				ChassisQuaternion;
	<span class="kw1">var</span> KRBVec				ChassisLinVel;
	<span class="kw1">var</span> KRBVec				ChassisAngVel;
 
	<span class="kw1">var</span> <span class="kw5">float</span>				ServerSteering;
	<span class="kw1">var</span> <span class="kw5">float</span>				ServerThrottle;
	<span class="kw1">var</span> <span class="kw5">float</span>				ServerRoll;
 
	<span class="kw1">var</span> <span class="kw5">bool</span>				ServerbAfterburn;
	<span class="kw1">var</span> <span class="kw5">bool</span>				ServerbBurn;
 
	<span class="kw1">var</span> <span class="kw5">bool</span>				bNewState; <span class="co1">// Set to true whenever a new state is received and should be processed</span>
<span class="br0">}</span>;
 
<span class="kw1">var</span> <span class="kw5">KRigidBodyState</span>		ChassisState;
 
<span class="kw1">var</span> StructShipState		ShipState; <span class="co1">// This is replicated to the ship, and processed to update all the parts.</span>
<span class="kw1">var</span> <span class="kw5">bool</span>			bNewShipState; <span class="co1">// Indicated there is new data processed, and chassis RBState should be updated.</span>
 
<span class="kw1">var</span> <span class="kw5">float</span>			NextNetUpdateTime;	<span class="co1">// Next time we should force an update of vehicles state.</span>
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw5">float</span>			MaxNetUpdateInterval;
 
<span class="kw1">var</span> <span class="kw5">int</span> AVar;<span class="co1">//Just for replication, else the ShipState doesn't get replicated</span>
 
<span class="kw1">Replication</span>
<span class="br0">{</span>
	<span class="kw1">unreliable</span> <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span>
		ShipState, AVar;
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">event</span> VehicleStateReceived<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw2">if</span><span class="br0">(</span><span class="sy0">!</span>ShipState.<span class="me0">bNewState</span><span class="br0">)</span>
		<span class="kw2">return</span>;
 
	<span class="co1">// Get root chassis info</span>
	ChassisState.<span class="me0">Position</span> <span class="sy0">=</span> ShipState.<span class="me0">ChassisPosition</span>;
	ChassisState.<span class="me0">Quaternion</span> <span class="sy0">=</span> ShipState.<span class="me0">ChassisQuaternion</span>;
	ChassisState.<span class="me0">LinVel</span> <span class="sy0">=</span> ShipState.<span class="me0">ChassisLinVel</span>;
	ChassisState.<span class="me0">AngVel</span> <span class="sy0">=</span> ShipState.<span class="me0">ChassisAngVel</span>;
 
	<span class="co1">// Update control inputs</span>
	Steering <span class="sy0">=</span> ShipState.<span class="me0">ServerSteering</span>;
	Throttle <span class="sy0">=</span> ShipState.<span class="me0">ServerThrottle</span>;
	Roll <span class="sy0">=</span> ShipState.<span class="me0">ServerRoll</span>;
 
	<span class="co1">// Afterburner</span>
	bAfterburn <span class="sy0">=</span> ShipState.<span class="me0">ServerbAfterburn</span>;
	bBurn <span class="sy0">=</span> ShipState.<span class="me0">ServerbBurn</span>;
 
	<span class="co1">// Update flags</span>
	ShipState.<span class="me0">bNewState</span> <span class="sy0">=</span> <span class="kw6">false</span>;
	bNewShipState <span class="sy0">=</span> <span class="kw6">true</span>;
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">event</span> <span class="kw5">bool</span> KUpdateState<span class="br0">(</span><span class="kw1">out</span> <span class="kw5">KRigidBodyState</span> newState<span class="br0">)</span>
<span class="br0">{</span>
	<span class="co1">// This should never get called on the server - but just in case!</span>
	<span class="kw2">if</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span> <span class="sy0">||</span> <span class="sy0">!</span>bNewShipState<span class="br0">)</span>
		<span class="kw2">return</span> <span class="kw6">false</span>;
 
	<span class="co1">// Apply received data as new position of ship chassis.</span>
	newState <span class="sy0">=</span> ChassisState;
	bNewShipState <span class="sy0">=</span> <span class="kw6">false</span>;
 
	<span class="kw2">return</span> <span class="kw6">true</span>;
<span class="br0">}</span>
 
<span class="kw1">function</span> PackState<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw1">local</span> <span class="kw5">vector</span> chassisPos, chassisLinVel, chassisAngVel;
	<span class="kw1">local</span> <span class="kw5">vector</span> oldPos, oldLinVel;
	<span class="kw1">local</span> <span class="kw5">KRigidBodyState</span> ChassisState;
 
	<span class="co1">// Get chassis state.</span>
	KGetRigidBodyState<span class="br0">(</span>ChassisState<span class="br0">)</span>;
 
	chassisPos <span class="sy0">=</span> KRBVecToVector<span class="br0">(</span>ChassisState.<span class="me0">Position</span><span class="br0">)</span>;
	chassisLinVel <span class="sy0">=</span> KRBVecToVector<span class="br0">(</span>ChassisState.<span class="me0">LinVel</span><span class="br0">)</span>;
	chassisAngVel <span class="sy0">=</span> KRBVecToVector<span class="br0">(</span>ChassisState.<span class="me0">AngVel</span><span class="br0">)</span>;
 
	<span class="co1">// Last position we sent</span>
	oldPos <span class="sy0">=</span> KRBVectoVector<span class="br0">(</span>ShipState.<span class="me0">ChassisPosition</span><span class="br0">)</span>;
	oldLinVel <span class="sy0">=</span> KRBVectoVector<span class="br0">(</span>ShipState.<span class="me0">ChassisLinVel</span><span class="br0">)</span>;
 
	<span class="co1">// See if state has changed enough, or enough time has passed, that we </span>
	<span class="co1">// should send out another update by updating the state struct.</span>
	<span class="kw2">if</span><span class="br0">(</span> <span class="sy0">!</span>KIsAwake<span class="br0">(</span><span class="br0">)</span> <span class="br0">)</span>
	<span class="br0">{</span>
		<span class="kw2">return</span>; <span class="co1">// Never send updates if physics is at rest</span>
	<span class="br0">}</span>
 
	<span class="kw2">if</span><span class="br0">(</span> <span class="kw3">VSize</span><span class="br0">(</span>oldPos <span class="sy0">-</span> chassisPos<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">5</span> <span class="sy0">||</span>
		<span class="kw3">VSize</span><span class="br0">(</span>oldLinVel <span class="sy0">-</span> chassisLinVel<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">1</span> <span class="sy0">||</span>
		<span class="kw3">Abs</span><span class="br0">(</span>ShipState.<span class="me0">ServerThrottle</span> <span class="sy0">-</span> Throttle<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">0.1</span> <span class="sy0">||</span>
		<span class="kw3">Abs</span><span class="br0">(</span>ShipState.<span class="me0">ServerSteering</span> <span class="sy0">-</span> Steering<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">0.1</span> <span class="sy0">||</span>
		<span class="kw3">Abs</span><span class="br0">(</span>ShipState.<span class="me0">ServerRoll</span> <span class="sy0">-</span> Roll<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">0.1</span> <span class="sy0">||</span>
		bAfterburn <span class="sy0">!=</span> ShipState.<span class="me0">ServerbAfterburn</span> <span class="sy0">||</span>
		bBurn <span class="sy0">!=</span> ShipState.<span class="me0">ServerbBurn</span> <span class="sy0">||</span>
		<span class="kw7">Level</span>.<span class="me0">TimeSeconds</span> <span class="sy0">&gt;</span> NextNetUpdateTime <span class="br0">)</span>
	<span class="br0">{</span>
		NextNetUpdateTime <span class="sy0">=</span> <span class="kw7">Level</span>.<span class="me0">TimeSeconds</span> <span class="sy0">+</span> MaxNetUpdateInterval;
	<span class="br0">}</span>
	<span class="kw2">else</span>
	<span class="br0">{</span>
		<span class="kw2">return</span>;
	<span class="br0">}</span>
 
	ShipState.<span class="me0">ChassisPosition</span> <span class="sy0">=</span> ChassisState.<span class="me0">Position</span>;
	ShipState.<span class="me0">ChassisQuaternion</span> <span class="sy0">=</span> ChassisState.<span class="me0">Quaternion</span>;
	ShipState.<span class="me0">ChassisLinVel</span> <span class="sy0">=</span> ChassisState.<span class="me0">LinVel</span>;
	ShipState.<span class="me0">ChassisAngVel</span> <span class="sy0">=</span> ChassisState.<span class="me0">AngVel</span>;
 
	<span class="co1">// Player Input</span>
	ShipState.<span class="me0">ServerSteering</span> <span class="sy0">=</span> Steering;
	ShipState.<span class="me0">ServerThrottle</span> <span class="sy0">=</span> Throttle;
	ShipState.<span class="me0">ServerRoll</span> <span class="sy0">=</span> Roll;
 
	<span class="co1">// AfterBurner</span>
	ShipState.<span class="me0">ServerbAfterburn</span> <span class="sy0">=</span> bAfterburn;
	ShipState.<span class="me0">ServerbBurn</span> <span class="sy0">=</span> bBurn;
 
	<span class="co1">// This flag lets the client know this data is new.</span>
	ShipState.<span class="me0">bNewState</span> <span class="sy0">=</span> <span class="kw6">true</span>;
	<span class="co1">//Make sure ShipState gets replicated</span>
	AVar<span class="sy0">++</span>;
	<span class="kw2">if</span> <span class="br0">(</span>AVar <span class="sy0">&gt;</span> <span class="nu0">10</span><span class="br0">)</span>
		AVar<span class="sy0">=</span><span class="nu0">0</span>;
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw4">Tick</span><span class="br0">(</span><span class="kw5">float</span> DeltaTime<span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw6">Super</span>.<span class="kw4">Tick</span><span class="br0">(</span>DeltaTime<span class="br0">)</span>;
	<span class="kw2">if</span><span class="br0">(</span><span class="sy0">!</span>KIsAwake<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> <span class="kw9">Controller</span><span class="sy0">!=</span><span class="kw5">None</span><span class="br0">)</span>
		KWake<span class="br0">(</span><span class="br0">)</span>;
	<span class="kw2">if</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span> <span class="sy0">&amp;&amp;</span> <span class="kw7">Level</span>.<span class="me0">NetMode</span> <span class="sy0">!=</span> NM_StandAlone<span class="br0">)</span>
		PackState<span class="br0">(</span><span class="br0">)</span>;
	UpdateAcceleration<span class="br0">(</span>DeltaTime<span class="br0">)</span>;
	UpdateExtraForce<span class="br0">(</span>DeltaTime<span class="br0">)</span>;
<span class="br0">}</span>
<span class="kw1">simulated</span> <span class="kw1">function</span> UpdateAcceleration<span class="br0">(</span><span class="kw5">float</span> Delta<span class="br0">)</span>
<span class="br0">{</span>
	CurSteering <span class="sy0">=</span> CurSteering <span class="sy0">+</span> Steering <span class="sy0">*</span> UnitAccRate <span class="sy0">*</span> Delta;
	CurThrottle <span class="sy0">=</span> CurThrottle <span class="sy0">+</span> Throttle <span class="sy0">*</span> UnitAccRate <span class="sy0">*</span> Delta;
	CurRoll     <span class="sy0">=</span> CurRoll     <span class="sy0">+</span> Roll     <span class="sy0">*</span> UnitAccRate <span class="sy0">*</span> Delta;
	<span class="kw2">if</span><span class="br0">(</span>Steering<span class="sy0">==</span><span class="nu0">0</span><span class="br0">)</span>
		CurSteering<span class="sy0">=</span><span class="nu0">0</span>;
	<span class="kw2">if</span><span class="br0">(</span>Throttle<span class="sy0">==</span><span class="nu0">0</span><span class="br0">)</span>
		CurThrottle<span class="sy0">=</span><span class="nu0">0</span>;
	<span class="kw2">if</span><span class="br0">(</span>Roll<span class="sy0">==</span><span class="nu0">0</span><span class="br0">)</span>
		CurRoll<span class="sy0">=</span><span class="nu0">0</span>;
 
	<span class="kw2">if</span><span class="br0">(</span><span class="kw3">Abs</span><span class="br0">(</span>CurSteering<span class="br0">)</span><span class="sy0">&gt;</span><span class="kw3">Abs</span><span class="br0">(</span>Steering<span class="br0">)</span><span class="br0">)</span>
		CurSteering<span class="sy0">=</span>Steering;
	<span class="kw2">if</span><span class="br0">(</span><span class="kw3">Abs</span><span class="br0">(</span>CurThrottle<span class="br0">)</span><span class="sy0">&gt;</span><span class="kw3">Abs</span><span class="br0">(</span>Throttle<span class="br0">)</span><span class="br0">)</span>
		CurThrottle<span class="sy0">=</span>Throttle;
	<span class="kw2">if</span><span class="br0">(</span><span class="kw3">Abs</span><span class="br0">(</span>CurRoll<span class="br0">)</span><span class="sy0">&gt;</span><span class="kw3">Abs</span><span class="br0">(</span>Roll<span class="br0">)</span><span class="br0">)</span>
		CurRoll<span class="sy0">=</span>Roll;
 
	<span class="kw2">if</span><span class="br0">(</span>bAfterBurn<span class="br0">)</span>
	<span class="br0">{</span>
		ReduceAfterBurnEnergy<span class="br0">(</span><span class="br0">)</span>; <span class="co1">// just made this up, put it here incase you have something like this</span>
		<span class="kw2">if</span><span class="br0">(</span>GetAfterburnEnergy<span class="br0">(</span><span class="br0">)</span><span class="sy0">&lt;=</span><span class="nu0">0</span><span class="br0">)</span> <span class="co1">// Another fictional function...</span>
		<span class="br0">{</span>
			bAfterBurn<span class="sy0">=</span><span class="kw6">False</span>;
		<span class="br0">}</span>
		<span class="kw2">else</span>
		<span class="br0">{</span>
			CThrust<span class="sy0">=</span>AfterBurnThrust;
		<span class="br0">}</span>
	<span class="br0">}</span>
	<span class="kw2">if</span><span class="br0">(</span>bBurn <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span>bAfterBurn <span class="sy0">&amp;&amp;</span> CThrust<span class="sy0">!=</span><span class="nu0">1</span><span class="br0">)</span>
	<span class="br0">{</span>
		CThrust<span class="sy0">=</span><span class="nu0">1</span>;
	<span class="br0">}</span>
	<span class="kw2">else</span> <span class="kw2">if</span><span class="br0">(</span><span class="sy0">!</span>bBurn <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span>bAfterBurn <span class="sy0">&amp;&amp;</span> CThrust<span class="sy0">!=</span>OldThrust<span class="br0">)</span>
	<span class="br0">{</span>
		CThrust<span class="sy0">=</span>OldThrust;
	<span class="br0">}</span>
 
	<span class="kw2">if</span><span class="br0">(</span>TempThrust<span class="sy0">!=-</span><span class="nu0">1</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span>bAfterBurn<span class="br0">)</span>
	<span class="br0">{</span>
		<span class="kw2">if</span><span class="br0">(</span><span class="kw3">Abs</span><span class="br0">(</span>CurThrust<span class="sy0">-</span>TempThrust<span class="br0">)</span><span class="sy0">&lt;</span><span class="nu0">0.01</span><span class="br0">)</span>
			CurThrust<span class="sy0">=</span>TempThrust;
		<span class="kw2">if</span><span class="br0">(</span>CurThrust<span class="sy0">&gt;</span>TempThrust<span class="br0">)</span>
			CurThrust <span class="sy0">=</span> CurThrust <span class="sy0">-</span> UnitAccRate <span class="sy0">*</span> Delta <span class="sy0">/</span> <span class="nu0">4</span>; 
			<span class="co1">// I made linear acceleration 4 times slower than rotation, you can do whatever you want though</span>
		<span class="kw2">else</span> <span class="kw2">if</span><span class="br0">(</span>CurThrust<span class="sy0">&lt;</span>TempThrust<span class="br0">)</span>
			CurThrust <span class="sy0">=</span> CurThrust <span class="sy0">+</span> UnitAccRate <span class="sy0">*</span> Delta <span class="sy0">/</span> <span class="nu0">4</span>;
	<span class="br0">}</span>
	<span class="kw2">else</span> <span class="kw2">if</span><span class="br0">(</span>CurThrust<span class="sy0">!=</span>CThrust <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span>bAfterBurn<span class="br0">)</span>
	<span class="br0">{</span>
		<span class="kw2">if</span><span class="br0">(</span><span class="kw3">Abs</span><span class="br0">(</span>CurThrust<span class="sy0">-</span>CThrust<span class="br0">)</span><span class="sy0">&lt;</span><span class="nu0">0.01</span><span class="br0">)</span>
			CurThrust<span class="sy0">=</span>CThrust;
		<span class="kw2">else</span> <span class="kw2">if</span><span class="br0">(</span>CurThrust<span class="sy0">&gt;</span>CThrust<span class="br0">)</span>
			CurThrust <span class="sy0">=</span> CurThrust <span class="sy0">-</span> UnitAccRate <span class="sy0">*</span> Delta <span class="sy0">/</span> <span class="nu0">4</span>;
		<span class="kw2">else</span> <span class="kw2">if</span><span class="br0">(</span>CurThrust<span class="sy0">&lt;</span>CThrust<span class="br0">)</span>
			CurThrust <span class="sy0">=</span> CurThrust <span class="sy0">+</span> UnitAccRate <span class="sy0">*</span> Delta <span class="sy0">/</span> <span class="nu0">4</span>;
	<span class="br0">}</span>
	<span class="kw2">else</span> <span class="kw2">if</span><span class="br0">(</span>CurThrust<span class="sy0">!=</span>CThrust <span class="sy0">&amp;&amp;</span> bAfterBurn<span class="br0">)</span>
	<span class="br0">{</span>
		<span class="kw2">if</span><span class="br0">(</span><span class="kw3">Abs</span><span class="br0">(</span>CurThrust<span class="sy0">-</span>CThrust<span class="br0">)</span><span class="sy0">&lt;</span><span class="nu0">0.01</span><span class="br0">)</span>
			CurThrust<span class="sy0">=</span>CThrust;
		<span class="kw2">else</span> <span class="kw2">if</span><span class="br0">(</span>CurThrust<span class="sy0">&gt;</span>CThrust<span class="br0">)</span>
			CurThrust <span class="sy0">=</span> CurThrust <span class="sy0">-</span> UnitAccRate <span class="sy0">*</span> Delta <span class="sy0">/</span> <span class="nu0">2.2</span>; <span class="co1">// Acceleration with afterburner a lot faster</span>
		<span class="kw2">else</span> <span class="kw2">if</span><span class="br0">(</span>CurThrust<span class="sy0">&lt;</span>CThrust<span class="br0">)</span>
			CurThrust <span class="sy0">=</span> CurThrust <span class="sy0">+</span> UnitAccRate <span class="sy0">*</span> Delta <span class="sy0">/</span> <span class="nu0">2.2</span>;
	<span class="br0">}</span>
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">function</span> UpdateExtraForce<span class="br0">(</span><span class="kw5">float</span> Delta<span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw1">local</span> <span class="kw5">vector</span> worldForward, worldDown, worldLeft;
 
	worldForward <span class="sy0">=</span> <span class="kw3">vect</span><span class="br0">(</span><span class="nu0">1</span>, <span class="nu0">0</span>, <span class="nu0">0</span><span class="br0">)</span> <span class="sy0">&gt;&gt;</span> <span class="kw7">Rotation</span>;
	worldDown <span class="sy0">=</span> <span class="kw3">vect</span><span class="br0">(</span><span class="nu0">0</span>, <span class="nu0">0</span>, <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span> <span class="sy0">&gt;&gt;</span> <span class="kw7">Rotation</span>;
	worldLeft <span class="sy0">=</span> <span class="kw3">vect</span><span class="br0">(</span><span class="nu0">0</span>, <span class="sy0">-</span><span class="nu0">1</span>, <span class="nu0">0</span><span class="br0">)</span> <span class="sy0">&gt;&gt;</span> <span class="kw7">Rotation</span>;
 
	ExtraForce <span class="sy0">=</span> ExtraForce <span class="sy0">+</span> worldForward <span class="sy0">*</span> ForwardThrust <span class="sy0">*</span> Delta <span class="sy0">*</span> CurThrust; <span class="co1">// Speed</span>
	ExtraTorque <span class="sy0">=</span> ExtraTorque <span class="sy0">+</span> worldDown <span class="sy0">*</span> TurnRate <span class="sy0">*</span> Delta <span class="sy0">*</span> CurSteering; <span class="co1">// Yaw</span>
	ExtraTorque <span class="sy0">=</span> ExtraTorque <span class="sy0">+</span> worldLeft <span class="sy0">*</span> TurnRate <span class="sy0">*</span> Delta <span class="sy0">*</span> CurThrottle; <span class="co1">// Pitch</span>
	ExtraTorque <span class="sy0">=</span> ExtraTorque <span class="sy0">+</span> worldForward <span class="sy0">*</span> TurnRate <span class="sy0">*</span> Delta <span class="sy0">*</span> <span class="sy0">-</span>CurRoll; <span class="co1">// Roll</span>
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">event</span> <span class="kw4">KApplyForce</span><span class="br0">(</span><span class="kw1">out</span> <span class="kw5">vector</span> Force, <span class="kw1">out</span> <span class="kw5">vector</span> Torque<span class="br0">)</span>
<span class="br0">{</span>
	<span class="co1">// This actually does the applying of the piled up force</span>
	Force <span class="sy0">=</span> ExtraForce;
	Torque <span class="sy0">=</span> ExtraTorque;
	ExtraForce <span class="sy0">=</span> <span class="kw3">vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span>;
	ExtraTorque <span class="sy0">=</span> <span class="kw3">vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">DefaultProperties</span>
<span class="br0">{</span>
     <span class="co1">// Create Karma collision Params for ourselves, you can change whatever you want here</span>
     <span class="kw2">Begin</span> <span class="kw8">Object</span> <span class="kw1">Class</span><span class="sy0">=</span><span class="kw8">KarmaParamsRBFull</span> <span class="kw5">Name</span><span class="sy0">=</span>KParams0
         KLinearDamping<span class="sy0">=</span><span class="nu0">2.000</span>;
         KAngularDamping<span class="sy0">=</span><span class="nu0">2.000</span>;
         KStartEnabled<span class="sy0">=</span><span class="kw6">True</span>
         bHighDetailOnly<span class="sy0">=</span><span class="kw6">False</span>
         bClientOnly<span class="sy0">=</span><span class="kw6">False</span>
         bKDoubleTickRate<span class="sy0">=</span><span class="kw6">False</span>
         KFriction<span class="sy0">=</span><span class="nu0">1.600000</span>
         KActorGravScale <span class="sy0">=</span> <span class="nu0">0.0</span>;
	 KMass<span class="sy0">=</span><span class="nu0">2</span>;
         <span class="kw5">Name</span><span class="sy0">=</span><span class="st0">"KParams0"</span>
     End <span class="kw8">Object</span>
     KParams<span class="sy0">=</span><span class="kw8">KarmaParamsRBFull</span><span class="st0">'&lt;MyPackage&gt;.&lt;MyShipClass&gt;.KParams0'</span>
 
     <span class="co1">// And just some other variables:</span>
     TurnRate<span class="sy0">=</span><span class="nu0">8</span>
     ForwardThrust<span class="sy0">=</span><span class="nu0">5000</span>
     UnitAccRate<span class="sy0">=</span><span class="nu0">2.0</span>
     AfterBurnThrust<span class="sy0">=</span><span class="nu0">1.20</span> <span class="co1">// basically means that afterburner goes at 120% of regular maximum speed</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>and that should be it, i hope i didnt miss anything...</p>
<p><b>Spark:</b> KParams=KarmaParamsRBFull'&lt;MyPackage&gt;.&lt;MyShipClass&gt;.KParams0' &lt;– Is this supposed to be a trap?&#160;;) Took me a while to figure out that my ship didn't fly because this wasn't set to KParams0 and thus wasn't enabled at all.&#160;:)</p>
<p><b>Sir_Brizz:</b> Zep, did you end up getting your Quaternion working for the indicator? I have a few ideas that work if you want to know what they are.</p>
<p><b>ProjectX:</b> I'm a n00b to coding, but is it possible to take this code, and change it to create a "hovering vehicles" class, that basicly, wont go a certan height above ground, but, from high jumps, etc., go lower to the ground? I also saw that there was 3 types of thrust, is it possible to bind a key that will cycle through the flying types (for more precise flying, eg. for dog matches and realism)?</p>
<p><b>NickR:</b> Does anyone have a working example of a flying vehicle?</p>
<p><b>Foxpaw:</b> I do, but my mod is still quite a ways from release. The code above allegedly is working code for a flying vehicle, though I've never tested it.</p>
<p><b>LiKeMiKeS:</b> I've tried many times compiling this KShip script and have ended up with an error for the ShipState 'struct' &amp; 'var' references obscuring each other and haven't been able to figure out a clean fix so it will compile - without creating another unneeded var instance or reference. I'm still learning the nuances of uscript, so it's difficult to debug atm.</p>
<p><b>Brold9999:</b> I tried the above code long ago and it didn't seem to work. I have gotten a lot of questions on my mod, UT Space Battle, as to how I implemented the vehicles. I did not use a Karma or PhysX based approach but that is what most of the people who have asked me about this seem to be looking for. I have taken the code above and hammered away at it until it works. I ripped out many unnecessary sections (such as afterburner) which only cluttered the salient concepts of implementing a 6DOF vehicle. The new version should compile and work out-of-the-box and has (mostly) working netcode. Some tweaks are still necessary to make a vehicle suitable for a mod but this one does the basics that seem to trip most people up when they try to implement a 6DOF vehicle. KShip is the base 6DOF vehicle, FlyingDog is a butchered Bulldog which is based on KShip. Code follows:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> KShip <span class="kw1">extends</span> <span class="kw9">KVehicle</span>;
 
<span class="co1">// Used for Karma forces pileup</span>
<span class="co1">// Add to these variables to apply force and torque to the ship.</span>
<span class="kw1">var</span> <span class="kw5">vector</span> extraForce, extraTorque;
 
<span class="co1">// Amount to increment/decrement shipSteering.roll for every click of the mouse wheel.</span>
<span class="kw1">var</span> <span class="kw5">float</span> rollUnit;
<span class="co1">// Desired rotation torque is reduced each tick. This factor controls how rapidly old inputs decay.</span>
<span class="kw1">var</span> <span class="kw5">float</span> turnDecayTime;
<span class="co1">// Amount of rotation torque to apply for a given amount of mouse movement.</span>
<span class="kw1">var</span> <span class="kw5">float</span> turnSensitivity;
<span class="co1">// Maximum amount of rotation torque that can be accumulated.</span>
<span class="kw1">var</span> <span class="kw5">float</span> maximumTurnRate;
<span class="co1">// Maximum linear thrust the ship can apply.</span>
<span class="kw1">var</span> <span class="kw5">float</span> maximumThrust;
 
<span class="co1">// Desired torque on the ship - relative to it's current rotation.</span>
<span class="kw1">var</span> <span class="kw5">rotator</span> shipSteering;
<span class="co1">// Desired linear thrust to apply to the ship - not relative to it's current rotation.</span>
<span class="kw1">var</span> <span class="kw5">vector</span> shipThrust;
 
<span class="co1">// Ship replication vars and functions, thanks daid!</span>
<span class="kw1">struct</span> StructShipState
<span class="br0">{</span>
  <span class="kw1">var</span> KRBVec  ChassisPosition;
  <span class="kw1">var</span> <span class="kw5">Quat</span>    ChassisQuaternion;
  <span class="kw1">var</span> KRBVec  ChassisLinVel;
  <span class="kw1">var</span> KRBVec  ChassisAngVel;
 
  <span class="kw1">var</span> <span class="kw5">rotator</span> serverSteering;
  <span class="kw1">var</span> <span class="kw5">vector</span>  serverThrust;
 
  <span class="kw1">var</span> <span class="kw5">bool</span>    bNewState; <span class="co1">// Set to true whenever a new state is received and should be processed</span>
<span class="br0">}</span>;
 
<span class="kw1">var</span> <span class="kw5">KRigidBodyState</span> ChassisState;
<span class="kw1">var</span> StructShipState ShipState; <span class="co1">// This is replicated to the ship, and processed to update all the parts.</span>
<span class="kw1">var</span> <span class="kw5">bool</span> bNewShipState; <span class="co1">// Indicated there is new data processed, and chassis RBState should be updated.</span>
 
<span class="kw1">var</span> <span class="kw5">float</span> NextNetUpdateTime;  <span class="co1">// Next time we should force an update of vehicles state.</span>
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw5">float</span> MaxNetUpdateInterval;
 
<span class="kw1">var</span> <span class="kw5">int</span> AVar;<span class="co1">//Just for replication, else the ShipState doesn't get replicated</span>
 
<span class="kw1">replication</span>
<span class="br0">{</span>
  <span class="kw1">unreliable</span> <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span>
    ShipState, AVar;
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">event</span> VehicleStateReceived<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw2">if</span><span class="br0">(</span><span class="sy0">!</span>ShipState.<span class="me0">bNewState</span><span class="br0">)</span>
    <span class="kw2">return</span>;
 
  <span class="co1">// Get root chassis info</span>
  ChassisState.<span class="me0">Position</span> <span class="sy0">=</span> ShipState.<span class="me0">ChassisPosition</span>;
  ChassisState.<span class="me0">Quaternion</span> <span class="sy0">=</span> ShipState.<span class="me0">ChassisQuaternion</span>;
  ChassisState.<span class="me0">LinVel</span> <span class="sy0">=</span> ShipState.<span class="me0">ChassisLinVel</span>;
  ChassisState.<span class="me0">AngVel</span> <span class="sy0">=</span> ShipState.<span class="me0">ChassisAngVel</span>;
 
  <span class="co1">// Update control inputs</span>
  shipSteering <span class="sy0">=</span> ShipState.<span class="me0">serverSteering</span>;
  shipThrust <span class="sy0">=</span> ShipState.<span class="me0">serverThrust</span>;
 
  <span class="co1">// Update flags</span>
  ShipState.<span class="me0">bNewState</span> <span class="sy0">=</span> <span class="kw6">false</span>;
  bNewShipState <span class="sy0">=</span> <span class="kw6">true</span>;
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">event</span> <span class="kw5">bool</span> KUpdateState<span class="br0">(</span><span class="kw1">out</span> <span class="kw5">KRigidBodyState</span> newState<span class="br0">)</span>
<span class="br0">{</span>
  <span class="co1">// This should never get called on the server - but just in case!</span>
  <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span> <span class="sy0">||</span> <span class="sy0">!</span>bNewShipState<span class="br0">)</span>
    <span class="kw2">return</span> <span class="kw6">false</span>;
 
  <span class="co1">// Apply received data as new position of ship chassis.</span>
  newState <span class="sy0">=</span> ChassisState;
  bNewShipState <span class="sy0">=</span> <span class="kw6">false</span>;
 
  <span class="kw2">return</span> <span class="kw6">true</span>;
<span class="br0">}</span>
 
<span class="kw1">function</span> PackState<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">vector</span> chassisPos, chassisLinVel, chassisAngVel;
  <span class="kw1">local</span> <span class="kw5">vector</span> oldPos, oldLinVel;
  <span class="kw1">local</span> <span class="kw5">KRigidBodyState</span> localChassisState;
 
  <span class="co1">// Get chassis state.</span>
  KGetRigidBodyState<span class="br0">(</span>localChassisState<span class="br0">)</span>;
 
  chassisPos <span class="sy0">=</span> KRBVecToVector<span class="br0">(</span>localChassisState.<span class="me0">Position</span><span class="br0">)</span>;
  chassisLinVel <span class="sy0">=</span> KRBVecToVector<span class="br0">(</span>localChassisState.<span class="me0">LinVel</span><span class="br0">)</span>;
  chassisAngVel <span class="sy0">=</span> KRBVecToVector<span class="br0">(</span>localChassisState.<span class="me0">AngVel</span><span class="br0">)</span>;
 
  <span class="co1">// Last position we sent</span>
  oldPos <span class="sy0">=</span> KRBVectoVector<span class="br0">(</span>ShipState.<span class="me0">ChassisPosition</span><span class="br0">)</span>;
  oldLinVel <span class="sy0">=</span> KRBVectoVector<span class="br0">(</span>ShipState.<span class="me0">ChassisLinVel</span><span class="br0">)</span>;
 
  <span class="co1">// See if state has changed enough, or enough time has passed, that we </span>
  <span class="co1">// should send out another update by updating the state struct.</span>
  <span class="kw2">if</span><span class="br0">(</span> <span class="sy0">!</span>KIsAwake<span class="br0">(</span><span class="br0">)</span> <span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">return</span>; <span class="co1">// Never send updates if physics is at rest</span>
  <span class="br0">}</span>
 
  <span class="kw2">if</span><span class="br0">(</span> <span class="kw3">VSize</span><span class="br0">(</span>oldPos <span class="sy0">-</span> chassisPos<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">5</span> <span class="sy0">||</span>
    <span class="kw3">VSize</span><span class="br0">(</span>oldLinVel <span class="sy0">-</span> chassisLinVel<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">1</span> <span class="sy0">||</span>
    <span class="kw3">abs</span><span class="br0">(</span>shipState.<span class="me0">serverSteering</span>.<span class="me0">yaw</span> <span class="sy0">-</span> shipSteering.<span class="me0">yaw</span><span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">0.1</span> <span class="sy0">||</span>
    <span class="kw3">abs</span><span class="br0">(</span>shipState.<span class="me0">serverSteering</span>.<span class="me0">pitch</span> <span class="sy0">-</span> shipSteering.<span class="me0">pitch</span><span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">0.1</span> <span class="sy0">||</span>
    <span class="kw3">abs</span><span class="br0">(</span>shipState.<span class="me0">serverSteering</span>.<span class="me0">roll</span> <span class="sy0">-</span> shipSteering.<span class="me0">roll</span><span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">0.1</span> <span class="sy0">||</span>
    <span class="kw3">VSize</span><span class="br0">(</span>shipState.<span class="me0">serverThrust</span> <span class="sy0">-</span> shipThrust<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">1</span> <span class="sy0">||</span>
    <span class="kw7">Level</span>.<span class="me0">TimeSeconds</span> <span class="sy0">&gt;</span> NextNetUpdateTime <span class="br0">)</span>
  <span class="br0">{</span>
    NextNetUpdateTime <span class="sy0">=</span> <span class="kw7">Level</span>.<span class="me0">TimeSeconds</span> <span class="sy0">+</span> MaxNetUpdateInterval;
  <span class="br0">}</span>
  <span class="kw2">else</span>
  <span class="br0">{</span>
    <span class="kw2">return</span>;
  <span class="br0">}</span>
 
  ShipState.<span class="me0">ChassisPosition</span> <span class="sy0">=</span> localChassisState.<span class="me0">Position</span>;
  ShipState.<span class="me0">ChassisQuaternion</span> <span class="sy0">=</span> localChassisState.<span class="me0">Quaternion</span>;
  ShipState.<span class="me0">ChassisLinVel</span> <span class="sy0">=</span> localChassisState.<span class="me0">LinVel</span>;
  ShipState.<span class="me0">ChassisAngVel</span> <span class="sy0">=</span> localChassisState.<span class="me0">AngVel</span>;
 
  shipState.<span class="me0">serverSteering</span> <span class="sy0">=</span> shipSteering;
  shipState.<span class="me0">serverThrust</span> <span class="sy0">=</span> shipThrust;
 
  <span class="co1">// This flag lets the client know this data is new.</span>
  ShipState.<span class="me0">bNewState</span> <span class="sy0">=</span> <span class="kw6">true</span>;
  <span class="co1">//Make sure ShipState gets replicated</span>
  AVar<span class="sy0">++</span>;
  <span class="kw2">if</span> <span class="br0">(</span>AVar <span class="sy0">&gt;</span> <span class="nu0">10</span><span class="br0">)</span>
    AVar<span class="sy0">=</span><span class="nu0">0</span>;
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">function</span> setInitialState<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
  <span class="kw6">super</span>.<span class="me0">setInitialState</span><span class="br0">(</span><span class="br0">)</span>;
 
  <span class="co1">// don't disable my tick!</span>
  <span class="kw3">enable</span><span class="br0">(</span><span class="st0">'tick'</span><span class="br0">)</span>;
<span class="br0">}</span>
 
 
<span class="kw1">simulated</span> <span class="kw1">event</span> drivingStatusChanged<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
  <span class="kw6">super</span>.<span class="me0">drivingStatusChanged</span><span class="br0">(</span><span class="br0">)</span>;
 
  <span class="co1">// don't disable my tick!</span>
  <span class="kw3">enable</span><span class="br0">(</span><span class="st0">'tick'</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">function</span> KDriverEnter<span class="br0">(</span><span class="kw9">Pawn</span> P<span class="br0">)</span> <span class="br0">{</span>
  <span class="kw6">super</span>.<span class="me0">KDriverEnter</span><span class="br0">(</span>p<span class="br0">)</span>;
 
  <span class="kw2">if</span> <span class="br0">(</span><span class="kw9">PlayerController</span><span class="br0">(</span><span class="kw9">controller</span><span class="br0">)</span> <span class="sy0">!=</span> <span class="kw5">none</span><span class="br0">)</span>
    <span class="kw9">controller</span>.<span class="kw3">gotoState</span><span class="br0">(</span>landMovementState<span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">function</span> prevWeapon<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
  shipSteering.<span class="me0">roll</span> <span class="sy0">=</span> <span class="kw3">fclamp</span><span class="br0">(</span>shipSteering.<span class="me0">roll</span> <span class="sy0">-</span> <span class="br0">(</span>rollUnit <span class="sy0">*</span> turnSensitivity<span class="br0">)</span>, <span class="sy0">-</span>maximumTurnRate, maximumTurnRate<span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">function</span> nextWeapon<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
  shipSteering.<span class="me0">roll</span> <span class="sy0">=</span> <span class="kw3">fclamp</span><span class="br0">(</span>shipSteering.<span class="me0">roll</span> <span class="sy0">+</span> <span class="br0">(</span>rollUnit <span class="sy0">*</span> turnSensitivity<span class="br0">)</span>, <span class="sy0">-</span>maximumTurnRate, maximumTurnRate<span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">function</span> updateRocketAcceleration<span class="br0">(</span><span class="kw5">float</span> deltaTime, <span class="kw5">float</span> yawChange, <span class="kw5">float</span> pitchChange<span class="br0">)</span> <span class="br0">{</span>
  <span class="kw2">if</span> <span class="br0">(</span>deltaTime <span class="sy0">&gt;=</span> turnDecayTime<span class="br0">)</span>
    shipSteering <span class="sy0">=</span> <span class="kw3">rot</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span>;
  <span class="kw2">else</span>
    shipSteering <span class="sy0">*=</span> <span class="br0">(</span>turnDecayTime<span class="sy0">-</span>deltaTime<span class="br0">)</span> <span class="sy0">/</span> turnDecayTime;
 
  <span class="co1">// / 6000 because the aForward, etc. are 6000 by default when the appropriate button is pressed.</span>
  shipThrust <span class="sy0">=</span> <span class="br0">(</span><span class="br0">(</span><span class="br0">(</span><span class="kw3">vect</span><span class="br0">(</span><span class="nu0">1</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span> <span class="sy0">*</span> <span class="kw9">PlayerController</span><span class="br0">(</span><span class="kw9">Controller</span><span class="br0">)</span>.<span class="me0">aForward</span><span class="br0">)</span> <span class="sy0">+</span> <span class="br0">(</span><span class="kw3">vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">1</span>,<span class="nu0">0</span><span class="br0">)</span> <span class="sy0">*</span> <span class="kw9">PlayerController</span><span class="br0">(</span><span class="kw9">Controller</span><span class="br0">)</span>.<span class="me0">aStrafe</span><span class="br0">)</span> <span class="sy0">+</span> <span class="br0">(</span><span class="kw3">vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">1</span><span class="br0">)</span> <span class="sy0">*</span> <span class="kw9">PlayerController</span><span class="br0">(</span><span class="kw9">Controller</span><span class="br0">)</span>.<span class="me0">aUp</span><span class="br0">)</span><span class="br0">)</span> <span class="sy0">/</span> <span class="nu0">6000</span><span class="br0">)</span> <span class="sy0">&gt;&gt;</span> <span class="kw7">rotation</span>;
  <span class="kw2">if</span> <span class="br0">(</span><span class="kw3">vsize</span><span class="br0">(</span>shipThrust<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">1</span><span class="br0">)</span>
    shipThrust <span class="sy0">=</span> <span class="kw3">normal</span><span class="br0">(</span>shipThrust<span class="br0">)</span>;
 
  shipSteering.<span class="me0">yaw</span> <span class="sy0">=</span> <span class="kw3">fclamp</span><span class="br0">(</span>shipSteering.<span class="me0">yaw</span> <span class="sy0">-</span> <span class="br0">(</span>yawChange <span class="sy0">*</span> turnSensitivity<span class="br0">)</span>, <span class="sy0">-</span>maximumTurnRate, maximumTurnRate<span class="br0">)</span>;
  shipSteering.<span class="me0">pitch</span> <span class="sy0">=</span> <span class="kw3">fclamp</span><span class="br0">(</span>shipSteering.<span class="me0">pitch</span> <span class="sy0">+</span> <span class="br0">(</span>pitchChange <span class="sy0">*</span> turnSensitivity<span class="br0">)</span>, <span class="sy0">-</span>maximumTurnRate, maximumTurnRate<span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw4">tick</span><span class="br0">(</span><span class="kw5">float</span> delta<span class="br0">)</span>
<span class="br0">{</span>  <span class="kw6">super</span>.<span class="kw4">tick</span><span class="br0">(</span>delta<span class="br0">)</span>;
 
  <span class="kw2">if</span> <span class="br0">(</span><span class="kw9">controller</span> <span class="sy0">==</span> <span class="kw5">none</span><span class="br0">)</span> <span class="br0">{</span>
    shipThrust <span class="sy0">=</span> <span class="kw3">vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span>;
    shipSteering <span class="sy0">=</span> <span class="kw3">rot</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span>;
  <span class="br0">}</span>
 
  <span class="kw2">if</span><span class="br0">(</span><span class="sy0">!</span>KIsAwake<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> <span class="kw9">controller</span> <span class="sy0">!=</span> <span class="kw5">none</span><span class="br0">)</span>
    KWake<span class="br0">(</span><span class="br0">)</span>;
 
  <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span> <span class="sy0">&amp;&amp;</span> <span class="kw7">Level</span>.<span class="me0">NetMode</span> <span class="sy0">!=</span> NM_StandAlone<span class="br0">)</span>
    PackState<span class="br0">(</span><span class="br0">)</span>;
 
  updateExtraForce<span class="br0">(</span>delta<span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">function</span> updateExtraForce<span class="br0">(</span><span class="kw5">float</span> delta<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">vector</span> worldForward, worldDown, worldLeft;
 
  worldForward <span class="sy0">=</span> <span class="kw3">vect</span><span class="br0">(</span><span class="nu0">1</span>, <span class="nu0">0</span>, <span class="nu0">0</span><span class="br0">)</span> <span class="sy0">&gt;&gt;</span> <span class="kw7">Rotation</span>;
  worldDown <span class="sy0">=</span> <span class="kw3">vect</span><span class="br0">(</span><span class="nu0">0</span>, <span class="nu0">0</span>, <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span> <span class="sy0">&gt;&gt;</span> <span class="kw7">Rotation</span>;
  worldLeft <span class="sy0">=</span> <span class="kw3">vect</span><span class="br0">(</span><span class="nu0">0</span>, <span class="sy0">-</span><span class="nu0">1</span>, <span class="nu0">0</span><span class="br0">)</span> <span class="sy0">&gt;&gt;</span> <span class="kw7">Rotation</span>;
 
  ExtraForce <span class="sy0">=</span> ExtraForce <span class="sy0">+</span> shipThrust <span class="sy0">*</span> maximumThrust <span class="sy0">*</span> delta; <span class="co1">// Speed</span>
  ExtraTorque <span class="sy0">=</span> ExtraTorque <span class="sy0">+</span> worldDown <span class="sy0">*</span> shipSteering.<span class="me0">yaw</span> <span class="sy0">*</span> delta; <span class="co1">// Yaw</span>
  ExtraTorque <span class="sy0">=</span> ExtraTorque <span class="sy0">-</span> worldLeft <span class="sy0">*</span> <span class="sy0">-</span>shipSteering.<span class="me0">pitch</span> <span class="sy0">*</span> delta; <span class="co1">// Pitch</span>
  ExtraTorque <span class="sy0">=</span> ExtraTorque <span class="sy0">+</span> worldForward <span class="sy0">*</span> <span class="sy0">-</span>shipSteering.<span class="me0">roll</span> <span class="sy0">*</span> delta; <span class="co1">// Roll</span>
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">event</span> <span class="kw4">KApplyForce</span><span class="br0">(</span><span class="kw1">out</span> <span class="kw5">vector</span> Force, <span class="kw1">out</span> <span class="kw5">vector</span> Torque<span class="br0">)</span>
<span class="br0">{</span>
  <span class="co1">// This actually does the applying of the piled up force</span>
  Force <span class="sy0">=</span> ExtraForce;
  Torque <span class="sy0">=</span> ExtraTorque;
  ExtraForce <span class="sy0">=</span> <span class="kw3">vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span>;
  ExtraTorque <span class="sy0">=</span> <span class="kw3">vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">DefaultProperties</span>
<span class="br0">{</span>
  landMovementState<span class="sy0">=</span>PlayerSpaceFlying
 
  rollUnit<span class="sy0">=</span><span class="nu0">1024</span>
 
  turnDecayTime<span class="sy0">=</span><span class="nu0">0.5</span>
  turnSensitivity<span class="sy0">=</span><span class="nu0">0.5</span>
  maximumTurnRate<span class="sy0">=</span><span class="nu0">5000</span>
  maximumThrust<span class="sy0">=</span><span class="nu0">2500</span>
<span class="br0">}</span>
</pre></div>
</div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> FlyingDog <span class="kw1">extends</span> KShip <span class="kw1">placeable</span> <span class="kw1">CacheExempt</span>;
 
<span class="co1">// triggers used to get into the FlyingDog</span>
<span class="kw1">var</span> <span class="kw1">const</span> <span class="kw5">vector</span>  FrontTriggerOffset;
<span class="kw1">var</span> SVehicleTrigger  FLTrigger, FRTrigger;
 
<span class="co1">// Maximum speed at which you can get in the vehicle.</span>
<span class="kw1">var</span> <span class="br0">(</span>FlyingDog<span class="br0">)</span> <span class="kw5">float</span> TriggerSpeedThresh;
<span class="kw1">var</span> <span class="kw5">bool</span>      TriggerState; <span class="co1">// true for on, false for off.</span>
 
<span class="co1">// Destroyed Buggy</span>
<span class="kw1">var</span> <span class="br0">(</span>FlyingDog<span class="br0">)</span> class<span class="sy0">&lt;</span>Actor<span class="sy0">&gt;</span>  DestroyedEffect;
<span class="kw1">var</span> <span class="br0">(</span>FlyingDog<span class="br0">)</span> <span class="kw5">sound</span>         DestroyedSound;
 
<span class="co1">// Weapon</span>
<span class="kw1">var</span>       <span class="kw5">float</span> FireCountdown;
 
<span class="kw1">var</span> <span class="br0">(</span>FlyingDog<span class="br0">)</span> <span class="kw5">float</span>   FireInterval;
<span class="kw1">var</span> <span class="br0">(</span>FlyingDog<span class="br0">)</span> <span class="kw5">vector</span>  weaponFireOffset;
 
<span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw4">PostNetBeginPlay</span><span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">vector</span> RotX, RotY, RotZ;
 
  <span class="kw6">Super</span>.<span class="kw4">PostNetBeginPlay</span><span class="br0">(</span><span class="br0">)</span>;
 
  <span class="kw3">GetAxes</span><span class="br0">(</span><span class="kw7">Rotation</span>,RotX,RotY,RotZ<span class="br0">)</span>;
 
  <span class="co1">// Only have triggers on server</span>
  <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Level</span>.<span class="me0">NetMode</span> <span class="sy0">!=</span> NM_Client<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="co1">// Create triggers for gettting into the FlyingDog</span>
    FLTrigger <span class="sy0">=</span> <span class="kw4">spawn</span><span class="br0">(</span><span class="kw1">class</span><span class="st0">'SVehicleTrigger'</span>, <span class="kw6">self</span>,, <span class="kw7">Location</span> <span class="sy0">+</span> FrontTriggerOffset.<span class="me0">X</span> <span class="sy0">*</span> RotX <span class="sy0">+</span> FrontTriggerOffset.<span class="me0">Y</span> <span class="sy0">*</span> RotY <span class="sy0">+</span> FrontTriggerOffset.<span class="me0">Z</span> <span class="sy0">*</span> RotZ<span class="br0">)</span>;
    FLTrigger.<span class="kw4">SetBase</span><span class="br0">(</span><span class="kw6">self</span><span class="br0">)</span>;
    FLTrigger.<span class="kw4">SetCollision</span><span class="br0">(</span><span class="kw6">true</span>, <span class="kw6">false</span>, <span class="kw6">false</span><span class="br0">)</span>;
 
    FRTrigger <span class="sy0">=</span> <span class="kw4">spawn</span><span class="br0">(</span><span class="kw1">class</span><span class="st0">'SVehicleTrigger'</span>, <span class="kw6">self</span>,, <span class="kw7">Location</span> <span class="sy0">+</span> FrontTriggerOffset.<span class="me0">X</span> <span class="sy0">*</span> RotX <span class="sy0">-</span> FrontTriggerOffset.<span class="me0">Y</span> <span class="sy0">*</span> RotY <span class="sy0">+</span> FrontTriggerOffset.<span class="me0">Z</span> <span class="sy0">*</span> RotZ<span class="br0">)</span>;
    FRTrigger.<span class="kw4">SetBase</span><span class="br0">(</span><span class="kw6">self</span><span class="br0">)</span>;
    FRTrigger.<span class="kw4">SetCollision</span><span class="br0">(</span><span class="kw6">true</span>, <span class="kw6">false</span>, <span class="kw6">false</span><span class="br0">)</span>;
 
    TriggerState <span class="sy0">=</span> <span class="kw6">true</span>;
  <span class="br0">}</span>
 
  <span class="co1">// If this is not 'authority' version - don't destroy it if there is a problem.</span>
  <span class="co1">// The network should sort things out.</span>
  <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">!=</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw8">KarmaParams</span><span class="br0">(</span>KParams<span class="br0">)</span>.<span class="me0">bDestroyOnSimError</span> <span class="sy0">=</span> <span class="kw6">False</span>;
  <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">event</span> <span class="kw4">Destroyed</span><span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="co1">// Clean up random stuff attached to the car</span>
  <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Level</span>.<span class="me0">NetMode</span> <span class="sy0">!=</span> NM_Client<span class="br0">)</span>
  <span class="br0">{</span>
    FLTrigger.<span class="kw4">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
    FRTrigger.<span class="kw4">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
  <span class="br0">}</span>
 
  <span class="kw6">Super</span>.<span class="kw4">Destroyed</span><span class="br0">(</span><span class="br0">)</span>;
 
  <span class="co1">// Trigger destroyed sound and effect</span>
  <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Level</span>.<span class="me0">NetMode</span> <span class="sy0">!=</span> NM_DedicatedServer<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw4">spawn</span><span class="br0">(</span>DestroyedEffect, <span class="kw6">self</span>, , <span class="kw7">Location</span> <span class="br0">)</span>;
    <span class="kw4">PlaySound</span><span class="br0">(</span>DestroyedSound<span class="br0">)</span>;
  <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="kw1">function</span> KDriverEnter<span class="br0">(</span><span class="kw9">Pawn</span> p<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw6">Super</span>.<span class="me0">KDriverEnter</span><span class="br0">(</span>p<span class="br0">)</span>;
 
  p.<span class="me0">bHidden</span> <span class="sy0">=</span> <span class="kw6">True</span>;
  ReceiveLocalizedMessage<span class="br0">(</span><span class="kw1">class</span><span class="st0">'Vehicles.BulldogMessage'</span>, <span class="nu0">1</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">function</span> <span class="kw5">bool</span> KDriverLeave<span class="br0">(</span><span class="kw5">bool</span> bForceLeave<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw9">Pawn</span> OldDriver;
 
  OldDriver <span class="sy0">=</span> Driver;
 
  <span class="co1">// If we succesfully got out of the car, make driver visible again.</span>
  <span class="kw2">if</span><span class="br0">(</span> <span class="kw6">Super</span>.<span class="me0">KDriverLeave</span><span class="br0">(</span>bForceLeave<span class="br0">)</span> <span class="br0">)</span>
  <span class="br0">{</span>
    OldDriver.<span class="me0">bHidden</span> <span class="sy0">=</span> <span class="kw6">false</span>;
    <span class="kw9">AmbientSound</span> <span class="sy0">=</span> <span class="kw5">None</span>;
    <span class="kw2">return</span> <span class="kw6">true</span>;
  <span class="br0">}</span>
  <span class="kw2">else</span>
    <span class="kw2">return</span> <span class="kw6">false</span>;
<span class="br0">}</span>
 
<span class="kw1">function</span> fireWeapons<span class="br0">(</span><span class="kw5">bool</span> bWasAltFire<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">vector</span> FireLocation;
  <span class="kw1">local</span> <span class="kw9">PlayerController</span> PC;
 
  <span class="co1">// Client can't do firing</span>
  <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">!=</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span>
    <span class="kw2">return</span>;
 
  FireLocation <span class="sy0">=</span> <span class="kw7">Location</span> <span class="sy0">+</span> <span class="br0">(</span>weaponFireOffset <span class="sy0">&gt;&gt;</span> <span class="kw7">Rotation</span><span class="br0">)</span>;
 
  <span class="kw2">while</span><span class="br0">(</span>FireCountdown <span class="sy0">&lt;=</span> <span class="nu0">0</span><span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span><span class="br0">(</span><span class="sy0">!</span>bWasAltFire<span class="br0">)</span>
    <span class="br0">{</span>
      <span class="kw4">spawn</span><span class="br0">(</span><span class="kw1">class</span><span class="st0">'PROJ_TurretSkaarjPlasma'</span>, <span class="kw6">self</span>, , FireLocation, <span class="kw7">rotation</span><span class="br0">)</span>;
 
      <span class="co1">// Play firing noise</span>
      <span class="kw4">PlaySound</span><span class="br0">(</span><span class="kw5">Sound</span><span class="st0">'ONSVehicleSounds-S.Laser02'</span>, <span class="kw7">SLOT_None</span>,,,,, <span class="kw6">false</span><span class="br0">)</span>;
      PC <span class="sy0">=</span> <span class="kw9">PlayerController</span><span class="br0">(</span><span class="kw9">Controller</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>PC <span class="sy0">!=</span> <span class="kw5">None</span> <span class="sy0">&amp;&amp;</span> PC.<span class="me0">bEnableWeaponForceFeedback</span><span class="br0">)</span>
        PC.<span class="me0">ClientPlayForceFeedback</span><span class="br0">(</span><span class="st0">"RocketLauncherFire"</span><span class="br0">)</span>;
    <span class="br0">}</span>
    <span class="kw2">else</span>
    <span class="br0">{</span>
      <span class="kw4">spawn</span><span class="br0">(</span><span class="kw1">class</span><span class="st0">'PROJ_SpaceFighter_Rocket'</span>, <span class="kw6">self</span>, , FireLocation, <span class="kw5">rotator</span><span class="br0">(</span><span class="kw5">vector</span><span class="br0">(</span><span class="kw7">rotation</span><span class="br0">)</span> <span class="sy0">+</span> <span class="kw3">Vrand</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">*</span> <span class="nu0">0.05</span><span class="br0">)</span><span class="br0">)</span>;
 
      <span class="co1">// Play firing noise</span>
      <span class="kw4">PlaySound</span><span class="br0">(</span><span class="kw5">Sound</span><span class="st0">'AssaultSounds.HnShipFire01'</span>, <span class="kw7">SLOT_None</span>,,,,, <span class="kw6">false</span><span class="br0">)</span>;
      PC <span class="sy0">=</span> <span class="kw9">PlayerController</span><span class="br0">(</span><span class="kw9">Controller</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>PC <span class="sy0">!=</span> <span class="kw5">None</span> <span class="sy0">&amp;&amp;</span> PC.<span class="me0">bEnableWeaponForceFeedback</span><span class="br0">)</span>
        PC.<span class="me0">ClientPlayForceFeedback</span><span class="br0">(</span><span class="st0">"RocketLauncherFire"</span><span class="br0">)</span>;
    <span class="br0">}</span>
 
    FireCountdown <span class="sy0">+=</span> FireInterval;
  <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="co1">// Fire a rocket (if we've had time to reload!)</span>
<span class="kw1">function</span> VehicleFire<span class="br0">(</span><span class="kw5">bool</span> bWasAltFire<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw6">Super</span>.<span class="me0">VehicleFire</span><span class="br0">(</span>bWasAltFire<span class="br0">)</span>;
 
  <span class="kw2">if</span><span class="br0">(</span>FireCountdown <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">)</span>
  <span class="br0">{</span>
    FireCountdown <span class="sy0">=</span> <span class="nu0">0</span>;
    fireWeapons<span class="br0">(</span>bWasAltFire<span class="br0">)</span>;
  <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw4">Tick</span><span class="br0">(</span><span class="kw5">float</span> Delta<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">Local</span> <span class="kw5">float</span> VMag;
 
  <span class="kw6">Super</span>.<span class="kw4">Tick</span><span class="br0">(</span>Delta<span class="br0">)</span>;
 
  <span class="co1">// Weapons (run on server and replicated to client)</span>
  <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span>
  <span class="br0">{</span>
    <span class="co1">// Countdown to next shot</span>
    FireCountdown <span class="sy0">-=</span> Delta;
 
    <span class="co1">// This is for sustained barrages.</span>
    <span class="co1">// Primary fire takes priority</span>
    <span class="kw2">if</span><span class="br0">(</span>bVehicleIsFiring<span class="br0">)</span>
      fireWeapons<span class="br0">(</span><span class="kw6">false</span><span class="br0">)</span>;
    <span class="kw2">else</span> <span class="kw2">if</span><span class="br0">(</span>bVehicleIsAltFiring<span class="br0">)</span>
      fireWeapons<span class="br0">(</span><span class="kw6">true</span><span class="br0">)</span>;
  <span class="br0">}</span>
 
  <span class="co1">// Dont have triggers on network clients.</span>
  <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Level</span>.<span class="me0">NetMode</span> <span class="sy0">!=</span> NM_Client<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="co1">// If vehicle is moving, disable collision for trigger.</span>
    VMag <span class="sy0">=</span> <span class="kw3">VSize</span><span class="br0">(</span><span class="kw7">Velocity</span><span class="br0">)</span>;
 
    <span class="kw2">if</span><span class="br0">(</span>VMag <span class="sy0">&lt;</span> TriggerSpeedThresh <span class="sy0">&amp;&amp;</span> TriggerState <span class="sy0">==</span> <span class="kw6">false</span><span class="br0">)</span>
    <span class="br0">{</span>
      FLTrigger.<span class="kw4">SetCollision</span><span class="br0">(</span><span class="kw6">true</span>, <span class="kw6">false</span>, <span class="kw6">false</span><span class="br0">)</span>;
      FRTrigger.<span class="kw4">SetCollision</span><span class="br0">(</span><span class="kw6">true</span>, <span class="kw6">false</span>, <span class="kw6">false</span><span class="br0">)</span>;
      TriggerState <span class="sy0">=</span> <span class="kw6">true</span>;
    <span class="br0">}</span>
    <span class="kw2">else</span> <span class="kw2">if</span><span class="br0">(</span>VMag <span class="sy0">&gt;</span> TriggerSpeedThresh <span class="sy0">&amp;&amp;</span> TriggerState <span class="sy0">==</span> <span class="kw6">true</span><span class="br0">)</span>
    <span class="br0">{</span>
      FLTrigger.<span class="kw4">SetCollision</span><span class="br0">(</span><span class="kw6">false</span>, <span class="kw6">false</span>, <span class="kw6">false</span><span class="br0">)</span>;
      FRTrigger.<span class="kw4">SetCollision</span><span class="br0">(</span><span class="kw6">false</span>, <span class="kw6">false</span>, <span class="kw6">false</span><span class="br0">)</span>;
      TriggerState <span class="sy0">=</span> <span class="kw6">false</span>;
    <span class="br0">}</span>
  <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="co1">// Really simple at the moment!</span>
<span class="kw1">function</span> <span class="kw4">TakeDamage</span><span class="br0">(</span><span class="kw5">int</span> Damage, <span class="kw9">Pawn</span> instigatedBy, <span class="kw5">Vector</span> hitlocation,
            <span class="kw5">Vector</span> momentum, class<span class="sy0">&lt;</span>DamageType<span class="sy0">&gt;</span> <span class="kw9">damageType</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="co1">// Avoid damage healing the car!</span>
  <span class="kw2">if</span><span class="br0">(</span>Damage <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">)</span>
    <span class="kw2">return</span>;
 
  <span class="kw2">if</span><span class="br0">(</span><span class="kw9">damageType</span> <span class="sy0">==</span> <span class="kw1">class</span><span class="st0">'DamTypeSuperShockBeam'</span><span class="br0">)</span>
    Health <span class="sy0">-=</span> <span class="nu0">100</span>; <span class="co1">// Instagib doesn't work on vehicles</span>
  <span class="kw2">else</span>
    Health <span class="sy0">-=</span> <span class="nu0">0.5</span> <span class="sy0">*</span> Damage; <span class="co1">// Weapons do less damage</span>
 
  <span class="co1">// The vehicle is dead!</span>
  <span class="kw2">if</span><span class="br0">(</span>Health <span class="sy0">&lt;=</span> <span class="nu0">0</span><span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span> <span class="br0">(</span> <span class="kw9">Controller</span> <span class="sy0">!=</span> <span class="kw5">None</span> <span class="br0">)</span>
    <span class="br0">{</span>
      <span class="kw2">if</span><span class="br0">(</span> <span class="kw9">Controller</span>.<span class="me0">bIsPlayer</span> <span class="br0">)</span>
      <span class="br0">{</span>
        ClientKDriverLeave<span class="br0">(</span><span class="kw9">PlayerController</span><span class="br0">(</span><span class="kw9">Controller</span><span class="br0">)</span><span class="br0">)</span>; <span class="co1">// Just to reset HUD etc.</span>
        <span class="kw9">Controller</span>.<span class="me0">PawnDied</span><span class="br0">(</span><span class="kw6">self</span><span class="br0">)</span>; <span class="co1">// This should unpossess the controller and let the player respawn</span>
      <span class="br0">}</span>
      <span class="kw2">else</span>
        <span class="kw9">Controller</span>.<span class="kw4">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
    <span class="br0">}</span>
 
    <span class="kw4">Destroy</span><span class="br0">(</span><span class="br0">)</span>; <span class="co1">// Destroy the vehicle itself (see Destroyed below)</span>
  <span class="br0">}</span>
 
    <span class="co1">//KAddImpulse(momentum, hitlocation);</span>
<span class="br0">}</span>
 
<span class="co1">// AI Related code</span>
<span class="kw1">function</span> <span class="kw9">Actor</span> GetBestEntry<span class="br0">(</span><span class="kw9">Pawn</span> P<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw2">if</span> <span class="br0">(</span> <span class="kw3">VSize</span><span class="br0">(</span>P.<span class="kw7">Location</span> <span class="sy0">-</span> FLTrigger.<span class="kw7">Location</span><span class="br0">)</span> <span class="sy0">&lt;</span> <span class="kw3">VSize</span><span class="br0">(</span>P.<span class="kw7">Location</span> <span class="sy0">-</span> FRTrigger.<span class="kw7">Location</span><span class="br0">)</span> <span class="br0">)</span>
    <span class="kw2">return</span> FLTrigger;
  <span class="kw2">return</span> FRTrigger;
<span class="br0">}</span>
 
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
  <span class="kw7">DrawType</span><span class="sy0">=</span><span class="kw7">DT_StaticMesh</span>
  <span class="kw5">StaticMesh</span><span class="sy0">=</span><span class="kw5">StaticMesh</span><span class="st0">'BulldogMeshes.Simple.S_Chassis'</span>
 
  <span class="kw2">Begin</span> <span class="kw8">Object</span> <span class="kw1">Class</span><span class="sy0">=</span><span class="kw8">KarmaParamsRBFull</span> <span class="kw5">Name</span><span class="sy0">=</span>KParams0
    KActorGravScale<span class="sy0">=</span><span class="nu0">0</span>
    KInertiaTensor<span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">=</span><span class="nu0">20</span>
    KInertiaTensor<span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">=</span><span class="nu0">0</span>
    KInertiaTensor<span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span><span class="sy0">=</span><span class="nu0">0</span>
    KInertiaTensor<span class="br0">(</span><span class="nu0">3</span><span class="br0">)</span><span class="sy0">=</span><span class="nu0">30</span>
    KInertiaTensor<span class="br0">(</span><span class="nu0">4</span><span class="br0">)</span><span class="sy0">=</span><span class="nu0">0</span>
    KInertiaTensor<span class="br0">(</span><span class="nu0">5</span><span class="br0">)</span><span class="sy0">=</span><span class="nu0">48</span>
    KCOMOffset<span class="sy0">=</span><span class="br0">(</span>X<span class="sy0">=</span><span class="nu0">0.8</span>,Y<span class="sy0">=</span><span class="nu0">0.0</span>,Z<span class="sy0">=-</span><span class="nu0">0.7</span><span class="br0">)</span>
    KStartEnabled<span class="sy0">=</span><span class="kw6">True</span>
    KFriction<span class="sy0">=</span><span class="nu0">1.6</span>
    KLinearDamping<span class="sy0">=</span><span class="nu0">1</span>
    KAngularDamping<span class="sy0">=</span><span class="nu0">10</span>
    bKNonSphericalInertia<span class="sy0">=</span><span class="kw6">False</span>
    bHighDetailOnly<span class="sy0">=</span><span class="kw6">False</span>
    bClientOnly<span class="sy0">=</span><span class="kw6">False</span>
    bKDoubleTickRate<span class="sy0">=</span><span class="kw6">True</span>
    <span class="kw5">Name</span><span class="sy0">=</span><span class="st0">"KParams0"</span>
  End <span class="kw8">Object</span>
  KParams<span class="sy0">=</span><span class="kw8">KarmaParams</span><span class="st0">'KParams0'</span>
 
  <span class="kw7">DrawScale</span><span class="sy0">=</span><span class="nu0">0.4</span>
  <span class="kw7">drawScale3D</span><span class="sy0">=</span><span class="br0">(</span>x<span class="sy0">=-</span><span class="nu0">1</span>,y<span class="sy0">=</span><span class="nu0">1</span>,z<span class="sy0">=</span><span class="nu0">1</span><span class="br0">)</span>
 
  DestroyedEffect<span class="sy0">=</span><span class="kw1">class</span><span class="st0">'XEffects.RocketExplosion'</span>
  DestroyedSound<span class="sy0">=</span><span class="kw5">sound</span><span class="st0">'WeaponSounds.P1RocketLauncherAltFire'</span>
 
  FrontTriggerOffset<span class="sy0">=</span><span class="br0">(</span>X<span class="sy0">=</span><span class="nu0">0</span>,Y<span class="sy0">=</span><span class="nu0">165</span>,Z<span class="sy0">=</span><span class="nu0">10</span><span class="br0">)</span>
 
  TriggerSpeedThresh<span class="sy0">=</span><span class="nu0">40</span>
 
  <span class="co1">// Weaponry</span>
  FireInterval<span class="sy0">=</span><span class="nu0">0.1</span>
  weaponFireOffset<span class="sy0">=</span><span class="br0">(</span>X<span class="sy0">=</span><span class="nu0">0</span>,Y<span class="sy0">=</span><span class="nu0">0</span>,Z<span class="sy0">=</span><span class="nu0">80</span><span class="br0">)</span>
 
  <span class="co1">// Driver positions</span>
  ExitPositions<span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">=</span><span class="br0">(</span>X<span class="sy0">=</span><span class="nu0">0</span>,Y<span class="sy0">=</span><span class="nu0">200</span>,Z<span class="sy0">=</span><span class="nu0">100</span><span class="br0">)</span>
  ExitPositions<span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">=</span><span class="br0">(</span>X<span class="sy0">=</span><span class="nu0">0</span>,Y<span class="sy0">=-</span><span class="nu0">200</span>,Z<span class="sy0">=</span><span class="nu0">100</span><span class="br0">)</span>
  ExitPositions<span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span><span class="sy0">=</span><span class="br0">(</span>X<span class="sy0">=</span><span class="nu0">350</span>,Y<span class="sy0">=</span><span class="nu0">0</span>,Z<span class="sy0">=</span><span class="nu0">100</span><span class="br0">)</span>
  ExitPositions<span class="br0">(</span><span class="nu0">3</span><span class="br0">)</span><span class="sy0">=</span><span class="br0">(</span>X<span class="sy0">=-</span><span class="nu0">350</span>,Y<span class="sy0">=</span><span class="nu0">0</span>,Z<span class="sy0">=</span><span class="nu0">100</span><span class="br0">)</span>
 
  DrivePos<span class="sy0">=</span><span class="br0">(</span>X<span class="sy0">=-</span><span class="nu0">165</span>,Y<span class="sy0">=</span><span class="nu0">0</span>,Z<span class="sy0">=-</span><span class="nu0">100</span><span class="br0">)</span>
 
  Health<span class="sy0">=</span><span class="nu0">800</span>
  HealthMax<span class="sy0">=</span><span class="nu0">800</span>
 
  <span class="kw7">SoundRadius</span><span class="sy0">=</span><span class="nu0">255</span>
<span class="br0">}</span>
</pre></div>
</div>

<!-- 
NewPP limit report
CPU time usage: 0.194 seconds
Real time usage: 2.124 seconds
Preprocessor visited node count: 10/1000000
Preprocessor generated node count: 64/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key wiki:pcache:idhash:1587-0!*!*!*!*!*!* and timestamp 20161215135027 and revision id 42913
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://wiki.beyondunreal.com/Legacy:KShip?oldid=42913">https://wiki.beyondunreal.com/Legacy:KShip?oldid=42913</a>"</div>
					<div id='catlinks' class='catlinks catlinks-allhidden'></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-legacy" class="selected"><a href="Legacy_KShip.html">Legacy</a></li>
				<li id="ca-talk" class="new"><a href="https://wiki.beyondunreal.com/edit/Legacy_talk:KShip?redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-edit"><a href="https://wiki.beyondunreal.com/edit/Legacy:KShip" title="You can edit this page. Please use the preview button before saving [e]" accesskey="e">Edit</a></li>
				<li id="ca-history"><a href="https://wiki.beyondunreal.com/history/Legacy:KShip" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-createaccount"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=Legacy%3AKShip&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=Legacy%3AKShip" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="index.html" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-mainpage"><a href="index.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li>
											<li id="n-portal"><a href="Unreal_Wiki_Community_portal-2.html" title="About the project, what you can do, where to find things">Community portal</a></li>
											<li id="n-recentchanges"><a href="https://wiki.beyondunreal.com/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="https://wiki.beyondunreal.com/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
											<li id="n-Forums-.28General.29"><a href="https://forums.beyondunreal.com/forums/wiki-general.250/" rel="nofollow">Forums (General)</a></li>
											<li id="n-Forums-.28Technical.29"><a href="https://forums.beyondunreal.com/forums/wiki-technical.251/" rel="nofollow">Forums (Technical)</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="https://wiki.beyondunreal.com/" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Unreal Wiki [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="https://wiki.beyondunreal.com/Special:WhatLinksHere/Legacy:KShip" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="https://wiki.beyondunreal.com/Special:RecentChangesLinked/Legacy:KShip" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="https://wiki.beyondunreal.com/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="https://wiki.beyondunreal.com/Legacy:KShip?printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="https://wiki.beyondunreal.com/Legacy:KShip?oldid=42913" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="https://wiki.beyondunreal.com/info/Legacy:KShip" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="../licensebuttons.net/l/by-nc-sa/3.0/88x31.png" alt="Attribution-Noncommercial-Share Alike 3.0" width="88" height="31" /></a>
							</div>
					<div id="f-poweredbyico">
									<script async src="../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
        <!-- Home Page -->
        <ins class="adsbygoogle"
             style="display:inline-block;width:728px;height:90px"
             data-ad-client="ca-pub-9605963037553244"
             data-ad-slot="9528541415"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
							</div>
					<ul id="f-list">
									<li id="lastmod"> Last modified at 10:32, 17 April 2010.</li>
									<li id="copyright">Licensed as <a href="Unreal_Wiki_Copyrights.html" title="Unreal Wiki:Copyrights">Attribution-Noncommercial-Share Alike 3.0</a>.</li>
									<li id="privacy"><a href="Unreal_Wiki_Privacy_policy.html" title="Unreal Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="Unreal_Wiki_About.html" title="Unreal Wiki:About">About Unreal Wiki</a></li>
									<li id="disclaimer"><a href="Unreal_Wiki_General_disclaimer.html" title="Unreal Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.beyondunreal.com/w/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=monobook\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":72});
}</script></body>
<!-- Mirrored from wiki.beyondunreal.com/Legacy:KShip by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 09:35:25 GMT -->
</html>
