<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.beyondunreal.com/User:Wormbo/Dying_spree_mutator by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 07:52:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>User:Wormbo/Dying spree mutator - Unreal Wiki</title>
<meta name="generator" content="MediaWiki 1.25.1" />
<link rel="shortcut icon" href="../w/uewiki-favicon.png" />
<link rel="search" type="application/opensearchdescription+xml" href="../w/opensearch_desc.php" title="Unreal Wiki" />
<link rel="EditURI" type="application/rsd+xml" href="../w/api251f.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Dying_spree_mutator.html" />
<link rel="copyright" href="../Unreal_Wiki_Copyrights.html" />
<link rel="alternate" type="application/atom+xml" title="Unreal Wiki Atom feed" href="https://wiki.beyondunreal.com/Special:RecentChanges?feed=atom" />
<link rel="stylesheet" href="../w/load2743.css?debug=false&amp;lang=en&amp;modules=ext.geshi.language.uscript%7Cmediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if IE 6]><link rel="stylesheet" href="/w/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/w/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="../w/load484a.css?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=monobook&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: wiki:resourceloader:filter:minify-css:7:29b70323345a439ab9ed7007e0c178a6 */</style>
<script src="../w/load9316.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"User","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":2,"wgPageName":"User:Wormbo/Dying_spree_mutator","wgTitle":"Wormbo/Dying spree mutator","wgCurRevisionId":44683,"wgRevisionId":44683,"wgArticleId":29210,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Programming tutorials"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"User:Wormbo/Dying_spree_mutator","wgRelevantArticleId":29210,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgRelevantUserName":"Wormbo","wgCategoryTreePageCategoryOptions":"{\"mode\":0,\"hideprefix\":20,\"showcount\":true,\"namespaces\":false}"});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: wiki:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-2 ns-subject page-User_Wormbo_Dying_spree_mutator skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
									<div id="siteNotice"><div id="localNotice" lang="en" dir="ltr"><p>I search for solutions in this order: Past Code, Unreal Source, Wiki, BUF, groups.yahoo, google, screaming at monitor. &#8211;Â RegularX
</p></div></div>
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">User:Wormbo/Dying spree mutator</h1>

				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Unreal Wiki, The Unreal Engine Documentation Site</div>
					<div id="contentSub"><span class="subpages">&lt; <a href="../User_Wormbo.html" title="User:Wormbo">User:Wormbo</a></span></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>The goal of this <a href="../UnrealScript.html" title="UnrealScript">UnrealScript</a> tutorial is to create a small mutator that tracks and broadcasts "dying sprees", i.e. consecutive deaths of a player without any kill by that player. This tutorial is mainly targeted towards <a href="../UT2004.html" title="UT2004" class="mw-redirect">UT2004</a>, but I hope I got the <a href="../UT.html" title="UT" class="mw-redirect">UT</a>, <a href="../UT3.html" title="UT3" class="mw-redirect">UT3</a> and <a href="../UT2003.html" title="UT2003" class="mw-redirect">UT2003</a> parts right as well. (I didn't compile a single line of code for this article, so in case of errors or problems, please leave a note on the <a href="../User_talk_Wormbo/Dying_spree_mutator.html" title="User talk:Wormbo/Dying spree mutator">discussion page</a>.)</p>
<p></p>
<div id="toc" class="toc">
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Before_we_start"><span class="tocnumber">1</span> <span class="toctext">Before we start</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Getting_started"><span class="tocnumber">2</span> <span class="toctext">Getting started</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Adding_the_mutator"><span class="tocnumber">3</span> <span class="toctext">Adding the mutator</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Setting_up_the_GameRules"><span class="tocnumber">4</span> <span class="toctext">Setting up the GameRules</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Detecting_player_kills"><span class="tocnumber">5</span> <span class="toctext">Detecting player kills</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Keeping_track_of_player_deaths"><span class="tocnumber">6</span> <span class="toctext">Keeping track of player deaths</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Maintaining_the_players_list"><span class="tocnumber">7</span> <span class="toctext">Maintaining the players list</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Maintaining_the_players_list_in_UT"><span class="tocnumber">8</span> <span class="toctext">Maintaining the players list in UT</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Broadcasting_spree_messages"><span class="tocnumber">9</span> <span class="toctext">Broadcasting spree messages</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Adding_SelfSpreeNote_to_UT"><span class="tocnumber">10</span> <span class="toctext">Adding SelfSpreeNote to UT</span></a></li>
</ul>
</div>
<p></p>
<h2><span class="mw-headline" id="Before_we_start">Before we start</span></h2>
<p>While this tutorial centers around a very simple idea, its main goal is to teach you how to modify rules of the game, not how to manage your project. Please find other "getting started" tutorials if you need help with the project setup. The legacy part of this wiki contains <a href="../Legacy_UnrealScript_Hello_World.html" title="Legacy:UnrealScript Hello World">"Hello World" examples for UT/UT200x</a> and <a href="../Legacy_UT3_Hello_World.html" title="Legacy:UT3 Hello World">for UT3</a>. Personally I use <a href="../UnCodeX.html" title="UnCodeX">UnCodeX</a> and (at least for UE1/2 projects) <a href="https://wiki.beyondunreal.com/edit/UMake?redlink=1" class="new" title="UMake (page does not exist)">UMake</a>, so I simply tell UnCodeX to create a subclass in a new package (for this tutorial I will use the project name "DyingSpree"), optionally adjust the EditPackages list in UMake and my project is ready to compile. Please refer to <a href="https://wiki.beyondunreal.com/edit/WOTgreal?redlink=1" class="new" title="WOTgreal (page does not exist)">WOTgreal</a> or <a href="https://wiki.beyondunreal.com/edit/NFringe?redlink=1" class="new" title="NFringe (page does not exist)">nFringe</a> tutorials if you use one of those IDEs instead.</p>
<h2><span class="mw-headline" id="Getting_started">Getting started</span></h2>
<p>Before we start hacking in some code, we first need to figure out what exactly we need. The goal is to count player deaths and detect kills that might reset the count. Fortunately there's a perfect function for this: ScoreKill. In UT (and the UDK) it is part of the <a href="../UE1_Mutator_(UT).html" title="UE1:Mutator (UT)">Mutator</a> class, later engine generations moved many Mutator functions related to the gameplay rules (including ScoreKill) to the <a href="../UE2_GameRules_(UT2004).html" title="UE2:GameRules (UT2004)">GameRules</a> class. A Mutator class is required anyway to activate our Dying Spree mod.</p>
<p>In other words, if you are working with UT or the UDK, only create the Mutator subclass. You can use any name you want, but for this tutorial I will use the UT200x naming convention and call it "MutDyingSpree". If you are using UT3, make sure to subclass <a href="../UE3_UTMutator_(UT3).html" title="UE3:UTMutator (UT3)">UTMutator</a> instead. For UT200x or UT3 you also need a GameRules subclass, which I will call "DyingSpreeRules" in this tutorial. If you compile the project at this point you should get DyingSpree.u in the System directory for UT/UT200x or UTGame\Unpublished\CookedPC\Scripts directory for UT3.</p>
<h2><span class="mw-headline" id="Adding_the_mutator">Adding the mutator</span></h2>
<p>Now to tell the game about the new mutator.</p>
<p>For UT and UT2003 you will need to create a <a href="https://wiki.beyondunreal.com/edit/Localization_file?redlink=1" class="new" title="Localization file (page does not exist)">localization file</a> and add your mutator information to it. Since the project is called DyingSpree (causing the package to have the name DyingSpree.u), the obvious choice for the localization file is "DyingSpree.int". As always in UE1/2, this file belongs in the System directory. It is a plain text file, so you can open it in Notepad or any other editor you like. Add the following two lines to it, save and open the game to check the mutators list:</p>
<pre>
[Public]
Object=(Name=DyingSpree.MutDyingSpree,Class=Class,MetaClass=Engine.Mutator,Description="Dying Sprees,Announce when a player dies multiple times in a row without making any kills.")
</pre>
<p>UT2003 doesn't use the description part, so you can leave it out entirely. For UT the part of the Description value before the first comma is the mutator name, everything after the first comma is the description. If there's no comma, the entire value is used as mutator name.</p>
<p>For UT2003 and UT2004 the name and description are stored in the mutator class as default values of the FriendlyName and Description properties respectively. Create a <a href="../Defaultproperties.html" title="Defaultproperties">defaultproperties</a> section in MutDyingSpree.uc and add the two values:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> MutDyingSpree <span class="kw1">extends</span> <span class="kw9">Mutator</span>;
 
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
  FriendlyName<span class="sy0">=</span><span class="st0">"Dying Sprees"</span>
  Description<span class="sy0">=</span><span class="st0">"Announce when a player dies multiple times in a row without making any kills."</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>Recompile to ensure everything is syntactically correct. UT2004 will create a <a href="https://wiki.beyondunreal.com/edit/UCL_file?redlink=1" class="new" title="UCL file (page does not exist)">UCL file</a> with the name "DyingSpree.ucl" containing the mutator's class, name and description. You may have to delete it and recompile if you make changes to the FriendlyName or Description values.</p>
<p>UT3 and the UDK use a special <a href="https://wiki.beyondunreal.com/edit/INI_file?redlink=1" class="new" title="INI file (page does not exist)">INI file</a> to store information about the mutator and a localization file for the name and description. For our simple example we will put them in the INI file as well. (I don't know about UDK here, you might have to use the localization file.) In our case the INI file should be called "UTDyingSpree.ini" and is located in the UTGame\Config directory. Make sure it contains the following lines:</p>
<pre>
[MutDyingSpree UTUIDataProvider_Mutator]
ClassName=DyingSpree.MutDyingSpree
FriendlyName=Dying Sprees
Description=Announce when a player dies multiple times in a row without making any kills.
</pre>
<p>Keep or remove the other lines as you like, they don't really matter as they are the default values anyway.</p>
<h2><span class="mw-headline" id="Setting_up_the_GameRules">Setting up the GameRules</span></h2>
<p>You can skip this step in UT and the UDK as it doesn't apply. Instead, put any code in the MutDyingSpree class.</p>
<p>Ok, since ScoreKill is only called for GameRules, not for a Mutator, we need to set up our DyingSpreeRules. The ideal place for this is the MutDyingSpree's initialization, for example the PostBeginPlay function. Let's use that to spawn and register our DyingSpreeRules:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> <span class="kw4">PostBeginPlay</span><span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="co1">// only for UT200x:</span>
  <span class="kw7">Level</span>.<span class="kw7">Game</span>.<span class="me0">AddGameModifier</span><span class="br0">(</span><span class="kw4">Spawn</span><span class="br0">(</span><span class="kw1">class</span><span class="st0">'DyingSpreeRules'</span><span class="br0">)</span><span class="br0">)</span>;
 
  <span class="co1">// only for UT3:</span>
  WorldInfo.<span class="kw7">Game</span>.<span class="me0">AddGameRules</span><span class="br0">(</span><span class="kw1">class</span><span class="st0">'DyingSpreeRules'</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p>This not only creates our rules modifier, but also tells the game to call ScoreKill (and a few other functions) when appropriate.</p>
<p>This kind of manual registration is not necessary for the mutator itself because that is automatically registered when the game creates it.</p>
<h2><span class="mw-headline" id="Detecting_player_kills">Detecting player kills</span></h2>
<p>Now to implement our kill/death detection. For UT and UDK this happens in the MutDyingSpree class, UT200x and UT3 do this in the DyingSpreeRules.</p>
<p>Rule number 1 when overriding Mutator or GameRules functions: These usually call the next rule/mutator's implementation, so make sure you don't break the chain! If you are not sure if you are overriding a such a function or a "normal" function, simply call the super class implementation. At this point you might wonder why we didn't do that for PostBeginPlay. Well, PostBeginPlay is declared in the Actor class, but neither there, nor in Info or Mutator it is overridden to contain any code. Calling the super class implementation there wouldn't have any effect so we can safely omit it.</p>
<p>Let's override ScoreKill:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> ScoreKill<span class="br0">(</span><span class="kw9">Controller</span> Killer, <span class="kw9">Controller</span> Killed<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw6">Super</span>.<span class="me0">ScoreKill</span><span class="br0">(</span>Killer, Killed<span class="br0">)</span>;
  <span class="kw3">log</span><span class="br0">(</span>Killer<span class="sy0">@</span><span class="st0">"killed"</span><span class="sy0">@</span>Killed<span class="br0">)</span>; <span class="co1">// use `log(...) instead for UT3 and UDK</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>In UT the two parameters are of type <a href="../UE1_Pawn_(UT).html" title="UE1:Pawn (UT)">Pawn</a> instead of <a href="../UE2_Controller_(UT2004).html" title="UE2:Controller (UT2004)">Controller</a>.</p>
<p>This doesn't do much yet, except write a line to the log file whenever ScoreKill is called. Compile and try playing an Instant Action or Practice Session with the Dying Sprees mutator. Switch to window mode ("endfullscreen") and open the log ("showlog") to see the live log. Whenever a player dies, the "A killed B" line should show up now. UT2004 should be started with the -makenames parameter ("D:\Path\To\UT2004.exe" -makenames) to make the output meaningful, as otherwise you will only see something like "XPawn killed XPawn". The parameter ensures the game adds numbers to the object names, like UT and UT3 do. Play around with different ways to die (e.g. suicide command, killed by weapon fire, jump into lava, add and remove bots) to get a feel for the ScoreKill function's parameter values.</p>
<p>You can also try starting a local dedicated server with your mutator and connect to it. This will allow you to figure out what happens when you die while becoming a spectator or because you are about to disconnect. Your ScoreKill logs will only be added to the server's log file, not the client's. This is an important little fact: Mutators and GameRules only get their functions called on the server!</p>
<h2><span class="mw-headline" id="Keeping_track_of_player_deaths">Keeping track of player deaths</span></h2>
<p>I hope you figured out how the Killer and Killed parameters of ScoreKill relate to the death of players. For reference: Killer is either None or the same as Killed if it was a death the player was responsible for, i.e. a suicide. Killer is something else than None or Killed if one player killed another. That means, whenever a player appears on the Killed side, we should increment that player's death spree. If a player appears on the Killer side <i>but not on the Killed side</i>, that player's dying spree should be reset.</p>
<p>Let's express that in terms of UnrealScript code:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> ScoreKill<span class="br0">(</span><span class="kw9">Controller</span> Killer, <span class="kw9">Controller</span> Killed<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw6">Super</span>.<span class="me0">ScoreKill</span><span class="br0">(</span>Killer, Killed<span class="br0">)</span>;
 
  <span class="co1">// Killed is never None</span>
  <span class="kw3">log</span><span class="br0">(</span>Killed<span class="sy0">@</span><span class="st0">"died, increment spree"</span><span class="br0">)</span>;
 
  <span class="kw2">if</span> <span class="br0">(</span>Killer <span class="sy0">!=</span> <span class="kw5">None</span> <span class="sy0">&amp;&amp;</span> Killer <span class="sy0">!=</span> Killed<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="co1">// one player killed another</span>
 
    <span class="kw3">log</span><span class="br0">(</span>Killer<span class="sy0">@</span><span class="st0">"killed someone else, reset dying spree"</span><span class="br0">)</span>;
  <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>So that's the basic logic. Next we need to figure out how to store each player's current dying spree. As a mutator our mod shouldn't touch the Controller or PlayerReplicationInfo, so let's just keep a list of players and their dying sprees in a variable in our Mutator/GameRules class. Each entry in this list will contain two items, the player and the current spree counter. This can be done with an array of <a href="../Struct.html" title="Struct" class="mw-redirect">structs</a>. The struct could be declared as follows:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">struct</span> DyingSpreeCount
<span class="br0">{</span>
  <span class="kw1">var</span> <span class="kw9">Controller</span> <span class="kw8">Player</span>; <span class="co1">// use type Pawn for UT instead</span>
  <span class="kw1">var</span> <span class="kw5">int</span> SpreeCount;
<span class="br0">}</span>;
</pre></div>
</div>
<p>The variable to hold our list is simply an array of that struct type. UT doesn't have <a href="../Dynamic_arrays.html" title="Dynamic arrays">dynamic arrays</a>, so we need to use a <a href="../Static_array.html" title="Static array" class="mw-redirect">static array</a> there.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="co1">// only for UT200x and later:</span>
<span class="kw1">var</span> array<span class="sy0">&lt;</span>DyingSpreeCount<span class="sy0">&gt;</span> DyingSprees;
<span class="co1">// only for UT:</span>
<span class="kw1">var</span> DyingSpreeCount DyingSprees<span class="br0">[</span><span class="nu0">32</span><span class="br0">]</span>; <span class="co1">// supporting up to 32 players</span>
</pre></div>
</div>
<p>So we know where to store the sprees and when to increment or reset them, but how are we going to keep track of the players? Since this is different for UT, we will need to branch here. Accessing arrays and struct members to increment or reset the counter is the same in all versions, only picking the correct array index and adding players to the array will be different. Let's encapsulate that task in a function, say, GetPlayerIndex.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> ScoreKill<span class="br0">(</span><span class="kw9">Controller</span> Killer, <span class="kw9">Controller</span> Killed<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">int</span> PlayerIndex;
 
  <span class="kw6">Super</span>.<span class="me0">ScoreKill</span><span class="br0">(</span>Killer, Killed<span class="br0">)</span>;
 
  <span class="co1">// increment Killed's dying spree count</span>
  PlayerIndex <span class="sy0">=</span> GetPlayerIndex<span class="br0">(</span>Killed<span class="br0">)</span>;
  DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="me0">SpreeCount</span><span class="sy0">++</span>;
 
  <span class="kw2">if</span> <span class="br0">(</span>Killer <span class="sy0">!=</span> <span class="kw5">None</span> <span class="sy0">&amp;&amp;</span> Killer <span class="sy0">!=</span> Killed<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="co1">// one player killed another</span>
 
    <span class="co1">// reset Killer's dying spree count</span>
    PlayerIndex <span class="sy0">=</span> GetPlayerIndex<span class="br0">(</span>Killer<span class="br0">)</span>;
    DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="me0">SpreeCount</span> <span class="sy0">=</span> <span class="nu0">0</span>;
  <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="coMULTI">/**
Returns an index into DyingSprees array for the specified player.
The player is added to the array if encountered for the first time.
*/</span>
<span class="kw1">function</span> <span class="kw5">int</span> GetPlayerIndex<span class="br0">(</span><span class="kw9">Controller</span> <span class="kw8">Player</span><span class="br0">)</span> <span class="co1">// Pawn instead of Controller for UT</span>
<span class="br0">{</span>
  <span class="co1">// TODO</span>
<span class="br0">}</span>
</pre></div>
</div>
<h2><span class="mw-headline" id="Maintaining_the_players_list">Maintaining the players list</span></h2>
<p>This is probably the most complicated part of the entire mutator. As mentioned before, UT requires a different strategy, so we will focus on the other versions first. You should still read this section, as it points out problems that need to be solved in the UT version as well.</p>
<p>The main task of GetPlayerIndex is to return an index value. To do so, it needs to perform a linear search on the DyingSprees array to find the index with the player's entry. If no such entry exists, it can just create a new entry and add it at the end of the list.</p>
<p>UE3 is really easy to use here, because it provides dynamic array operations for these steps:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> <span class="kw5">int</span> GetPlayerIndex<span class="br0">(</span><span class="kw9">Controller</span> <span class="kw8">Player</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">int</span> PlayerIndex;
 
  <span class="co1">// look up existing player entry</span>
  PlayerIndex <span class="sy0">=</span> DyingSprees.<span class="me0">Find</span><span class="br0">(</span><span class="st0">'Player'</span>, <span class="kw8">Player</span><span class="br0">)</span>;
 
  <span class="kw2">if</span> <span class="br0">(</span>PlayerIndex <span class="sy0">==</span> INDEX_NONE<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="co1">// entry not found, create one</span>
    PlayerIndex <span class="sy0">=</span> DyingSprees.<span class="me0">Length</span>;
    DyingSprees.<span class="me0">Add</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>; <span class="co1">// adds entry at end of list with zero spree count and empty player</span>
    DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="kw8">Player</span> <span class="sy0">=</span> <span class="kw8">Player</span>;
  <span class="br0">}</span>
  <span class="kw2">return</span> PlayerIndex;
<span class="br0">}</span>
</pre></div>
</div>
<p>Nice and clean, right? Ok, UT200x doesn't have those convenient array operations, so we need to do everything manually there:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> <span class="kw5">int</span> GetPlayerIndex<span class="br0">(</span><span class="kw9">Controller</span> <span class="kw8">Player</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">int</span> PlayerIndex;
 
  <span class="co1">// look up existing player entry</span>
  <span class="kw2">for</span> <span class="br0">(</span>PlayerIndex <span class="sy0">=</span> <span class="nu0">0</span>; PlayerIndex <span class="sy0">&lt;</span> DyingSprees.<span class="me0">Length</span> <span class="sy0">&amp;&amp;</span> DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="kw8">Player</span> <span class="sy0">!=</span> <span class="kw8">Player</span>; PlayerIndex<span class="sy0">++</span><span class="br0">)</span>;
 
  <span class="kw2">if</span> <span class="br0">(</span>PlayerIndex <span class="sy0">==</span> DyingSprees.<span class="me0">Length</span><span class="br0">)</span>
  <span class="br0">{</span>
    <span class="co1">// entry not found, create one</span>
    DyingSprees.<span class="me0">Length</span> <span class="sy0">=</span> PlayerIndex <span class="sy0">+</span> <span class="nu0">1</span>; <span class="co1">// adds entry at end of list with zero spree count and empty player</span>
    DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="kw8">Player</span> <span class="sy0">=</span> <span class="kw8">Player</span>;
  <span class="br0">}</span>
  <span class="kw2">return</span> PlayerIndex;
<span class="br0">}</span>
</pre></div>
</div>
<p>In case you were wondering: That first thing is a <a href="../For.html" title="For" class="mw-redirect">for</a> loop with an empty body. We don't need any body there, the condition will stop the look as soon as the index reaches the end of the list or the player is found. Unlike the array Find operation we end up with the index being the array length instead of the value of the INDEX_NONE constant, which is -1.</p>
<p>Now this approach will work nicely, but there's a small part we haven't considered yet. What happens if a player leaves the game? Quite simple: The player's Controller is destroyed and leaves an empty slot in our list. Our code simply skips the empty slot, but as players come and go, the list gets longer and longer, which makes our code slower and slower. As you can tell, that's a bad thing, so let's remove those empty slots while we're here. We're already iterating over the list to find the player's index, so how about we just remove any empty slots we come across? We can easily do that by extending the for loop:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
  <span class="kw2">for</span> <span class="br0">(</span>PlayerIndex <span class="sy0">=</span> <span class="nu0">0</span>; PlayerIndex <span class="sy0">&lt;</span> DyingSprees.<span class="me0">Length</span>; PlayerIndex<span class="sy0">++</span><span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span> <span class="br0">(</span>DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="kw8">Player</span> <span class="sy0">==</span> <span class="kw8">Player</span><span class="br0">)</span>
      <span class="kw2">break</span>; <span class="co1">// found the player, let's ignore further empty slots for now</span>
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="kw8">Player</span> <span class="sy0">==</span> <span class="kw5">None</span><span class="br0">)</span>
      DyingSprees.<span class="me0">Remove</span><span class="br0">(</span>PlayerIndex<span class="sy0">--</span>, <span class="nu0">1</span><span class="br0">)</span>; <span class="co1">// decrement the index because otherwise we'd skip the next entry</span>
  <span class="br0">}</span>
</pre></div>
</div>
<p>There, all empty slots up to the player's index are now removed. We don't care about empty slots after the player because our primary goal is to find the player. Removing empty slots is just a side effect that speeds up the next call to GetPlayerIndex.</p>
<p>What about UT3? It's the same problem there, so we could just copy over the UT200x code. We'd loose the quick lookup of the natively implemented Find operation, though. You know what? Let's be lazy! GetPlayerIndex is called quite often, so if we remove one empty slot at a time, that would end up having the same result at some point. Players leaving the game doesn't happen too often, so we don't need to waste time doing perfect cleanup.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> <span class="kw5">int</span> GetPlayerIndex<span class="br0">(</span><span class="kw9">Controller</span> <span class="kw8">Player</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">int</span> PlayerIndex;
 
  <span class="co1">// check if any empty slots need to be cleaned up</span>
  PlayerIndex <span class="sy0">=</span> DyingSprees.<span class="me0">Find</span><span class="br0">(</span><span class="st0">'Player'</span>, <span class="kw5">None</span><span class="br0">)</span>;
  <span class="kw2">if</span> <span class="br0">(</span>PlayerIndex <span class="sy0">!=</span> INDEX_NONE<span class="br0">)</span>
    DyingSprees.<span class="me0">Remove</span><span class="br0">(</span>PlayerIndex, <span class="nu0">1</span><span class="br0">)</span>; <span class="co1">// remove this empty slot</span>
 
  <span class="co1">// look up existing player entry</span>
  ...
<span class="br0">}</span>
</pre></div>
</div>
<p>Granted, in the worst case (no empty slots and player not in the list) this implementation needs to iterate over the entire list twice (once for finding empty slots, once for finding the player), but Find is implemented in native code, which makes it much faster than a loop in UnrealScript. The number of players in the game is limited, so an extra native pass over the list really won't make much difference.</p>
<h2><span class="mw-headline" id="Maintaining_the_players_list_in_UT">Maintaining the players list in UT</span></h2>
<p>As mentioned before, UT lacks dynamic arrays, so we need to work on a static array. It's not possible to add or remove elements at runtime, so we have two options left. Either we just leave empty slots where they appear or we compact the list, moving all further elements down to close the gaps. The latter approach allows us to keep track of the highest slot in use, which can be used to optimize the linear search. On the other hand, there are only 32 elements in the array and moving elements around to close gaps is complicated. For this tutorial I'll pick the first approach (the lazy one again) and leave it to you to come up with the implementation for the optimized approach.</p>
<p>So, the general implementation will end up being similar to the UT2004 version above. The difference obviously is that new players may end up being added in "dirty" slots that require resetting the spree counter. Also, the search will not only need to skip empty slots, but also need to remember one of them, in case there's no room for a new player at the end of the array.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> <span class="kw5">int</span> GetPlayerIndex<span class="br0">(</span><span class="kw9">Pawn</span> <span class="kw8">Player</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">int</span> PlayerIndex, FirstEmptySlot;
 
  <span class="co1">// look up existing player entry</span>
  FirstEmptySlot <span class="sy0">=</span> <span class="sy0">-</span><span class="nu0">1</span>;
  <span class="kw2">for</span> <span class="br0">(</span>PlayerIndex <span class="sy0">=</span> <span class="nu0">0</span>; PlayerIndex <span class="sy0">&lt;</span> ArrayCount<span class="br0">(</span>DyingSprees<span class="br0">)</span>; PlayerIndex<span class="sy0">++</span><span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span> <span class="br0">(</span>DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="kw8">Player</span> <span class="sy0">==</span> <span class="kw8">Player</span><span class="br0">)</span>
      <span class="kw2">break</span>; <span class="co1">// found the player, let's ignore further empty slots for now</span>
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="kw8">Player</span> <span class="sy0">==</span> <span class="kw5">None</span> <span class="sy0">&amp;&amp;</span> FirstEmptySlot <span class="sy0">==</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span>
      FirstEmptySlot <span class="sy0">=</span> PlayerIndex; <span class="co1">// if player is not in the list, add here</span>
 
  <span class="br0">}</span>
 
  <span class="kw2">if</span> <span class="br0">(</span>PlayerIndex <span class="sy0">==</span> ArrayCount<span class="br0">(</span>DyingSprees<span class="br0">)</span><span class="br0">)</span>
  <span class="br0">{</span>
    <span class="co1">// entry not found, use the first empty slot</span>
    PlayerIndex <span class="sy0">=</span> FirstEmptySlot;
    DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="kw8">Player</span> <span class="sy0">=</span> <span class="kw8">Player</span>;
    DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="me0">SpreeCount</span> <span class="sy0">=</span> <span class="nu0">0</span>;
  <span class="br0">}</span>
  <span class="kw2">return</span> PlayerIndex;
<span class="br0">}</span>
</pre></div>
</div>
<p>Right, that should be about it. There's a minor problem with this approach: If there are more than 32 players, GetPlayerIndex may return 32, causing array out of bound warnings. I'll leave it to you to figure out a fix or workaround.</p>
<h2><span class="mw-headline" id="Broadcasting_spree_messages">Broadcasting spree messages</span></h2>
<p>Now that our mutator keeps track of who died how often, it's time to actually print out the corresponding messages. Because dying sprees are quite similar to killing sprees, we can just reuse the killing spree messages and add our own text and audio to them. Find your game's killing spree message (see example list below) and create a subclass called DyingSpreeMessage.</p>
<ul>
<li><a href="../UE1_KillingSpreeMessage_(UT).html" title="UE1:KillingSpreeMessage (UT)">KillingSpreeMessage (UT)</a></li>
<li><a href="../UE2_KillingSpreeMessage_(UT2003).html" title="UE2:KillingSpreeMessage (UT2003)">KillingSpreeMessage (UT2003)</a></li>
<li><a href="../UE2_KillingSpreeMessage_(UT2004).html" title="UE2:KillingSpreeMessage (UT2004)">KillingSpreeMessage (UT2004)</a></li>
<li><a href="../UE3_UTKillingSpreeMessage_(UT3).html" title="UE3:UTKillingSpreeMessage (UT3)">UTKillingSpreeMessage (UT3)</a></li>
</ul>
<p>The killing spree message class should already contain all the logic for creating the proper messages, so all you need to do is adjusting the messages and sounds in defaultproperties:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> DyingSpreeMessage <span class="kw1">extends</span> KillingSpreeMessage;
 
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
  EndSpreeNote<span class="sy0">=</span><span class="st0">" ended the dying spree by killing"</span>
  EndSpreeNoteTrailer<span class="sy0">=</span><span class="st0">""</span>
  SpreeNote<span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">=</span><span class="st0">"is on a dying spree!"</span>
  SpreeNote<span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">=</span><span class="st0">"is being bullied!"</span>
  SpreeNote<span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span><span class="sy0">=</span><span class="st0">"is being dominated!"</span>
  SpreeNote<span class="br0">(</span><span class="nu0">3</span><span class="br0">)</span><span class="sy0">=</span><span class="st0">"is being annihilated!"</span>
  SpreeNote<span class="br0">(</span><span class="nu0">4</span><span class="br0">)</span><span class="sy0">=</span><span class="st0">"no longer seems to be playing!"</span>
  SpreeNote<span class="br0">(</span><span class="nu0">5</span><span class="br0">)</span><span class="sy0">=</span><span class="st0">"is synonymous for 'being dead'!"</span>
 
  SelfSpreeNote<span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">=</span><span class="st0">"Dying Spree!"</span>
  SelfSpreeNote<span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">=</span><span class="st0">"Bullied!"</span>
  SelfSpreeNote<span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span><span class="sy0">=</span><span class="st0">"Dominated!"</span>
  SelfSpreeNote<span class="br0">(</span><span class="nu0">3</span><span class="br0">)</span><span class="sy0">=</span><span class="st0">"Annihilated!"</span>
  SelfSpreeNote<span class="br0">(</span><span class="nu0">4</span><span class="br0">)</span><span class="sy0">=</span><span class="st0">"Are you still playing?"</span>
  SelfSpreeNote<span class="br0">(</span><span class="nu0">5</span><span class="br0">)</span><span class="sy0">=</span><span class="st0">"You like being dead, right?"</span>
 
  <span class="co1">// these need to be "SpreeSoundName" instead of "SpreeSound" for UT2004</span>
  SpreeSound<span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">=</span><span class="kw5">None</span>
  SpreeSound<span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">=</span><span class="kw5">None</span>
  SpreeSound<span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span><span class="sy0">=</span><span class="kw5">None</span>
  SpreeSound<span class="br0">(</span><span class="nu0">3</span><span class="br0">)</span><span class="sy0">=</span><span class="kw5">None</span>
  SpreeSound<span class="br0">(</span><span class="nu0">4</span><span class="br0">)</span><span class="sy0">=</span><span class="kw5">None</span>
  SpreeSound<span class="br0">(</span><span class="nu0">5</span><span class="br0">)</span><span class="sy0">=</span><span class="kw5">None</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>Interestingly the spree text and sound variable names are identical across all UT versions. Only UT doesn't have SelfSpreeNote, so you can't use that without some sort of work-around. Note that UT and UT200x actually allow a spree index from 0 to 9, while UT3 only has room for up to index 5.</p>
<p>Ok, text messages are in place and the mutator tracks sprees. Time to add the broadcasting code to ScoreKill:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> ScoreKill<span class="br0">(</span><span class="kw9">Controller</span> Killer, <span class="kw9">Controller</span> Killed<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">int</span> PlayerIndex, SpreeLevel;
 
  <span class="kw6">Super</span>.<span class="me0">ScoreKill</span><span class="br0">(</span>Killer, Killed<span class="br0">)</span>;
 
  <span class="co1">// increment Killed's dying spree count</span>
  PlayerIndex <span class="sy0">=</span> GetPlayerIndex<span class="br0">(</span>Killed<span class="br0">)</span>;
  DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="me0">SpreeCount</span><span class="sy0">++</span>;
  <span class="kw2">if</span> <span class="br0">(</span>DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="me0">SpreeCount</span> <span class="sy0">%</span> <span class="nu0">5</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span>
  <span class="br0">{</span>
    SpreeLevel <span class="sy0">=</span> DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="me0">SpreeCount</span> <span class="sy0">/</span> <span class="nu0">5</span>;
    <span class="kw2">if</span> <span class="br0">(</span>SpreeLevel <span class="sy0">&lt;</span> ArrayCount<span class="br0">(</span><span class="kw1">class</span><span class="st0">'DyingSpreeMessage'</span>.<span class="kw1">default</span>.<span class="me0">SpreeNote</span><span class="br0">)</span><span class="br0">)</span>
      BroadcastLocalizedMessage<span class="br0">(</span><span class="kw1">class</span><span class="st0">'DyingSpreeMessage'</span>, SpreeLevel <span class="sy0">-</span> <span class="nu0">1</span>, Killed.<span class="me0">PlayerReplicationInfo</span><span class="br0">)</span>;
  <span class="br0">}</span>
 
  <span class="kw2">if</span> <span class="br0">(</span>Killer <span class="sy0">!=</span> <span class="kw5">None</span> <span class="sy0">&amp;&amp;</span> Killer <span class="sy0">!=</span> Killed<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="co1">// one player killed another</span>
 
    <span class="co1">// reset Killer's dying spree count</span>
    PlayerIndex <span class="sy0">=</span> GetPlayerIndex<span class="br0">(</span>Killer<span class="br0">)</span>;
    <span class="kw2">if</span> <span class="br0">(</span>DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="me0">SpreeCount</span> <span class="sy0">&gt;=</span> <span class="nu0">5</span><span class="br0">)</span>
      BroadcastLocalizedMessage<span class="br0">(</span><span class="kw1">class</span><span class="st0">'DyingSpreeMessage'</span>, <span class="nu0">0</span>, Killer.<span class="me0">PlayerReplicationInfo</span>, Killed.<span class="me0">PlayerReplicationInfo</span><span class="br0">)</span>;
    DyingSprees<span class="br0">[</span>PlayerIndex<span class="br0">]</span>.<span class="me0">SpreeCount</span> <span class="sy0">=</span> <span class="nu0">0</span>;
  <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>That's it, unless you implement this in UT. Time to compile and play-test your masterpiece.</p>
<h2><span class="mw-headline" id="Adding_SelfSpreeNote_to_UT">Adding SelfSpreeNote to UT</span></h2>
<p>As mentioned above, the SelfSpreeNote array isn't available in UT. Just declaring the array isn't enough, UT is actually missing the function <i>GetRelatedString</i>() from later engine generations that is called if the message is displayed for the player owning RelatedPRI1. From inside <i>GetString</i>() there is no way to know whether the string is requested for the RelatedPRI1 player. To get around this limitation we will make use of the OptionalObject parameter of the LocalMessage, which is not used for killing sprees and therefore available for our little workaround. The idea is to put the receiving player's PlayerReplicationInfo into the OptionalObject so GetString() can check whether it needs to display a different text. Of course we also need to declare the missing SelfSpreeNote array to our DyingSpreeMessage class. Variable declarations go somewhere below the class declaration, but above the first function or state declaration.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">var</span> <span class="kw1">localized</span> <span class="kw5">string</span> SelfSpreeNote<span class="br0">[</span>ArrayCount<span class="br0">(</span>SpreeNote<span class="br0">)</span><span class="br0">]</span>;
</pre></div>
</div>
<p>Using <a href="../ArrayCount.html" title="ArrayCount" class="mw-redirect">ArrayCount</a> for the array size here ensures the array has the same size as the SpreeNote array.</p>
<p>So how are we going to put the receiving player's PRI into the OptionalObject? One way would be to send the message already with the proper OptionalObject value, but we'd have to replace the convenient BroadcastLocalizedMessage() call with a loop over all players and handle everything that function does. An easier way is to perform the modification when the message arrives at the client via the ClientReceive() function in the message class itself:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">static</span> <span class="kw1">function</span> ClientReceive<span class="br0">(</span>PlayerPawn P, <span class="kw1">optional</span> <span class="kw5">int</span> MessageSwitch, <span class="kw1">optional</span> PlayerReplicationInfo RelatedPRI1, <span class="kw1">optional</span> PlayerReplicationInfo RelatedPRI2, <span class="kw1">optional</span> <span class="kw8">Object</span> OptionalObject<span class="br0">)</span>
<span class="br0">{</span>
  <span class="co1">// set OptionalObject to receiving player's PRI</span>
  <span class="kw6">Super</span>.<span class="me0">ClientReceive</span><span class="br0">(</span>P, MessageSwitch, RelatedPRI1, RelatedPRI2, P.<span class="me0">PlayerReplicationInfo</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p>Yes, that's it. The ClientReceive() implementation in the LocalMessage class adds the message to the HUD, so if we call it with the modified OptionalObject parameter (the last one in the Super call), it will do exactly what we wanted. The only thing left to do is getting GetString() to actually return the SelfSpreeNote now, so we need to override that in our DyingSpreeMessage class as well. Before we do that, let's have a look at the GetRelatedString() function from UT2004, so we know what we are actually trying to achieve:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">static</span> <span class="kw1">function</span> <span class="kw5">string</span> GetRelatedString<span class="br0">(</span>
    <span class="kw1">optional</span> <span class="kw5">int</span> <span class="kw2">Switch</span>,
    <span class="kw1">optional</span> PlayerReplicationInfo RelatedPRI_1, 
    <span class="kw1">optional</span> PlayerReplicationInfo RelatedPRI_2,
    <span class="kw1">optional</span> <span class="kw8">Object</span> OptionalObject
    <span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw2">if</span> <span class="br0">(</span> RelatedPRI_2 <span class="sy0">==</span> <span class="kw5">None</span> <span class="br0">)</span>
		<span class="kw2">return</span> <span class="kw1">Default</span>.<span class="me0">SelfSpreeNote</span><span class="br0">[</span><span class="kw2">Switch</span><span class="br0">]</span>;
 
    <span class="kw2">return</span> <span class="kw1">static</span>.<span class="me0">GetString</span><span class="br0">(</span><span class="kw2">Switch</span>,RelatedPRI_1,RelatedPRI_2,OptionalObject<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p>What happens here is a check for RelatedPRI2 being None, which means it's an ongoing killing spree, not the end of a spree. Our dying spree message works the same way - RelatedPRI2 is none while the spree continues and not None when the player manages to end the spree. Note that the end of the spree uses the same string for all players.</p>
<p>With that knowledge, we can add special handling for the case that RelatedPRI1 belongs to the receiving player and RelatedPRI2 is empty:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">static</span> <span class="kw1">function</span> <span class="kw5">string</span> GetString<span class="br0">(</span><span class="kw1">optional</span> <span class="kw5">int</span> MessageSwitch, <span class="kw1">optional</span> PlayerReplicationInfo RelatedPRI1, <span class="kw1">optional</span> PlayerReplicationInfo RelatedPRI2, <span class="kw1">optional</span> <span class="kw8">Object</span> OptionalObject<span class="br0">)</span>
<span class="br0">{</span>
  <span class="co1">// if displayed for receiving player and not end of spree</span>
  <span class="kw2">if</span> <span class="br0">(</span>RelatedPRI1 <span class="sy0">==</span> OptionalObject <span class="sy0">&amp;&amp;</span> ReplatedPRI2 <span class="sy0">==</span> <span class="kw5">None</span><span class="br0">)</span>
    <span class="kw2">return</span> <span class="kw1">default</span>.<span class="me0">SelfSpreeNote</span><span class="br0">[</span>MessageSwitch<span class="br0">]</span>; <span class="co1">// display shorter message</span>
 
  <span class="co1">// else display the longer text</span>
  <span class="kw2">return</span> <span class="kw6">Super</span>.<span class="me0">GetString</span><span class="br0">(</span>MessageSwitch, RelatedPRI1, RelatedPRI2, OptionalObject<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p>Now the UT version should be ready for compiling and play-testing as well.</p>

<!-- 
NewPP limit report
CPU time usage: 0.227 seconds
Real time usage: 0.230 seconds
Preprocessor visited node count: 181/1000000
Preprocessor generated node count: 420/1000000
Postâexpand include size: 55/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key wiki:pcache:idhash:29210-0!*!0!!en!*!* and timestamp 20161215141709 and revision id 44683
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://wiki.beyondunreal.com/User:Wormbo/Dying_spree_mutator?oldid=44683">https://wiki.beyondunreal.com/User:Wormbo/Dying_spree_mutator?oldid=44683</a>"</div>
					<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="https://wiki.beyondunreal.com/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="../Category_Programming_tutorials.html" title="Category:Programming tutorials">Programming tutorials</a></li></ul></div></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-user" class="selected"><a href="Dying_spree_mutator.html" title="View the user page [c]" accesskey="c">User page</a></li>
				<li id="ca-talk"><a href="../User_talk_Wormbo/Dying_spree_mutator.html" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="https://wiki.beyondunreal.com/edit/User:Wormbo/Dying_spree_mutator" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="https://wiki.beyondunreal.com/history/User:Wormbo/Dying_spree_mutator" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-createaccount"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=User%3AWormbo%2FDying+spree+mutator&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=User%3AWormbo%2FDying+spree+mutator" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="../index.html" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-mainpage"><a href="../index.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li>
											<li id="n-portal"><a href="../Unreal_Wiki_Community_portal-2.html" title="About the project, what you can do, where to find things">Community portal</a></li>
											<li id="n-recentchanges"><a href="https://wiki.beyondunreal.com/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="https://wiki.beyondunreal.com/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
											<li id="n-Forums-.28General.29"><a href="https://forums.beyondunreal.com/forums/wiki-general.250/" rel="nofollow">Forums (General)</a></li>
											<li id="n-Forums-.28Technical.29"><a href="https://forums.beyondunreal.com/forums/wiki-technical.251/" rel="nofollow">Forums (Technical)</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="https://wiki.beyondunreal.com/" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Unreal Wiki [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="https://wiki.beyondunreal.com/Special:WhatLinksHere/User:Wormbo/Dying_spree_mutator" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="https://wiki.beyondunreal.com/Special:RecentChangesLinked/User:Wormbo/Dying_spree_mutator" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-contributions"><a href="https://wiki.beyondunreal.com/Special:Contributions/Wormbo" title="A list of contributions of this user">User contributions</a></li>
											<li id="t-log"><a href="https://wiki.beyondunreal.com/Special:Log/Wormbo">Logs</a></li>
											<li id="t-specialpages"><a href="https://wiki.beyondunreal.com/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="https://wiki.beyondunreal.com/User:Wormbo/Dying_spree_mutator?printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="https://wiki.beyondunreal.com/User:Wormbo/Dying_spree_mutator?oldid=44683" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="https://wiki.beyondunreal.com/info/User:Wormbo/Dying_spree_mutator" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="../../licensebuttons.net/l/by-nc-sa/3.0/88x31.png" alt="Attribution-Noncommercial-Share Alike 3.0" width="88" height="31" /></a>
							</div>
					<div id="f-poweredbyico">
									<script async src="../../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
        <!-- Home Page -->
        <ins class="adsbygoogle"
             style="display:inline-block;width:728px;height:90px"
             data-ad-client="ca-pub-9605963037553244"
             data-ad-slot="9528541415"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
							</div>
					<ul id="f-list">
									<li id="lastmod"> Last modified at 02:47, 2 October 2011.</li>
									<li id="copyright">Licensed as <a href="../Unreal_Wiki_Copyrights.html" title="Unreal Wiki:Copyrights">Attribution-Noncommercial-Share Alike 3.0</a>.</li>
									<li id="privacy"><a href="../Unreal_Wiki_Privacy_policy.html" title="Unreal Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="../Unreal_Wiki_About.html" title="Unreal Wiki:About">About Unreal Wiki</a></li>
									<li id="disclaimer"><a href="../Unreal_Wiki_General_disclaimer.html" title="Unreal Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.beyondunreal.com/w/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=monobook\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":72});
}</script></body>
<!-- Mirrored from wiki.beyondunreal.com/User:Wormbo/Dying_spree_mutator by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 07:52:49 GMT -->
</html>
