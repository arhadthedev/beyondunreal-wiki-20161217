<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.beyondunreal.com/User:Wormbo/Vauss_Cannon_(UT2004) by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 07:52:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>User:Wormbo/Vauss Cannon (UT2004) - Unreal Wiki</title>
<meta name="generator" content="MediaWiki 1.25.1" />
<link rel="shortcut icon" href="../w/uewiki-favicon.png" />
<link rel="search" type="application/opensearchdescription+xml" href="../w/opensearch_desc.php" title="Unreal Wiki" />
<link rel="EditURI" type="application/rsd+xml" href="../w/api251f.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Vauss_Cannon_(UT2004).html" />
<link rel="copyright" href="../Unreal_Wiki_Copyrights.html" />
<link rel="alternate" type="application/atom+xml" title="Unreal Wiki Atom feed" href="https://wiki.beyondunreal.com/Special:RecentChanges?feed=atom" />
<link rel="stylesheet" href="../w/load2743.css?debug=false&amp;lang=en&amp;modules=ext.geshi.language.uscript%7Cmediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if IE 6]><link rel="stylesheet" href="/w/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/w/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="../w/load484a.css?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=monobook&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: wiki:resourceloader:filter:minify-css:7:29b70323345a439ab9ed7007e0c178a6 */</style>
<script src="../w/load9316.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"User","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":2,"wgPageName":"User:Wormbo/Vauss_Cannon_(UT2004)","wgTitle":"Wormbo/Vauss Cannon (UT2004)","wgCurRevisionId":34556,"wgRevisionId":34556,"wgArticleId":24190,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Pages needing cleanup","Programming tutorials"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"User:Wormbo/Vauss_Cannon_(UT2004)","wgRelevantArticleId":24190,"wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgRelevantUserName":"Wormbo","wgCategoryTreePageCategoryOptions":"{\"mode\":0,\"hideprefix\":20,\"showcount\":true,\"namespaces\":false}"});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: wiki:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-2 ns-subject page-User_Wormbo_Vauss_Cannon_UT2004 skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
									<div id="siteNotice"><div id="localNotice" lang="en" dir="ltr"><p>Once I get that upgrade to 36-hour days, I will tackle that. &#8211; Mychaeel
</p></div></div>
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">User:Wormbo/Vauss Cannon (UT2004)</h1>

				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Unreal Wiki, The Unreal Engine Documentation Site</div>
					<div id="contentSub"><span class="subpages">&lt; <a href="../User_Wormbo.html" title="User:Wormbo">User:Wormbo</a></span></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>The goal of this tutorial is to create a rapid-fire instant-hit weapon for <a href="../UT2004.html" title="UT2004" class="mw-redirect">UT2004</a>. Primary fire will be a standard Minigun-style mode with high fire rate and quite some spread, while the secondary mode will fire explosive rounds with lower fire rate and spread.</p>
<p>Unlike the UT2004 <a href="../UE2_Minigun_(UT2004).html" title="UE2:Minigun (UT2004)">Minigun</a>, this weapon will immediately start firing while winding up. The dynamic nature of the wind-up/down behavior will require an unusual handling of fire modes.</p>
<p>The Vauss Cannon will use the standard UT2004 Minigun visuals with custom firing sounds. Feel free to customize the visuals as well, but this tutorial makes some assumptions based on details of the Minigun's 1st person mesh.</p>
<p></p>
<div id="toc" class="toc">
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Project_setup"><span class="tocnumber">1</span> <span class="toctext">Project setup</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Getting_started"><span class="tocnumber">2</span> <span class="toctext">Getting started</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Implementing_fire_modes"><span class="tocnumber">3</span> <span class="toctext">Implementing fire modes</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Primary_fire_mode"><span class="tocnumber">3.1</span> <span class="toctext">Primary fire mode</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Secondary_fire_mode"><span class="tocnumber">3.2</span> <span class="toctext">Secondary fire mode</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Fixing_the_radius_damage"><span class="tocnumber">3.3</span> <span class="toctext">Fixing the radius damage</span></a></li>
</ul>
</li>
</ul>
</div>
<p></p>
<h2><span class="mw-headline" id="Project_setup">Project setup</span></h2>
<p>First you need to set up your <a href="../UnrealScript.html" title="UnrealScript">UnrealScript</a> project. Personally I prefer just <a href="https://wiki.beyondunreal.com/edit/Creating_classes?redlink=1" class="new" title="Creating classes (page does not exist)">creating classes</a> with <a href="../UnCodeX.html" title="UnCodeX">UnCodeX</a>, which automatically creates the <a href="https://wiki.beyondunreal.com/edit/Project_directory?redlink=1" class="new" title="Project directory (page does not exist)">project directory</a> if you specify a new package name. To compile my projects I use <a href="https://wiki.beyondunreal.com/edit/UMake?redlink=1" class="new" title="UMake (page does not exist)">UMake</a>, which stores its settings in the file make.ini in the project directory and can be configured as the default compiler in UnCodeX. You can use any UnrealScript programming environment you want, but I strongly recommend against using <a href="../UnrealEd.html" title="UnrealEd" class="mw-redirect">UnrealEd</a> because this tutorial is going to work with <a href="../Defaultproperties.html" title="Defaultproperties">defaultproperties</a> which are not editable in UnrealEd.</p>
<p>For this tutorial, the project directory (and thus the package to compile) is assumed to be called <b>VaussCannonTutorial</b> and since this is supposed to become a simple weapon mutator, it resides directly in the UT2004 directory. The custom sounds we will use in this tutorial are already set up in the sound package <a rel="nofollow" class="external text" href="../../www.koehler-homepage.de/Wormbo/download/VaussFireSounds.zip">VaussFireSounds.uax</a>, which should be placed in the project directory as it will be imported into our project package later.</p>
<h2><span class="mw-headline" id="Getting_started">Getting started</span></h2>
<p>UT2004 weapons consist of different parts. The most important part is the <a href="../UE2_Weapon_(UT2004).html" title="UE2:Weapon (UT2004)">Weapon</a> subclass, which often implements the overall behavior of the weapon and also acts as mediator between the player and other parts of the weapon. Let's start by creating the new Weapon subclass <b>VaussCannon</b> and filling in some basic information about the weapon we are going to create.</p>
<p>Any potential comments aside, the only line of code in the new class should be:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> VaussCannon <span class="kw1">extends</span> <span class="kw9">Weapon</span>;
</pre></div>
</div>
<p>We will use custom sounds, so let's load those first:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="co2">#exec obj load file=VaussFireSounds.uax package=VaussCannonTutorial</span>
</pre></div>
</div>
<p>This loads our custom sound package into the package we will be compiling. The part after #exec is actually a console command that will be executed when the VaussCannon.uc file is parsed for the first time. Any resources in VaussFireSounds.uax are loaded and will be available during the entire compiler run. Any other classes we compile will be able to reference these resources in code and <a href="../Defaultproperties.html" title="Defaultproperties">defaultproperties</a> as well.</p>
<p>Speaking of defaultproperties, let's fill in some default values as well:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
  ItemName <span class="sy0">=</span> <span class="st0">"Vauss Cannon"</span>
  Description <span class="sy0">=</span> <span class="st0">"..."</span> <span class="co1">// be creative here, the Vauss Cannon's basic functionality was explained at the start of the tutorial</span>
 
  <span class="co1">// the following properties were all copied from the Minigun class:</span>
  HighDetailOverlay<span class="sy0">=</span><span class="kw5">Material</span><span class="st0">'UT2004Weapons.WeaponSpecMap2'</span>
  IconMaterial<span class="sy0">=</span><span class="kw5">Material</span><span class="st0">'HudContent.Generic.HUD'</span>
  IconCoords<span class="sy0">=</span><span class="br0">(</span>X1<span class="sy0">=</span><span class="nu0">246</span>,Y1<span class="sy0">=</span><span class="nu0">80</span>,X2<span class="sy0">=</span><span class="nu0">332</span>,Y2<span class="sy0">=</span><span class="nu0">106</span><span class="br0">)</span>
  InventoryGroup<span class="sy0">=</span><span class="nu0">6</span>
  <span class="kw5">Mesh</span><span class="sy0">=</span><span class="kw5">mesh</span><span class="st0">'Weapons.Minigun_1st'</span>
  BobDamping<span class="sy0">=</span><span class="nu0">2.25</span>
  EffectOffset<span class="sy0">=</span><span class="br0">(</span>X<span class="sy0">=</span><span class="nu0">100.0</span>,Y<span class="sy0">=</span><span class="nu0">18.0</span>,Z<span class="sy0">=-</span><span class="nu0">16.0</span><span class="br0">)</span>
  DisplayFOV<span class="sy0">=</span><span class="nu0">60</span>
  PutDownAnim<span class="sy0">=</span>PutDown
  <span class="kw7">DrawScale</span><span class="sy0">=</span><span class="nu0">0.4</span>
  PlayerViewOffset<span class="sy0">=</span><span class="br0">(</span>X<span class="sy0">=</span><span class="nu0">2</span>,Y<span class="sy0">=-</span><span class="nu0">1</span>,Z<span class="sy0">=</span><span class="nu0">0</span><span class="br0">)</span>
  SmallViewOffset<span class="sy0">=</span><span class="br0">(</span>X<span class="sy0">=</span><span class="nu0">8</span>,Y<span class="sy0">=</span><span class="nu0">1</span>,Z<span class="sy0">=-</span><span class="nu0">2</span><span class="br0">)</span>
  PlayerViewPivot<span class="sy0">=</span><span class="br0">(</span>Pitch<span class="sy0">=</span><span class="nu0">0</span>,Roll<span class="sy0">=</span><span class="nu0">0</span>,Yaw<span class="sy0">=</span><span class="nu0">500</span><span class="br0">)</span>
  AttachmentClass<span class="sy0">=</span><span class="kw1">class</span><span class="st0">'MinigunAttachment'</span>
  <span class="kw7">SoundRadius</span><span class="sy0">=</span><span class="nu0">400.0</span>
  SelectSound<span class="sy0">=</span><span class="kw5">Sound</span><span class="st0">'WeaponSounds.Minigun.SwitchToMinigun'</span>
  SelectForce<span class="sy0">=</span><span class="st0">"SwitchToMiniGun"</span>
  AIRating<span class="sy0">=+</span><span class="nu0">0.71</span>
  CurrentRating<span class="sy0">=+</span><span class="nu0">0.71</span>
  HudColor<span class="sy0">=</span><span class="br0">(</span>r<span class="sy0">=</span><span class="nu0">255</span>,g<span class="sy0">=</span><span class="nu0">255</span>,b<span class="sy0">=</span><span class="nu0">255</span>,a<span class="sy0">=</span><span class="nu0">255</span><span class="br0">)</span>
  CustomCrosshair<span class="sy0">=</span><span class="nu0">12</span>
  CustomCrosshairTextureName<span class="sy0">=</span><span class="st0">"Crosshairs.Hud.Crosshair_Circle1"</span>
  CustomCrosshairColor<span class="sy0">=</span><span class="br0">(</span>r<span class="sy0">=</span><span class="nu0">255</span>,g<span class="sy0">=</span><span class="nu0">255</span>,b<span class="sy0">=</span><span class="nu0">255</span>,a<span class="sy0">=</span><span class="nu0">255</span><span class="br0">)</span>
  Priority<span class="sy0">=</span><span class="nu0">9</span>
  CenteredOffsetY<span class="sy0">=-</span><span class="nu0">6.0</span>
  CenteredYaw<span class="sy0">=-</span><span class="nu0">500</span>
  CenteredRoll<span class="sy0">=</span><span class="nu0">0</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>These properties already mentions another part of all UT2004 weapons, the <a href="../UE2_WeaponAttachment_(UT2004).html" title="UE2:WeaponAttachment (UT2004)">WeaponAttachment</a>. That's the mesh attached to the player model. We will just reuse the Minigun attachment here as it already does what we want. It is responsible for spawning tracer effects, ejected shells and impact sparks. For the alternate fire mode it even spawns a small explosion effect.</p>
<h2><span class="mw-headline" id="Implementing_fire_modes">Implementing fire modes</span></h2>
<p>Right now there's not much we can do with our weapon. We could get it into the game via the Arena mutator, but it wouldn't do anything yet.</p>
<p>In order to make our weapon shoot, we need to add fire mode classes. More precisely, we need to create one or two subclasses of <a href="../UE2_WeaponFire_(UT2004).html" title="UE2:WeaponFire (UT2004)">WeaponFire</a> and use it/them as the fire mode class(es) of the VaussCannon class. The Vauss Cannon is an instant-hit weapon with two similar firing modes. After a look at the WeaponFire class hierarchy, the most obvious choice is subclassing <a href="../UE2_InstantFire_(UT2004).html" title="UE2:InstantFire (UT2004)">InstantFire</a>. We could also subclass <a href="../UE2_MinigunFire_(UT2004).html" title="UE2:MinigunFire (UT2004)">MinigunFire</a>, but we will see later that the Vauss Cannon fire modes are more than a bit different from those of the Minigun.</p>
<p>Let's call our primary fire mode class <b>VaussCannonFire</b>:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> VaussCannonFire <span class="kw1">extends</span> InstantFire;
</pre></div>
</div>
<p>...and our secondary fire mode class <b>VaussCannonAltFire</b>:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> VaussCannonAltFire <span class="kw1">extends</span> VaussCannonFire;
</pre></div>
</div>
<p>Since the fire modes will be very similar, it makes sense to extend one from the other. And since the secondary mode has splash damage, we'll extend it from the non-splash damage primary mode and add the splash damage handling here later.</p>
<p>Very important, to tell our weapon to use these new fire mode classes, we need to add the relevant values to the VaussCannon's <a href="../Defaultproperties.html" title="Defaultproperties">defaultproperties</a> block:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
  FireModeClass<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">=</span> <span class="kw1">class</span><span class="st0">'VaussCannonFire'</span>
  FireModeClass<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">=</span> <span class="kw1">class</span><span class="st0">'VaussCannonAltFire'</span>
</pre></div>
</div>
<h3><span class="mw-headline" id="Primary_fire_mode">Primary fire mode</span></h3>
<p>For now we will only work on the primary fire mode. Changes we do here will be inherited by the secondary fire mode class because it extends the primary fire mode class.</p>
<p>Before we start adding default values and code, let's see what InstantFire and its parent class WeaponFire already provide. InstantFire defines a trace range of 10000<a href="../UU.html" title="UU" class="mw-redirect">UU</a> and all the logic required to perform a hit trace and apply damage. The WeaponFire class defines the standard logic for dealing with relevant player input (pressing fire(alt fire button), with some of the logic residing in native code. There are also AI recommendations and a few predefined animation names. Neither of these classes define a default type or amount of damage, so let's do that first.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
  DamageMin  <span class="sy0">=</span> <span class="nu0">5</span>
  DamageMax  <span class="sy0">=</span> <span class="nu0">6</span>
  <span class="kw9">DamageType</span> <span class="sy0">=</span> <span class="kw1">class</span><span class="st0">'DamTypeMinigunBullet'</span>
  Momentum   <span class="sy0">=</span> <span class="nu0">1000.0</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>Another thing we need to define is the amount and type of ammo our weapon uses. This is also done in the defaultproperties block of the fire mode classes, so add the following lines to it:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
  AmmoClass <span class="sy0">=</span> <span class="kw1">class</span><span class="st0">'MinigunAmmo'</span>
  AmmoPerFire <span class="sy0">=</span> <span class="nu0">1</span>
</pre></div>
</div>
<p>These two lines mean the Vauss Cannon uses the same ammo type as the Minigun and requires one ammo unit per shot.</p>
<p>At this point you can compile and test the current state of the Vauss Cannon using the Arena mutator. You will notice that it will shoot and do damage, but it's almost completely silent and the fire rate is far too low. It does spawn tracers and impact effects, though. These are created by the <a href="../UE2_MinigunAttachment_(UT2004).html" title="UE2:MinigunAttachment (UT2004)">MinigunAttachment</a> class we defined as the VaussCannon's <i>AttachmentClass</i>.</p>
<p>To add a firing sound, simply add the following line to the VuassCannonFire defaults:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
  FireSound <span class="sy0">=</span> <span class="kw5">Sound</span><span class="st0">'VaussFireSound'</span>
</pre></div>
</div>
<p>The firing rate is defined by the time between shots, so a rate of e.g. 20 shots per second would require the following default value:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
  FireRate <span class="sy0">=</span> <span class="nu0">0.05</span>
</pre></div>
</div>
<p>If you test again, you'll hear a nice machinegun sound and see the corresponding fire effects, including the damage opponents take. However, the shots are still spot-on. A machine gun with this firing rate would be expected to be quite inaccurate, and if we look at the <a href="../UE2_MinigunFire_(UT2004).html" title="UE2:MinigunFire (UT2004)">MinigunFire</a> class, we can see a default value for the property <a href="../UE2_WeaponFire_(UT2004).html#Spread" title="UE2:WeaponFire (UT2004)">Spread</a>, which defines a relative spread angle for instant-hit modes. A spread of 0.08 is used by the Minigun primary fire and that value should be good for the Vauss Cannon primary fire as well.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
  Spread <span class="sy0">=</span> <span class="nu0">0.08</span>
</pre></div>
</div>
<p>That should be enough for the first implementation pass on the primary fire mode, so let's move on to the secondary mode.</p>
<h3><span class="mw-headline" id="Secondary_fire_mode">Secondary fire mode</span></h3>
<p>The secondary fire mode of the Vauss Cannon is supposed to have a lower firing rate (and thus less spread), but do more damage, including some splash damage. To make it more obvious, we will also assign a slightly different firing sound. Five shots per second should be ok for this mode, so add the following lines to the <b>VaussCannonAltFire</b> class:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
  FireSound <span class="sy0">=</span> <span class="kw5">Sound</span><span class="st0">'VaussAltFireSound'</span>
  FireRate  <span class="sy0">=</span> <span class="nu0">0.2</span>
  Spread    <span class="sy0">=</span> <span class="nu0">0.03</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>At the lower firing rate and with the inherited damage values, the secondary mode is seriously underpowered. Let's override the inherited values with the following new defaults:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
  DamageMin  <span class="sy0">=</span> <span class="nu0">13</span>
  DamageMax  <span class="sy0">=</span> <span class="nu0">15</span>
  <span class="kw9">DamageType</span> <span class="sy0">=</span> <span class="kw1">class</span><span class="st0">'DamTypeMinigunAlt'</span>
  Momentum   <span class="sy0">=</span> <span class="nu0">10000.0</span>
</pre></div>
</div>
<p>Now the secondary mode fires 5 shots per second, each doing 13 to 15 damage. That's an average damage output of about 5*(13+15)/2=70. The primary mode does about 20*(5+6)/2=110 damage, but only at closer range, because at greater distance not all shots will hit the target. The damage output per second may be a bit lower for secondary mode, but the damage output per ammo is more than twice as high as the primary mode's. That means, if the player only used the secondary mode, he would be able to save a lot of ammo at the expense of some damage per second. To counter this, we should increase the ammo usage of the secondary mode a bit:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
  AmmoPerFire <span class="sy0">=</span> <span class="nu0">2</span>
</pre></div>
</div>
<p>Now the secondary mode will consume 2/0.2=10 ammo units per second, while the primary mode consumes 1/0.5=20 ammo units per second.</p>
<p>One problem caused by an ammo amount greater than 1 is that the weapon may stop firing in this mode if less than the required ammo amount is left, but it won't switch away automatically. This also happened with the Linkgun secondary mode before Epic worked around it in a patch by adding the following code to the alt fire mode, which we will also do in our VaussCannonAltFire class:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> <span class="kw5">bool</span> AllowFire<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw2">return</span> <span class="kw9">Weapon</span>.<span class="me0">AmmoAmount</span><span class="br0">(</span>ThisModeNum<span class="br0">)</span> <span class="sy0">&gt;=</span> <span class="nu0">1</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p><b>ThisModeNum</b> is a variable defined in the WeaponFire class that is initialized with the actual mode number for this fire mode by the weapon when creating the fire mode instance. <b>Weapon</b> also is a variable defined by the WeaponFire and initialized by the weapon. The <b>AmmoAmount</b> function of the weapon returns the current ammo amount for the specified fire mode. Usually this will be the same value for both fire modes, but some weapons like the Assault Rifle keep two different ammo values for primary and secondary mode.</p>
<p>So now the secondary Vauss Cannon fire mode already does more damage at a lower fire rate and uses more ammo per shot, but it doesn't have splash damage yet. We will have to override the logic that finds hit targets and applies damage. The function responsible for this part is <a href="../UE2_InstantFire_(UT2004).html#DoTrace" title="UE2:InstantFire (UT2004)">InstantFire.DoTrace</a>(). If you look at its source code (and I strongly recommend doing so!), you will see it was written to handle reflecting off the Shieldgun shield if the fire mode supports it.</p>
<p>We only need to replace the call to <code>Other.<a href="../UE2_Actor_events_(UT2004).html#TakeDamage" title="UE2:Actor events (UT2004)">TakeDamage</a>(...)</code>, but it's burried deep inside this function. There's no way to replace only that single line, so we need to override and reimplement the entire DoTrace() function. Our weapon does not support reflection, so we can leave out the corresponding code. Of course you can also copy/paste the InstantFire.DoTrace() function entirely and only replace the <i>TakeDamage</i> line in a similar way as the following code does. First we will introduce a new property for our fire mode class. Add the following variable declaration below the class declaration, but above the first function:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">var</span> <span class="kw5">float</span> DamageRadius;
</pre></div>
</div>
<p>...and give it a meaningful value in the defaultproperties block:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
  DamageDarius <span class="sy0">=</span> <span class="nu0">10.0</span>
</pre></div>
</div>
<p>Now we can replace the simple TakeDamage() call with something that causes radius damage. The most obvious candidate here is the <a href="../UE2_Actor_instance_functions_(UT2004).html#HurtRadius" title="UE2:Actor instance functions (UT2004)">Actor.HurtRadius</a>() function, which already implements radius damage with linear falloff from the center. In UT2004 the WeaponFire classes do not extend Actor, so we need to get hold of an actor to call HurtRadius(). This actor should be owned by the player as otherwise the player might not be credited for kills. We are lucky here, as the weapon itself extends Actor &gt;&gt; Inventory &gt;&gt; Weapon and therefore inherits the HurtRadius() function:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> DoTrace<span class="br0">(</span><span class="kw5">vector</span> Start, <span class="kw5">rotator</span> Dir<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">vector</span> X, End, HitLocation, HitNormal;
  <span class="kw1">local</span> <span class="kw9">Actor</span> Other;
  <span class="kw1">local</span> <span class="kw5">float</span> DamageAmount;
 
  X <span class="sy0">=</span> <span class="kw5">vector</span><span class="br0">(</span>Dir<span class="br0">)</span>;
  End <span class="sy0">=</span> Start <span class="sy0">+</span> MaxRange<span class="br0">(</span><span class="br0">)</span> <span class="sy0">*</span> X;
 
  Other <span class="sy0">=</span> <span class="kw9">Weapon</span>.<span class="kw4">Trace</span><span class="br0">(</span>HitLocation, HitNormal, End, Start, <span class="kw6">true</span><span class="br0">)</span>;
 
  <span class="kw2">if</span> <span class="br0">(</span>Other <span class="sy0">!=</span> <span class="kw5">None</span> <span class="sy0">&amp;&amp;</span> Other <span class="sy0">!=</span> <span class="kw7">Instigator</span><span class="br0">)</span> <span class="br0">{</span>
    DamageAmount <span class="sy0">=</span> <span class="kw3">RandRange</span><span class="br0">(</span>DamageMin, DamageMax<span class="br0">)</span> <span class="sy0">*</span> DamageAtten;
    <span class="kw9">Weapon</span>.<span class="kw4">HurtRadius</span><span class="br0">(</span>DamageAmount, DamageRadius, <span class="kw9">DamageType</span>, Momentum, HitLocation<span class="br0">)</span>;
    <span class="kw9">WeaponAttachment</span><span class="br0">(</span><span class="kw9">Weapon</span>.<span class="me0">ThirdPersonActor</span><span class="br0">)</span>.<span class="me0">UpdateHit</span><span class="br0">(</span>Other, HitLocation, HitNormal<span class="br0">)</span>;
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="br0">{</span>
    HitNormal <span class="sy0">=</span> <span class="kw3">vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span>;
    HitLocation <span class="sy0">=</span> End;
    <span class="kw9">WeaponAttachment</span><span class="br0">(</span><span class="kw9">Weapon</span>.<span class="me0">ThirdPersonActor</span><span class="br0">)</span>.<span class="me0">UpdateHit</span><span class="br0">(</span>Other, HitLocation, HitNormal<span class="br0">)</span>;
  <span class="br0">}</span>
  SpawnBeamEffect<span class="br0">(</span>Start, Dir, HitLocation, HitNormal, <span class="nu0">0</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p>So far so good, but when testing the secondary mode, you'll notice it neither damages enemies nor yourself if you shoot at some nearby object. This is not really a problem with our code, but one with the HurtRadius() function. It uses <a href="../UE2_Actor_(UT2004).html#_VisibleCollidingActors" title="UE2:Actor (UT2004)">VisibleCollidingActors</a> and passes the DamageRadius directly. That iterator function, however, only looks for actors whose center is within the specified radius. At only 10UU radius, this will work for almost no actor in the game.</p>
<h3><span class="mw-headline" id="Fixing_the_radius_damage">Fixing the radius damage</span></h3>
<p>We will have to write a custom radius damage function that finds all actors <i>overlapping</i> the damage radius, even if their center is outside the radius. Also, the actor actually hit should take full damage. This is important for vehicles, which use complex collision. Also, unlike the HurtRadius() function that bases the damage amount on the distance from the actor center minus the actor's <a href="../UE2_Actor_properties_(UT2004).html#CollisionRadius" title="UE2:Actor properties (UT2004)">CollisionRadius</a>, our function should take the actual distance from the collision cylinder. With a radius as small as the one we use and a <a href="../UE2_Actor_properties_(UT2004).html#CollisionHeight" title="UE2:Actor properties (UT2004)">CollisionHeight</a> much greater than the CollisionRadius, hitting players at the feed or the head would otherwise do no damage.</p>
<p>What we need is a function that calculates a point's distance from a cylinder's surface. Player collision cylinders are always upright, so the problem can be split into calculating a height difference and finding the distance of a point from a circle. The following function will first find the horizontal and vertical distances and then calculate the actual distance from these components:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> <span class="kw5">float</span> DistToCylinder<span class="br0">(</span><span class="kw5">vector</span> CenterDist, <span class="kw5">float</span> HalfHeight, <span class="kw5">float</span> Radius<span class="br0">)</span>
<span class="br0">{</span>
  CenterDist.<span class="me0">X</span> <span class="sy0">=</span> <span class="kw3">VSize</span><span class="br0">(</span><span class="kw3">vect</span><span class="br0">(</span><span class="nu0">1</span>,<span class="nu0">1</span>,<span class="nu0">0</span><span class="br0">)</span> <span class="sy0">*</span> CenterDist<span class="br0">)</span> <span class="sy0">-</span> Radius;
  <span class="kw2">if</span> <span class="br0">(</span>CenterDist.<span class="me0">X</span> <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">)</span>
    CenterDist.<span class="me0">X</span> <span class="sy0">=</span> <span class="nu0">0</span>;
 
  CenterDist.<span class="me0">Y</span> <span class="sy0">=</span> <span class="nu0">0</span>;
 
  <span class="kw2">if</span> <span class="br0">(</span>CenterDist.<span class="me0">Z</span> <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">)</span>
    CenterDist.<span class="me0">Z</span> <span class="sy0">*=</span> <span class="sy0">-</span><span class="nu0">1</span>;
 
  CenterDist.<span class="me0">Z</span> <span class="sy0">-=</span> HalfHeight;
  <span class="kw2">if</span> <span class="br0">(</span>CenterDist.<span class="me0">Z</span> <span class="sy0">&lt;</span> <span class="nu0">0</span><span class="br0">)</span>
    CenterDist.<span class="me0">Z</span> <span class="sy0">=</span> <span class="nu0">0</span>;
 
  <span class="kw2">return</span> <span class="kw3">VSize</span><span class="br0">(</span>CenterDist<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p>We will use this in our custom radius damage function to calculate the distance of players from the hit location.</p>
<p>The new radius damage function needs to know three things:</p>
<ol>
<li>who/what was hit,</li>
<li>where was the hit and</li>
<li>what's the shot direction.</li>
</ol>
<p>These need to be passed as parameters, everything else is available as class-global variables.</p>
<p><br /></p>
<table style="" class="metadata plainlinks ambox ambox-content">
<tr>
<td class="ambox-image"></td>
<td class="ambox-text">The following things need to be done on this page or in this section:<br />
<ul>
<li>explain ExtendedHurtRadius()</li>
<li>create custom damage types</li>
<li>create custom ammo type</li>
<li>move fire code to weapon class for wind-up/down</li>
<li>create pickup class</li>
<li>create mutator</li>
</ul>
</td>
</tr>
</table>

<!-- 
NewPP limit report
CPU time usage: 0.258 seconds
Real time usage: 0.262 seconds
Preprocessor visited node count: 218/1000000
Preprocessor generated node count: 610/1000000
Post‐expand include size: 1181/2097152 bytes
Template argument size: 608/2097152 bytes
Highest expansion depth: 5/40
Expensive parser function count: 1/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    7.336      1 - -total
100.00%    7.336      1 - Template:Todo
 63.84%    4.683      1 - Template:Ambox
-->

<!-- Saved in parser cache with key wiki:pcache:idhash:24190-0!*!0!!en!*!* and timestamp 20161215141714 and revision id 34556
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://wiki.beyondunreal.com/User:Wormbo/Vauss_Cannon_(UT2004)?oldid=34556">https://wiki.beyondunreal.com/User:Wormbo/Vauss_Cannon_(UT2004)?oldid=34556</a>"</div>
					<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="https://wiki.beyondunreal.com/Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="../Category_Pages_needing_cleanup.html" title="Category:Pages needing cleanup">Pages needing cleanup</a></li><li><a href="../Category_Programming_tutorials.html" title="Category:Programming tutorials">Programming tutorials</a></li></ul></div></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-user" class="selected"><a href="Vauss_Cannon_(UT2004).html" title="View the user page [c]" accesskey="c">User page</a></li>
				<li id="ca-talk" class="new"><a href="https://wiki.beyondunreal.com/edit/User_talk:Wormbo/Vauss_Cannon_(UT2004)?redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="https://wiki.beyondunreal.com/edit/User:Wormbo/Vauss_Cannon_(UT2004)" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="https://wiki.beyondunreal.com/history/User:Wormbo/Vauss_Cannon_(UT2004)" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-createaccount"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=User%3AWormbo%2FVauss+Cannon+%28UT2004%29&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=User%3AWormbo%2FVauss+Cannon+%28UT2004%29" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="../index.html" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-mainpage"><a href="../index.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li>
											<li id="n-portal"><a href="../Unreal_Wiki_Community_portal-2.html" title="About the project, what you can do, where to find things">Community portal</a></li>
											<li id="n-recentchanges"><a href="https://wiki.beyondunreal.com/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="https://wiki.beyondunreal.com/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
											<li id="n-Forums-.28General.29"><a href="https://forums.beyondunreal.com/forums/wiki-general.250/" rel="nofollow">Forums (General)</a></li>
											<li id="n-Forums-.28Technical.29"><a href="https://forums.beyondunreal.com/forums/wiki-technical.251/" rel="nofollow">Forums (Technical)</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="https://wiki.beyondunreal.com/" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Unreal Wiki [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="https://wiki.beyondunreal.com/Special:WhatLinksHere/User:Wormbo/Vauss_Cannon_(UT2004)" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="https://wiki.beyondunreal.com/Special:RecentChangesLinked/User:Wormbo/Vauss_Cannon_(UT2004)" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-contributions"><a href="https://wiki.beyondunreal.com/Special:Contributions/Wormbo" title="A list of contributions of this user">User contributions</a></li>
											<li id="t-log"><a href="https://wiki.beyondunreal.com/Special:Log/Wormbo">Logs</a></li>
											<li id="t-specialpages"><a href="https://wiki.beyondunreal.com/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="https://wiki.beyondunreal.com/User:Wormbo/Vauss_Cannon_(UT2004)?printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="https://wiki.beyondunreal.com/User:Wormbo/Vauss_Cannon_(UT2004)?oldid=34556" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="https://wiki.beyondunreal.com/info/User:Wormbo/Vauss_Cannon_(UT2004)" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="../../licensebuttons.net/l/by-nc-sa/3.0/88x31.png" alt="Attribution-Noncommercial-Share Alike 3.0" width="88" height="31" /></a>
							</div>
					<div id="f-poweredbyico">
									<script async src="../../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
        <!-- Home Page -->
        <ins class="adsbygoogle"
             style="display:inline-block;width:728px;height:90px"
             data-ad-client="ca-pub-9605963037553244"
             data-ad-slot="9528541415"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
							</div>
					<ul id="f-list">
									<li id="lastmod"> Last modified at 12:50, 26 July 2009.</li>
									<li id="copyright">Licensed as <a href="../Unreal_Wiki_Copyrights.html" title="Unreal Wiki:Copyrights">Attribution-Noncommercial-Share Alike 3.0</a>.</li>
									<li id="privacy"><a href="../Unreal_Wiki_Privacy_policy.html" title="Unreal Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="../Unreal_Wiki_About.html" title="Unreal Wiki:About">About Unreal Wiki</a></li>
									<li id="disclaimer"><a href="../Unreal_Wiki_General_disclaimer.html" title="Unreal Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.beyondunreal.com/w/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=monobook\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":88});
}</script></body>
<!-- Mirrored from wiki.beyondunreal.com/User:Wormbo/Vauss_Cannon_(UT2004) by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 07:52:49 GMT -->
</html>
