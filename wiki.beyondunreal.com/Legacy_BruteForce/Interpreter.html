<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.beyondunreal.com/Legacy:BruteForce/Interpreter by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 09:37:35 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>Legacy:BruteForce/Interpreter - Unreal Wiki</title>
<meta name="generator" content="MediaWiki 1.25.1" />
<link rel="alternate" type="application/x-wiki" title="Edit" href="https://wiki.beyondunreal.com/edit/Legacy:BruteForce/Interpreter" />
<link rel="edit" title="Edit" href="https://wiki.beyondunreal.com/edit/Legacy:BruteForce/Interpreter" />
<link rel="shortcut icon" href="../w/uewiki-favicon.png" />
<link rel="search" type="application/opensearchdescription+xml" href="../w/opensearch_desc.php" title="Unreal Wiki" />
<link rel="EditURI" type="application/rsd+xml" href="../w/api251f.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Interpreter.html" />
<link rel="copyright" href="../Unreal_Wiki_Copyrights.html" />
<link rel="alternate" type="application/atom+xml" title="Unreal Wiki Atom feed" href="https://wiki.beyondunreal.com/Special:RecentChanges?feed=atom" />
<link rel="stylesheet" href="../w/load2743.css?debug=false&amp;lang=en&amp;modules=ext.geshi.language.uscript%7Cmediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if IE 6]><link rel="stylesheet" href="/w/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/w/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="../w/load484a.css?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=monobook&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: wiki:resourceloader:filter:minify-css:7:29b70323345a439ab9ed7007e0c178a6 */</style>
<script src="../w/load9316.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"Legacy","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":100,"wgPageName":"Legacy:BruteForce/Interpreter","wgTitle":"BruteForce/Interpreter","wgCurRevisionId":1820,"wgRevisionId":1820,"wgArticleId":605,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Legacy:BruteForce/Interpreter","wgRelevantArticleId":605,"wgIsProbablyEditable":true,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgCategoryTreePageCategoryOptions":"{\"mode\":0,\"hideprefix\":20,\"showcount\":true,\"namespaces\":false}"});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: wiki:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-100 ns-subject page-Legacy_BruteForce_Interpreter skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
									<div id="siteNotice"><div id="localNotice" lang="en" dir="ltr"><p>I'm a doctor, not a mechanic
</p></div></div>
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Legacy:BruteForce/Interpreter</h1>

				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Unreal Wiki, The Unreal Engine Documentation Site</div>
					<div id="contentSub"><span class="subpages">&lt; <a href="../Legacy_BruteForce.html" title="Legacy:BruteForce">Legacy:BruteForce</a></span></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> Interpreter <span class="kw1">extends</span> <span class="kw8">Object</span> dependsOn<span class="br0">(</span>AST<span class="br0">)</span> dependsOn<span class="br0">(</span>Scope<span class="br0">)</span> dependsOn<span class="br0">(</span>Compiler<span class="br0">)</span>;
 
<span class="kw1">var</span> <span class="kw1">private</span> AST a;
<span class="kw1">var</span> <span class="kw1">private</span> Scope s;
<span class="kw1">var</span> <span class="kw1">private</span> array<span class="sy0">&lt;</span>string<span class="sy0">&gt;</span> input;
 
<span class="co1">// keywords</span>
<span class="kw1">const</span> __BEGIN                 <span class="sy0">=</span> <span class="st0">"begin"</span>;
<span class="kw1">const</span> __VAR                   <span class="sy0">=</span> <span class="st0">"var"</span>;
<span class="kw1">const</span> __INTEGER               <span class="sy0">=</span> <span class="st0">"int"</span>;
<span class="kw1">const</span> __STRING                <span class="sy0">=</span> <span class="st0">"string"</span>;
<span class="kw1">const</span> __FLOAT                 <span class="sy0">=</span> <span class="st0">"float"</span>;
<span class="kw1">const</span> __BOOLEAN               <span class="sy0">=</span> <span class="st0">"bool"</span>;
<span class="kw1">const</span> __FUNC                  <span class="sy0">=</span> <span class="st0">"function"</span>;
<span class="kw1">const</span> __BECOMES               <span class="sy0">=</span> <span class="st0">"="</span>;
<span class="kw1">const</span> __WHILE                 <span class="sy0">=</span> <span class="st0">"while"</span>;
<span class="kw1">const</span> __IF                    <span class="sy0">=</span> <span class="st0">"if"</span>;
<span class="kw1">const</span> __LT                    <span class="sy0">=</span> <span class="st0">"&lt;"</span>;
<span class="kw1">const</span> __LE                    <span class="sy0">=</span> <span class="st0">"&lt;="</span>;
<span class="kw1">const</span> __GT                    <span class="sy0">=</span> <span class="st0">"&gt;"</span>;
<span class="kw1">const</span> __GE                    <span class="sy0">=</span> <span class="st0">"&gt;="</span>;
<span class="kw1">const</span> __EQ                    <span class="sy0">=</span> <span class="st0">"=="</span>;
<span class="kw1">const</span> __NE                    <span class="sy0">=</span> <span class="st0">"!="</span>;
<span class="kw1">const</span> __AND                   <span class="sy0">=</span> <span class="st0">"&amp;&amp;"</span>;
<span class="kw1">const</span> __OR                    <span class="sy0">=</span> <span class="st0">"||"</span>;
<span class="kw1">const</span> __PLUS                  <span class="sy0">=</span> <span class="st0">"+"</span>;
<span class="kw1">const</span> __MINUS                 <span class="sy0">=</span> <span class="st0">"-"</span>;
<span class="kw1">const</span> __MULTIPLY              <span class="sy0">=</span> <span class="st0">"*"</span>;
<span class="kw1">const</span> __DIVIDE                <span class="sy0">=</span> <span class="st0">"/"</span>;
<span class="kw1">const</span> __MOD                   <span class="sy0">=</span> <span class="st0">"%"</span>;
<span class="kw1">const</span> __NOT                   <span class="sy0">=</span> <span class="st0">"!"</span>;
<span class="kw1">const</span> __TRUE                  <span class="sy0">=</span> <span class="st0">"true"</span>;
<span class="kw1">const</span> __FALSE                 <span class="sy0">=</span> <span class="st0">"false"</span>;
<span class="co1">// terminals -- end</span>
</pre></div>
</div>
<p>These are the keywords that we can encounter in the AST</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">const</span> FUNCRESULT              <span class="sy0">=</span> <span class="st0">"result"</span>;
</pre></div>
</div>
<p>the name of the default local variable of function, the one that will contain the result.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> Create<span class="br0">(</span>AST inAst, Scope inScope, array<span class="sy0">&lt;</span>string<span class="sy0">&gt;</span> inInput<span class="br0">)</span>
<span class="br0">{</span>
  a <span class="sy0">=</span> inAst;
  s <span class="sy0">=</span> inScope;
  input <span class="sy0">=</span> inInput;
<span class="br0">}</span>
 
<span class="kw1">function</span> Execute<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">int</span> i;
  <span class="kw2">for</span> <span class="br0">(</span>i <span class="sy0">=</span> <span class="nu0">0</span>; i <span class="sy0">&lt;</span> a.<span class="me0">Tree</span>.<span class="me0">length</span>; i<span class="sy0">++</span><span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>i<span class="br0">]</span>.<span class="me0">parent</span> <span class="sy0">==</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span> ExecuteRoot<span class="br0">(</span>i<span class="br0">)</span>;
  <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>Execute will walk through all the tree nodes to search for the main root nodes, without a parent, and execute those.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">private</span> <span class="kw1">function</span> ExecuteRoot<span class="br0">(</span><span class="kw5">int</span> node<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> Scope.<span class="me0">Declaration</span> d;
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_Keyword<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __VAR<span class="br0">)</span> _var<span class="br0">(</span>node<span class="br0">)</span>;
    <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __BECOMES<span class="br0">)</span> _assignment<span class="br0">(</span>node<span class="br0">)</span>;
    <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __IF<span class="br0">)</span> _ifthenelse<span class="br0">(</span>node<span class="br0">)</span>;
    <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __WHILE<span class="br0">)</span> _whiledo<span class="br0">(</span>node<span class="br0">)</span>;
    <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __FUNC<span class="br0">)</span> _function<span class="br0">(</span>node<span class="br0">)</span>;
  <span class="br0">}</span>
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_Function<span class="br0">)</span>
  <span class="br0">{</span>
    d <span class="sy0">=</span> _functioncall<span class="br0">(</span>node<span class="br0">)</span>;
  <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>This will execute a root node. A root node can be a variable or function declaration, an assigment, if statement , while statement or a function call.</p>
<p>Each node type has it's own way of handling, but basically it's all the same. Each function will be called with the current AST node to use.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="coMULTI">/**
  returns the value of the nth child
*/</span>
<span class="kw1">private</span> <span class="kw1">function</span> <span class="kw5">string</span> ChildValue<span class="br0">(</span><span class="kw5">int</span> node, <span class="kw1">optional</span> <span class="kw5">int</span> n<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw2">return</span> a.<span class="me0">Tree</span><span class="br0">[</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">children</span><span class="br0">[</span>n<span class="br0">]</span><span class="br0">]</span>.<span class="me0">value</span>;
<span class="br0">}</span>
 
<span class="coMULTI">/**
  returns the id of the nth child
*/</span>
<span class="kw1">private</span> <span class="kw1">function</span> <span class="kw5">int</span> Child<span class="br0">(</span><span class="kw5">int</span> node, <span class="kw1">optional</span> <span class="kw5">int</span> n<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw2">return</span> a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">children</span><span class="br0">[</span>n<span class="br0">]</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p>These two function has as only purpose to keep the code below a bit more readable. Just imagine what a mess it would be if I repeated the above code in the rest of the class.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="coMULTI">/**
  converts BruteForce bool to UScript bool
*/</span>
<span class="kw1">private</span> <span class="kw1">function</span> <span class="kw5">bool</span> boolean<span class="br0">(</span><span class="kw5">string</span> in<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw2">return</span> <span class="sy0">!</span><span class="br0">(</span>in ~<span class="sy0">=</span> __FALSE<span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="coMULTI">/**
  uscript bool to BruteForce bool
*/</span>
<span class="kw1">private</span> <span class="kw1">function</span> <span class="kw5">string</span> boolToString<span class="br0">(</span><span class="kw5">bool</span> in<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw2">if</span> <span class="br0">(</span>in<span class="br0">)</span> <span class="kw2">return</span> __TRUE;
  <span class="kw2">else</span> <span class="kw2">return</span> __FALSE;
<span class="br0">}</span>
</pre></div>
</div>
<p>We can't use the built-in boolean type cast because out bools are <i>true</i> and <i>false</i> instead of <i>not 0</i> and <i>0</i>.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="coMULTI">/**
  Convert from one type to the other
*/</span>
<span class="kw1">private</span> <span class="kw1">function</span> Scope.<span class="me0">Declaration</span> typeCast<span class="br0">(</span>Scope.<span class="me0">Declaration</span> d, Scope.<span class="me0">DeclarationType</span> type<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw2">if</span> <span class="br0">(</span>d.<span class="me0">type</span> <span class="sy0">==</span> type<span class="br0">)</span> <span class="kw2">return</span> d;
  <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span> <span class="br0">(</span>d.<span class="me0">type</span> <span class="sy0">==</span> DT_Bool<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>;
    <span class="kw2">else</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
    d.<span class="me0">type</span> <span class="sy0">=</span> DT_Int;
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span> <span class="br0">(</span>d.<span class="me0">type</span> <span class="sy0">==</span> DT_Bool<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>;
    <span class="kw2">else</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
    d.<span class="me0">type</span> <span class="sy0">=</span> DT_Float;
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Bool<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span> <span class="br0">(</span>d.<span class="me0">type</span> <span class="sy0">==</span> DT_String<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span>d.<span class="me0">value</span> <span class="sy0">!=</span> <span class="st0">""</span><span class="br0">)</span>;
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>d.<span class="me0">type</span> <span class="sy0">==</span> DT_Int<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">!=</span> <span class="nu0">0</span><span class="br0">)</span>;
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>d.<span class="me0">type</span> <span class="sy0">==</span> DT_Float<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">!=</span> <span class="nu0">0.0</span><span class="br0">)</span>;
    <span class="kw2">else</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span>Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
    d.<span class="me0">type</span> <span class="sy0">=</span> DT_Bool;
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_String<span class="br0">)</span>
  <span class="br0">{</span>
    d.<span class="me0">type</span> <span class="sy0">=</span> DT_String;
  <span class="br0">}</span>
  <span class="kw2">return</span> d;
<span class="br0">}</span>
</pre></div>
</div>
<p>This function makes type completeness possible, each type will be converted into an other type.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">private</span> <span class="kw1">function</span> _var<span class="br0">(</span><span class="kw5">int</span> node, <span class="kw1">optional</span> <span class="kw5">string</span> initval<span class="br0">)</span>
<span class="br0">{</span>
                   <span class="co1">// name                                 value</span>
  s.<span class="me0">newDeclaration</span><span class="br0">(</span>ChildValue<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, s.<span class="me0">stringToType</span><span class="br0">(</span>ChildValue<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span>, initval<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p>Declare a new variable in the current scope. The optional initval is used during the passing of the function arguments.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">private</span> <span class="kw1">function</span> _assignment<span class="br0">(</span><span class="kw5">int</span> node<span class="br0">)</span>
<span class="br0">{</span>                  <span class="co1">// name              expression            left hand type</span>
  s.<span class="me0">setDeclaration</span><span class="br0">(</span>ChildValue<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, typeCast<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span><span class="br0">)</span>, s.<span class="me0">getType</span><span class="br0">(</span>ChildValue<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>.<span class="me0">value</span> <span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">private</span> <span class="kw1">function</span> _ifthenelse<span class="br0">(</span><span class="kw5">int</span> node<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw2">if</span> <span class="br0">(</span>boolean<span class="br0">(</span>typeCast<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span>, DT_Bool<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span> <span class="co1">//if true</span>
  <span class="br0">{</span>
    _codeblock<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span><span class="br0">)</span>; <span class="co1">// then</span>
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">children</span>.<span class="me0">length</span> <span class="sy0">&gt;=</span> <span class="nu0">3</span><span class="br0">)</span> <span class="co1">// else</span>
  <span class="br0">{</span>
    _codeblock<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">2</span><span class="br0">)</span><span class="br0">)</span>;
  <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>Check if the first child node evaluates to <i>true</i>, and if so execute the second child node which is the <i>then</i> statement. If not check if there's a third child (the optional <i>else</i> part), and execute it.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">private</span> <span class="kw1">function</span> _whiledo<span class="br0">(</span><span class="kw5">int</span> node<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw2">while</span> <span class="br0">(</span>boolean<span class="br0">(</span>typeCast<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span>, DT_Bool<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span> <span class="co1">//while true</span>
  <span class="br0">{</span>
    _codeblock<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span><span class="br0">)</span>; <span class="co1">// do</span>
  <span class="br0">}</span>  
<span class="br0">}</span>
 
<span class="kw1">private</span> <span class="kw1">function</span> _codeblock<span class="br0">(</span><span class="kw5">int</span> node<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> <span class="kw5">int</span> i;
  <span class="kw2">if</span> <span class="br0">(</span><span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_Keyword<span class="br0">)</span> <span class="sy0">&amp;&amp;</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __BEGIN<span class="br0">)</span><span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">for</span> <span class="br0">(</span>i <span class="sy0">=</span> <span class="nu0">0</span>; i <span class="sy0">&lt;</span> a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">children</span>.<span class="me0">length</span>; i<span class="sy0">++</span><span class="br0">)</span>
    <span class="br0">{</span>
      ExecuteRoot<span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">children</span><span class="br0">[</span>i<span class="br0">]</span><span class="br0">)</span>;
    <span class="br0">}</span>
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="br0">{</span>
    ExecuteRoot<span class="br0">(</span>node<span class="br0">)</span>;
  <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>If the current node is a <i>begin</i> root node we will execute all it's children, if not it's just a single statement and we execute that one.</p>
<p>Note that I just call the ExecuteRoot function, this means that there is a possibility for inline variable and function declaration even tho the language specification doesn't allow it the interpreter accepts it.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">private</span> <span class="kw1">function</span> Scope.<span class="me0">Declaration</span> _expr<span class="br0">(</span><span class="kw5">int</span> node, <span class="kw1">optional</span> Scope.<span class="me0">DeclarationType</span> type<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw2">return</span> _boolex<span class="br0">(</span>node, type<span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">private</span> <span class="kw1">function</span> Scope.<span class="me0">Declaration</span> _boolex<span class="br0">(</span><span class="kw5">int</span> node, <span class="kw1">optional</span> Scope.<span class="me0">DeclarationType</span> type<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> Scope.<span class="me0">Declaration</span> d;
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_Keyword<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __LT<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, type<span class="br0">)</span>;
      type <span class="sy0">=</span> d.<span class="me0">type</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">&lt;</span> <span class="kw5">Int</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Float<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">&lt;</span> <span class="kw5">Float</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Bool<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span> <span class="sy0">&lt;</span> <span class="kw5">Int</span><span class="br0">(</span>Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_String<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span>d.<span class="me0">value</span> <span class="sy0">&lt;</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span>;
      d.<span class="me0">type</span> <span class="sy0">=</span> DT_Bool;
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __LE<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, type<span class="br0">)</span>;
      type <span class="sy0">=</span> d.<span class="me0">type</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">&lt;=</span> <span class="kw5">Int</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Float<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">&lt;=</span> <span class="kw5">Float</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Bool<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span> <span class="sy0">&lt;=</span> <span class="kw5">Int</span><span class="br0">(</span>Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_String<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span>d.<span class="me0">value</span> <span class="sy0">&lt;=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span>;
      d.<span class="me0">type</span> <span class="sy0">=</span> DT_Bool;
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __GT<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, type<span class="br0">)</span>;
      type <span class="sy0">=</span> d.<span class="me0">type</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">&gt;</span> <span class="kw5">Int</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Float<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">&gt;</span> <span class="kw5">Float</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Bool<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span> <span class="sy0">&gt;</span> <span class="kw5">Int</span><span class="br0">(</span>Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_String<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span>d.<span class="me0">value</span> <span class="sy0">&gt;</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span>;
      d.<span class="me0">type</span> <span class="sy0">=</span> DT_Bool;
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __GE<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, type<span class="br0">)</span>;
      type <span class="sy0">=</span> d.<span class="me0">type</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">&gt;=</span> <span class="kw5">Int</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Float<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">&gt;=</span> <span class="kw5">Float</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Bool<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span> <span class="sy0">&gt;=</span> <span class="kw5">Int</span><span class="br0">(</span>Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_String<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span>d.<span class="me0">value</span> <span class="sy0">&gt;=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span>;
      d.<span class="me0">type</span> <span class="sy0">=</span> DT_Bool;
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __EQ<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, type<span class="br0">)</span>;
      type <span class="sy0">=</span> d.<span class="me0">type</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">==</span> <span class="kw5">Int</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Float<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">==</span> <span class="kw5">Float</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Bool<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span>Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">==</span> Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_String<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span>d.<span class="me0">value</span> <span class="sy0">==</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span>;
      d.<span class="me0">type</span> <span class="sy0">=</span> DT_Bool;
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __NE<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, type<span class="br0">)</span>;
      type <span class="sy0">=</span> d.<span class="me0">type</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">!=</span> <span class="kw5">Int</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Float<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">!=</span> <span class="kw5">Float</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Bool<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span>Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">!=</span> Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_String<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span>d.<span class="me0">value</span> <span class="sy0">!=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span>;
      d.<span class="me0">type</span> <span class="sy0">=</span> DT_Bool;
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __AND<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span>;
      d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span> Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span><span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span> <span class="br0">)</span>;
      d.<span class="me0">type</span> <span class="sy0">=</span> DT_Bool;
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __OR<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span>;
      d.<span class="me0">value</span> <span class="sy0">=</span> boolToString<span class="br0">(</span>Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">||</span> Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span><span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      d.<span class="me0">type</span> <span class="sy0">=</span> DT_Bool;
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
  <span class="br0">}</span>
  <span class="kw2">return</span> _accum<span class="br0">(</span>node, type<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p>Right hand side will be type casted to the left hand side, that's why we temporarily save the result of the left hand side so that we can pass the type to the right hand side.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">private</span> <span class="kw1">function</span> Scope.<span class="me0">Declaration</span> _accum<span class="br0">(</span><span class="kw5">int</span> node, <span class="kw1">optional</span> Scope.<span class="me0">DeclarationType</span> type<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> Scope.<span class="me0">Declaration</span> d;
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_Keyword<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __PLUS<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, type<span class="br0">)</span>;
      type <span class="sy0">=</span> d.<span class="me0">type</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">+</span> <span class="kw5">Int</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Float<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">+</span> <span class="kw5">Float</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Bool<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span>Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span>Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_String<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> d.<span class="me0">value</span> <span class="sy0">$</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span>;
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __MINUS<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, type<span class="br0">)</span>;
      type <span class="sy0">=</span> d.<span class="me0">type</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">-</span> <span class="kw5">Int</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Float<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">-</span> <span class="kw5">Float</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Bool<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span>Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span>Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_String<span class="br0">)</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span>;
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
  <span class="br0">}</span>
  <span class="kw2">return</span> _mult<span class="br0">(</span>node, type<span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">private</span> <span class="kw1">function</span> Scope.<span class="me0">Declaration</span> _mult<span class="br0">(</span><span class="kw5">int</span> node, <span class="kw1">optional</span> Scope.<span class="me0">DeclarationType</span> type<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> Scope.<span class="me0">Declaration</span> d;
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_Keyword<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __MULTIPLY<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, type<span class="br0">)</span>;
      type <span class="sy0">=</span> d.<span class="me0">type</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">*</span> <span class="kw5">Int</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Float<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">*</span> <span class="kw5">Float</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Bool<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span>Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">||</span> Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>; 
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_String<span class="br0">)</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>; <span class="co1">// ??</span>
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __DIVIDE<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, type<span class="br0">)</span>;
      type <span class="sy0">=</span> d.<span class="me0">type</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span>  <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">/</span> <span class="kw5">Int</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Float<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">/</span> <span class="kw5">Float</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Bool<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span>Boolean<span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">||</span> <span class="sy0">!</span>Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>; 
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_String<span class="br0">)</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>; <span class="co1">//?</span>
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
    <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __MOD<span class="br0">)</span>
    <span class="br0">{</span>
      d <span class="sy0">=</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, type<span class="br0">)</span>;
      type <span class="sy0">=</span> d.<span class="me0">type</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Int<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span>  <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span><span class="kw5">Int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">%</span> <span class="kw5">Int</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Float<span class="br0">)</span> d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span><span class="kw5">Float</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span> <span class="sy0">%</span> <span class="kw5">Float</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_Bool<span class="br0">)</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>; <span class="co1">// ??</span>
      <span class="kw2">if</span> <span class="br0">(</span>type <span class="sy0">==</span> DT_String<span class="br0">)</span> _expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, type<span class="br0">)</span>; <span class="co1">//?</span>
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
  <span class="br0">}</span>
  <span class="kw2">return</span> _preop<span class="br0">(</span>node, type<span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">private</span> <span class="kw1">function</span> Scope.<span class="me0">Declaration</span> _preop<span class="br0">(</span><span class="kw5">int</span> node, <span class="kw1">optional</span> Scope.<span class="me0">DeclarationType</span> type<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> Scope.<span class="me0">Declaration</span> d;
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_Keyword<span class="br0">)</span>
  <span class="br0">{</span>
    <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> <span class="sy0">==</span> __NOT<span class="br0">)</span>
    <span class="br0">{</span>
      d.<span class="me0">type</span> <span class="sy0">=</span> DT_Bool;
      d.<span class="me0">value</span> <span class="sy0">=</span> BoolToString<span class="br0">(</span><span class="sy0">!</span>Boolean<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, DT_Bool<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">)</span>;
      <span class="kw2">return</span> d;
    <span class="br0">}</span>
  <span class="br0">}</span>
  <span class="kw2">return</span> _operand<span class="br0">(</span>node, type<span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">private</span> <span class="kw1">function</span> Scope.<span class="me0">Declaration</span> _operand<span class="br0">(</span><span class="kw5">int</span> node, <span class="kw1">optional</span> Scope.<span class="me0">DeclarationType</span> type<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> Scope.<span class="me0">Declaration</span> d;
  d.<span class="me0">value</span> <span class="sy0">=</span> a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span>;
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_Identifier<span class="br0">)</span>
  <span class="br0">{</span>
    d <span class="sy0">=</span> s.<span class="me0">getDeclaration</span><span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span><span class="br0">)</span>;
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_String<span class="br0">)</span>
  <span class="br0">{</span>
    d.<span class="me0">type</span> <span class="sy0">=</span> DT_String;
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_Boolean<span class="br0">)</span>
  <span class="br0">{</span>
    d.<span class="me0">type</span> <span class="sy0">=</span> DT_Bool;
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_Integer<span class="br0">)</span>
  <span class="br0">{</span>
    d.<span class="me0">type</span> <span class="sy0">=</span> DT_Int;
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_Float<span class="br0">)</span>
  <span class="br0">{</span>
    d.<span class="me0">type</span> <span class="sy0">=</span> DT_Float;
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">type</span> <span class="sy0">==</span> NT_Function<span class="br0">)</span>
  <span class="br0">{</span>
    d <span class="sy0">=</span> _functioncall<span class="br0">(</span>node<span class="br0">)</span>;
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="br0">{</span>
    <span class="kw3">Warn</span><span class="br0">(</span><span class="st0">"Unexpected node:"</span><span class="sy0">@</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span><span class="br0">)</span>;
    <span class="kw2">Assert</span><span class="br0">(</span><span class="kw6">false</span><span class="br0">)</span>;
  <span class="br0">}</span>
  <span class="kw2">if</span> <span class="br0">(</span><span class="br0">(</span>type <span class="sy0">!=</span> <span class="kw7">DT_None</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> <span class="br0">(</span>d.<span class="me0">type</span> <span class="sy0">!=</span> type<span class="br0">)</span><span class="br0">)</span> d <span class="sy0">=</span> typeCast<span class="br0">(</span>d, type<span class="br0">)</span>; <span class="co1">// from to</span>
  <span class="kw2">return</span> d;
<span class="br0">}</span>
 
<span class="kw1">private</span> <span class="kw1">function</span> Scope.<span class="me0">Declaration</span> _functioncall<span class="br0">(</span><span class="kw5">int</span> node<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> Scope.<span class="me0">Declaration</span> d;
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> ~<span class="sy0">=</span> <span class="st0">"print"</span><span class="br0">)</span>
  <span class="br0">{</span>
    d <span class="sy0">=</span> typeCast<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span>, DT_String<span class="br0">)</span>;
    <span class="kw3">log</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span>;
    <span class="kw2">return</span> d;
  <span class="br0">}</span>
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> ~<span class="sy0">=</span> <span class="st0">"argc"</span><span class="br0">)</span>
  <span class="br0">{</span>
    d.<span class="me0">type</span> <span class="sy0">=</span> DT_Int;
    d.<span class="me0">value</span> <span class="sy0">=</span> <span class="kw5">String</span><span class="br0">(</span>input.<span class="me0">length</span><span class="br0">)</span>;
    <span class="kw2">return</span> d;
  <span class="br0">}</span>
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> ~<span class="sy0">=</span> <span class="st0">"argv"</span><span class="br0">)</span>
  <span class="br0">{</span>
    d.<span class="me0">type</span> <span class="sy0">=</span> DT_String;
    d.<span class="me0">value</span> <span class="sy0">=</span> input<span class="br0">[</span><span class="kw5">Int</span><span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span>, DT_Int<span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span><span class="br0">]</span>;
    <span class="kw2">return</span> d;
  <span class="br0">}</span>
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> ~<span class="sy0">=</span> <span class="st0">"int"</span><span class="br0">)</span>
  <span class="br0">{</span>
    d <span class="sy0">=</span> typeCast<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span>, DT_Int<span class="br0">)</span>;
    <span class="kw2">return</span> d;
  <span class="br0">}</span>
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> ~<span class="sy0">=</span> <span class="st0">"float"</span><span class="br0">)</span>
  <span class="br0">{</span>
    d <span class="sy0">=</span> typeCast<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span>, DT_Float<span class="br0">)</span>;
    <span class="kw2">return</span> d;
  <span class="br0">}</span>
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> ~<span class="sy0">=</span> <span class="st0">"string"</span><span class="br0">)</span>
  <span class="br0">{</span>
    d <span class="sy0">=</span> typeCast<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span>, DT_String<span class="br0">)</span>;
    <span class="kw2">return</span> d;
  <span class="br0">}</span>
  <span class="kw2">if</span> <span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span> ~<span class="sy0">=</span> <span class="st0">"bool"</span><span class="br0">)</span>
  <span class="br0">{</span>
    d <span class="sy0">=</span> typeCast<span class="br0">(</span>_expr<span class="br0">(</span>Child<span class="br0">(</span>node, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span>, DT_Bool<span class="br0">)</span>;
    <span class="kw2">return</span> d;
  <span class="br0">}</span>
  <span class="kw2">else</span> <span class="br0">{</span>
    d <span class="sy0">=</span> s.<span class="me0">getDeclaration</span><span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span>, DT_Function<span class="br0">)</span>;
    d <span class="sy0">=</span> _execfunction<span class="br0">(</span><span class="kw5">int</span><span class="br0">(</span>d.<span class="me0">value</span><span class="br0">)</span>, node<span class="br0">)</span>;
    <span class="kw2">return</span> d;
  <span class="br0">}</span>
  <span class="kw3">Warn</span><span class="br0">(</span><span class="st0">"Undeclared function:"</span><span class="sy0">@</span>a.<span class="me0">Tree</span><span class="br0">[</span>node<span class="br0">]</span>.<span class="me0">value</span><span class="br0">)</span>;
  <span class="kw2">Assert</span><span class="br0">(</span><span class="kw6">false</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p>First check if the function call is a built-in function, otherwise look if there's a custom function defined. If so, execute that node.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">private</span> <span class="kw1">function</span> _function<span class="br0">(</span><span class="kw5">int</span> node<span class="br0">)</span>
<span class="br0">{</span>
  <span class="co1">//               function name        </span>
  s.<span class="me0">newDeclaration</span><span class="br0">(</span>ChildValue<span class="br0">(</span>node, <span class="nu0">1</span><span class="br0">)</span>, DT_Function, <span class="kw5">string</span><span class="br0">(</span>node<span class="br0">)</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p>A function declaration, just take the first node and skip the rest. We only need to read the rest when the function is executed.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">private</span> <span class="kw1">function</span> Scope.<span class="me0">Declaration</span> _execfunction<span class="br0">(</span><span class="kw5">int</span> func, <span class="kw5">int</span> node<span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw1">local</span> Scope.<span class="me0">Declaration</span> d;
  <span class="kw1">local</span> <span class="kw5">int</span> i, j;
  s.<span class="me0">openScope</span><span class="br0">(</span><span class="br0">)</span>;                      
  s.<span class="me0">newDeclaration</span><span class="br0">(</span>FUNCRESULT, s.<span class="me0">stringToType</span><span class="br0">(</span>ChildValue<span class="br0">(</span>func, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>; <span class="co1">// return type</span>
  j <span class="sy0">=</span> Child<span class="br0">(</span>func, <span class="nu0">1</span><span class="br0">)</span>;
  <span class="kw2">for</span> <span class="br0">(</span>i <span class="sy0">=</span> <span class="nu0">0</span>; i <span class="sy0">&lt;</span> a.<span class="me0">tree</span><span class="br0">[</span>j<span class="br0">]</span>.<span class="me0">children</span>.<span class="me0">length</span>; i<span class="sy0">++</span><span class="br0">)</span>
  <span class="br0">{</span>
    _var<span class="br0">(</span>Child<span class="br0">(</span>j, i<span class="br0">)</span>, _expr<span class="br0">(</span>Child<span class="br0">(</span>node, i<span class="br0">)</span><span class="br0">)</span>.<span class="me0">value</span><span class="br0">)</span>;
  <span class="br0">}</span>
  <span class="kw2">for</span> <span class="br0">(</span>i <span class="sy0">=</span> <span class="nu0">2</span>; i <span class="sy0">&lt;</span> a.<span class="me0">tree</span><span class="br0">[</span>func<span class="br0">]</span>.<span class="me0">children</span>.<span class="me0">length</span>; i<span class="sy0">++</span><span class="br0">)</span> <span class="co1">// 0 = return type, 1 = function name</span>
  <span class="br0">{</span>
    ExecuteRoot<span class="br0">(</span>a.<span class="me0">Tree</span><span class="br0">[</span>func<span class="br0">]</span>.<span class="me0">children</span><span class="br0">[</span>i<span class="br0">]</span><span class="br0">)</span>;
  <span class="br0">}</span>
  d <span class="sy0">=</span> s.<span class="me0">getDeclaration</span><span class="br0">(</span>FUNCRESULT<span class="br0">)</span>;
  s.<span class="me0">closeScope</span><span class="br0">(</span><span class="br0">)</span>;
  <span class="kw2">return</span> d;
<span class="br0">}</span>
</pre></div>
</div>
<p>Jump to the node where the function is declared. We need node of the function call because we need to input arguments. We only read the number of argument that are defined. So it's possible to enter more arguments in a function call than required, we just ignore them.</p>
<p>Each function argument is a local variable with an initial value, which would be the result of the expression passed to it.</p>
<p>When we enter the function we will first open a new scope level, this is to distinguish local and global variables. A local and global variable may have the same name, but the most local variable is just.</p>

<!-- 
NewPP limit report
CPU time usage: 0.252 seconds
Real time usage: 0.288 seconds
Preprocessor visited node count: 43/1000000
Preprocessor generated node count: 284/1000000
Postexpand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key wiki:pcache:idhash:605-0!*!*!*!*!*!* and timestamp 20161215153327 and revision id 1820
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://wiki.beyondunreal.com/Legacy:BruteForce/Interpreter?oldid=1820">https://wiki.beyondunreal.com/Legacy:BruteForce/Interpreter?oldid=1820</a>"</div>
					<div id='catlinks' class='catlinks catlinks-allhidden'></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-legacy" class="selected"><a href="Interpreter.html">Legacy</a></li>
				<li id="ca-talk" class="new"><a href="https://wiki.beyondunreal.com/edit/Legacy_talk:BruteForce/Interpreter?redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-edit"><a href="https://wiki.beyondunreal.com/edit/Legacy:BruteForce/Interpreter" title="You can edit this page. Please use the preview button before saving [e]" accesskey="e">Edit</a></li>
				<li id="ca-history"><a href="https://wiki.beyondunreal.com/history/Legacy:BruteForce/Interpreter" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-anonuserpage"><a href="../User_188.162.37.html" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">188.162.37.3</a></li>
													<li id="pt-anontalk"><a href="../User_talk_188.162.37.html" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li>
													<li id="pt-createaccount"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=Legacy%3ABruteForce%2FInterpreter&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=Legacy%3ABruteForce%2FInterpreter" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="../index.html" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-mainpage"><a href="../index.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li>
											<li id="n-portal"><a href="../Unreal_Wiki_Community_portal-2.html" title="About the project, what you can do, where to find things">Community portal</a></li>
											<li id="n-recentchanges"><a href="https://wiki.beyondunreal.com/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="https://wiki.beyondunreal.com/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
											<li id="n-Forums-.28General.29"><a href="https://forums.beyondunreal.com/forums/wiki-general.250/" rel="nofollow">Forums (General)</a></li>
											<li id="n-Forums-.28Technical.29"><a href="https://forums.beyondunreal.com/forums/wiki-technical.251/" rel="nofollow">Forums (Technical)</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="https://wiki.beyondunreal.com/" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Unreal Wiki [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="https://wiki.beyondunreal.com/Special:WhatLinksHere/Legacy:BruteForce/Interpreter" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="https://wiki.beyondunreal.com/Special:RecentChangesLinked/Legacy:BruteForce/Interpreter" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="https://wiki.beyondunreal.com/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="https://wiki.beyondunreal.com/Legacy:BruteForce/Interpreter?printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="https://wiki.beyondunreal.com/Legacy:BruteForce/Interpreter?oldid=1820" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="https://wiki.beyondunreal.com/info/Legacy:BruteForce/Interpreter" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="../../licensebuttons.net/l/by-nc-sa/3.0/88x31.png" alt="Attribution-Noncommercial-Share Alike 3.0" width="88" height="31" /></a>
							</div>
					<div id="f-poweredbyico">
									<script async src="../../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
        <!-- Home Page -->
        <ins class="adsbygoogle"
             style="display:inline-block;width:728px;height:90px"
             data-ad-client="ca-pub-9605963037553244"
             data-ad-slot="9528541415"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
							</div>
					<ul id="f-list">
									<li id="lastmod"> Last modified at 10:40, 24 April 2003.</li>
									<li id="copyright">Licensed as <a href="../Unreal_Wiki_Copyrights.html" title="Unreal Wiki:Copyrights">Attribution-Noncommercial-Share Alike 3.0</a>.</li>
									<li id="privacy"><a href="../Unreal_Wiki_Privacy_policy.html" title="Unreal Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="../Unreal_Wiki_About.html" title="Unreal Wiki:About">About Unreal Wiki</a></li>
									<li id="disclaimer"><a href="../Unreal_Wiki_General_disclaimer.html" title="Unreal Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.beyondunreal.com/w/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=monobook\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":82});
}</script></body>
<!-- Mirrored from wiki.beyondunreal.com/Legacy:BruteForce/Interpreter by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 09:37:35 GMT -->
</html>
