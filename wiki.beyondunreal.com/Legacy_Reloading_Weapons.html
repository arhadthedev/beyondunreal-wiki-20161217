<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.beyondunreal.com/Legacy:Reloading_Weapons by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 07:55:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>Legacy:Reloading Weapons - Unreal Wiki</title>
<meta name="generator" content="MediaWiki 1.25.1" />
<link rel="alternate" type="application/x-wiki" title="Edit" href="https://wiki.beyondunreal.com/edit/Legacy:Reloading_Weapons" />
<link rel="edit" title="Edit" href="https://wiki.beyondunreal.com/edit/Legacy:Reloading_Weapons" />
<link rel="shortcut icon" href="w/uewiki-favicon.png" />
<link rel="search" type="application/opensearchdescription+xml" href="w/opensearch_desc.php" title="Unreal Wiki" />
<link rel="EditURI" type="application/rsd+xml" href="w/api251f.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="Legacy_Reloading_Weapons.html" />
<link rel="copyright" href="Unreal_Wiki_Copyrights.html" />
<link rel="alternate" type="application/atom+xml" title="Unreal Wiki Atom feed" href="https://wiki.beyondunreal.com/Special:RecentChanges?feed=atom" />
<link rel="stylesheet" href="w/load2743.css?debug=false&amp;lang=en&amp;modules=ext.geshi.language.uscript%7Cmediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if IE 6]><link rel="stylesheet" href="/w/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/w/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="w/load484a.css?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=monobook&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: wiki:resourceloader:filter:minify-css:7:29b70323345a439ab9ed7007e0c178a6 */</style>
<script src="w/load9316.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"Legacy","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":100,"wgPageName":"Legacy:Reloading_Weapons","wgTitle":"Reloading Weapons","wgCurRevisionId":6263,"wgRevisionId":6263,"wgArticleId":2626,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Legacy Tutorial"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Legacy:Reloading_Weapons","wgRelevantArticleId":2626,"wgIsProbablyEditable":true,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgCategoryTreePageCategoryOptions":"{\"mode\":0,\"hideprefix\":20,\"showcount\":true,\"namespaces\":false}"});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: wiki:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-100 ns-subject page-Legacy_Reloading_Weapons skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
									<div id="siteNotice"><div id="localNotice" lang="en" dir="ltr"><p>My program doesn't have bugs. It just develops random features.
</p></div></div>
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Legacy:Reloading Weapons</h1>

				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Unreal Wiki, The Unreal Engine Documentation Site</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p><i>This tutorial does NOT work in UT2004.</i></p>
<p><i>Attempted offline fix. No test, just using my memory... -Solid Snake</i></p>
<h2><span class="mw-headline" id="Reloading_Weapons.">Reloading Weapons.</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Reloading_Weapons?section=1" title="Edit section: Reloading Weapons.">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>I've put quite a bit of effort in to making robust reloading code for the <a href="Legacy_Weapon.html" title="Legacy:Weapon">Weapons</a> in the LawDogs mod. Since reloading is something that is potentially useful to everyone, I have made the code available here (minus all the stuff that doesn't relate to reloading).</p>
<p>It is complete with features allowing for sounds, animations and other effects, it works on-line and as far as I can tell it is virtually free of bugs. All the main code is contained in a weapon class. It is an abstract class, the actual weapons are subclasses of it.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> ReloadingWeapon <span class="kw1">extends</span> <span class="kw9">Weapon</span>
	<span class="kw1">abstract</span>;
 
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw5">int</span> ClipCount; <span class="co1">//What's that you say? Clip is not a technically correct term? Do I care?</span>
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw5">float</span> ReloadRate; <span class="co1">//Time it takes to insert one bullet.</span>
<span class="kw1">var</span> <span class="kw5">float</span> ReloadTimer;
 
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw5">sound</span> ReloadBeginSound, ReloadSound, ReloadEndSound; <span class="co1">//Sounds played when start to reload, on insertion of each bullet, and when reloading has ended.</span>
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw5">name</span> ReloadAnim; <span class="co1">//Animation to play when reloading is started.</span>
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw5">float</span> ReloadAnimRate;
 
<span class="kw1">var</span> <span class="kw5">bool</span> bIsReloading, bReloadEffectDone;
 
<span class="kw1">replication</span>
<span class="br0">{</span>
	<span class="kw1">reliable</span> <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span>
		ClipCount;
 
	<span class="co1">//Functions called on the server from the client.</span>
	<span class="kw1">reliable</span> <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">&lt;</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span>
		ReloadMeNow, FinishReloading;
 
	<span class="co1">//Functions called on the client from the server.</span>
	<span class="kw1">reliable</span> <span class="kw2">if</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span>
		ClientReload, ClientFinishReloading, ClientReloadEffects;
<span class="br0">}</span>
 
<span class="co1">//So reloading can be bound to a key. Exec functions in weapons can only be called for the currently held weapon, which is perfect for this purpose.</span>
<span class="kw1">exec</span> <span class="kw1">function</span> ReloadMeNow<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw2">if</span><span class="br0">(</span><span class="sy0">!</span>AllowReload<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
		<span class="kw2">return</span>;
 
	bIsReloading <span class="sy0">=</span> <span class="kw6">true</span>;
	ReloadTimer <span class="sy0">=</span> <span class="kw7">Level</span>.<span class="me0">TimeSeconds</span>;
	<span class="kw4">PlaySound</span><span class="br0">(</span>ReloadBeginSound, <span class="kw7">SLOT_Misc</span>, <span class="kw7">TransientSoundVolume</span>,,,, <span class="kw6">false</span><span class="br0">)</span>;
	ClientReload<span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="co1">//Called on the client when reloading starts.</span>
<span class="kw1">simulated</span> <span class="kw1">function</span> ClientReload<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	bIsReloading <span class="sy0">=</span> <span class="kw6">true</span>;
	<span class="kw4">PlayAnim</span><span class="br0">(</span>ReloadAnim, ReloadAnimRate, <span class="nu0">0.1</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="co1">//For effects during reloading, like smoke or shells ejected from the breech.</span>
<span class="kw1">simulated</span> <span class="kw1">function</span> ClientReloadEffects<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span><span class="br0">}</span>
 
<span class="co1">//Reloading ends when the key is released.</span>
<span class="kw1">exec</span> <span class="kw1">function</span> FinishReloading<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw2">if</span><span class="br0">(</span><span class="sy0">!</span>bIsReloading<span class="br0">)</span>
		<span class="kw2">return</span>;
 
	<span class="kw4">PlaySound</span><span class="br0">(</span>ReloadEndSound, <span class="kw7">SLOT_Misc</span>, <span class="kw7">TransientSoundVolume</span>,,,, <span class="kw6">false</span><span class="br0">)</span>;
	ClientFinishReloading<span class="br0">(</span><span class="br0">)</span>;
	bIsReloading <span class="sy0">=</span> <span class="kw6">false</span>;
	bReloadEffectDone <span class="sy0">=</span> <span class="kw6">false</span>;
<span class="br0">}</span>
 
<span class="co1">//Called on the client when reloading ends.</span>
<span class="kw1">simulated</span> <span class="kw1">function</span> ClientFinishReloading<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	bIsReloading <span class="sy0">=</span> <span class="kw6">false</span>;
	PlayIdle<span class="br0">(</span><span class="br0">)</span>;
 
	<span class="kw2">if</span><span class="br0">(</span><span class="kw7">Instigator</span>.<span class="me0">PendingWeapon</span> <span class="sy0">!=</span> <span class="kw5">None</span> <span class="sy0">&amp;&amp;</span> <span class="kw7">Instigator</span>.<span class="me0">PendingWeapon</span> <span class="sy0">!=</span> <span class="kw6">self</span><span class="br0">)</span>
		<span class="kw7">Instigator</span>.<span class="kw9">Controller</span>.<span class="me0">ClientSwitchToBestWeapon</span><span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="co1">//I compressed this to make it a little tider. I have no idea why I do this... is it harder to read or </span>
<span class="co1">//do I just like smaller UC files...</span>
<span class="kw1">function</span> <span class="kw5">bool</span> AllowReload<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	<span class="co1">//Can't reload whilst firing, reloading, if the clip is full or if we don't have enough ammo.</span>
	<span class="kw2">if</span><span class="br0">(</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me0">IsFiring</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">||</span> FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me0">IsFiring</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> 
           bIsReloading <span class="sy0">&amp;&amp;</span> ClipCount <span class="sy0">&gt;=</span> <span class="kw1">Default</span>.<span class="me0">ClipCount</span> <span class="sy0">&amp;&amp;</span> 
           <span class="br0">(</span><span class="kw9">Ammo</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">==</span> <span class="kw5">None</span> <span class="sy0">||</span> <span class="kw9">Ammo</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me0">AmmoAmount</span> <span class="sy0">&lt;=</span> ClipCount<span class="br0">)</span><span class="br0">)</span>
		<span class="kw2">return</span> <span class="kw6">false</span>;
	<span class="kw2">return</span> <span class="kw6">true</span>;
<span class="br0">}</span>
 
<span class="co1">//Don't allow weapon switching whilst reloading.</span>
<span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw5">bool</span> PutDown<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw2">if</span><span class="br0">(</span>bIsReloading<span class="br0">)</span>
		<span class="kw2">return</span> <span class="kw6">false</span>;
 
	<span class="kw2">return</span> <span class="kw6">Super</span>.<span class="me0">PutDown</span><span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">function</span> BringUp<span class="br0">(</span><span class="kw1">optional</span> <span class="kw9">Weapon</span> PrevWeapon<span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw6">Super</span>.<span class="me0">BringUp</span><span class="br0">(</span>PrevWeapon<span class="br0">)</span>;
	bIsReloading <span class="sy0">=</span> <span class="kw6">false</span>;
<span class="br0">}</span>
 
<span class="co1">//Reduce ClipCount every time a bullet is fired.</span>
<span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw5">bool</span> ConsumeAmmo<span class="br0">(</span><span class="kw5">int</span> Mode, <span class="kw5">float</span> load, <span class="kw1">optional</span> <span class="kw5">bool</span> bAmountNeededIsMax<span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw2">if</span><span class="br0">(</span><span class="kw9">Ammo</span><span class="br0">[</span>Mode<span class="br0">]</span> <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span>
	<span class="br0">{</span>
		<span class="kw2">if</span><span class="br0">(</span><span class="kw9">Ammo</span><span class="br0">[</span>Mode<span class="br0">]</span>.<span class="me0">UseAmmo</span><span class="br0">(</span><span class="kw5">int</span><span class="br0">(</span>load<span class="br0">)</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> load <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span>
			ClipCount<span class="sy0">--</span>;
	<span class="br0">}</span>
<span class="br0">}</span>
 
<span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw5">bool</span> HasAmmo<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	<span class="co1">//Ignore FireMode[1] which doesn't use any ammo.</span>
	<span class="kw2">return</span> <span class="br0">(</span><span class="kw9">Ammo</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">!=</span> <span class="kw5">None</span> <span class="sy0">&amp;&amp;</span> FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">!=</span> <span class="kw5">None</span> <span class="sy0">&amp;&amp;</span> <span class="kw9">Ammo</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me0">AmmoAmount</span> <span class="sy0">&gt;=</span> FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me0">AmmoPerFire</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">event</span> WeaponTick<span class="br0">(</span><span class="kw5">float</span> dt<span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw2">if</span><span class="br0">(</span><span class="sy0">!</span>bIsReloading<span class="br0">)</span>
	<span class="br0">{</span>
		<span class="co1">//Stupid bots like to run around with an empty weapon, so force them to reload when appropriate.</span>
		<span class="kw2">if</span><span class="br0">(</span><span class="sy0">!</span><span class="kw7">Instigator</span>.<span class="me0">IsHumanControlled</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
		<span class="br0">{</span>
			<span class="kw2">if</span><span class="br0">(</span><span class="kw7">Level</span>.<span class="me0">TimeSeconds</span> <span class="sy0">-</span> <span class="kw7">Instigator</span>.<span class="kw9">Controller</span>.<span class="me0">LastSeenTime</span> <span class="sy0">&gt;</span> ClipCount<span class="br0">)</span>
				ReloadMeNow<span class="br0">(</span><span class="br0">)</span>;
		<span class="br0">}</span>
	<span class="br0">}</span>
	<span class="kw2">else</span>
	<span class="br0">{</span>
		<span class="co1">//Add one bullet at a time as long as reloading key is held down.</span>
		<span class="kw2">if</span><span class="br0">(</span><span class="kw7">Level</span>.<span class="me0">TimeSeconds</span> <span class="sy0">-</span> ReloadTimer <span class="sy0">&gt;=</span> ReloadRate<span class="br0">)</span>
		<span class="br0">{</span>
			<span class="kw2">if</span><span class="br0">(</span>ClipCount <span class="sy0">&gt;=</span> <span class="kw1">Default</span>.<span class="me0">ClipCount</span><span class="br0">)</span> <span class="co1">//Full.</span>
			<span class="br0">{</span>
				ClipCount <span class="sy0">=</span> <span class="kw1">Default</span>.<span class="me0">ClipCount</span>;
				FinishReloading<span class="br0">(</span><span class="br0">)</span>;
			<span class="br0">}</span>
			<span class="kw2">else</span> <span class="kw2">if</span><span class="br0">(</span><span class="kw9">Ammo</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me0">AmmoAmount</span> <span class="sy0">&lt;=</span> ClipCount<span class="br0">)</span> <span class="co1">//Out of ammo.</span>
			<span class="br0">{</span>
				ClipCount <span class="sy0">=</span> <span class="kw9">Ammo</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me0">AmmoAmount</span>;
				FinishReloading<span class="br0">(</span><span class="br0">)</span>;
			<span class="br0">}</span>
			<span class="kw2">else</span> <span class="co1">//Add another bullet.</span>
			<span class="br0">{</span>
				<span class="kw4">PlaySound</span><span class="br0">(</span>ReloadSound, <span class="kw7">SLOT_Misc</span>, <span class="kw7">TransientSoundVolume</span>,,,, <span class="kw6">false</span><span class="br0">)</span>;
				InsertBullet<span class="br0">(</span><span class="br0">)</span>;
 
				<span class="kw2">if</span><span class="br0">(</span>ClipCount <span class="sy0">&gt;=</span> <span class="kw1">Default</span>.<span class="me0">ClipCount</span><span class="br0">)</span>
				<span class="br0">{</span>
					ReloadTimer <span class="sy0">=</span> <span class="kw7">Level</span>.<span class="me0">TimeSeconds</span> <span class="sy0">-</span> <span class="br0">(</span>ReloadRate <span class="sy0">/</span> <span class="nu0">2</span><span class="br0">)</span>;
				<span class="br0">}</span>
				<span class="kw2">else</span>
					ReloadTimer <span class="sy0">=</span> <span class="kw7">Level</span>.<span class="me0">TimeSeconds</span>;
			<span class="br0">}</span>
		<span class="br0">}</span>
		<span class="kw2">else</span> <span class="kw2">if</span><span class="br0">(</span><span class="sy0">!</span>bReloadEffectDone <span class="sy0">&amp;&amp;</span> <span class="kw7">Level</span>.<span class="me0">TimeSeconds</span> <span class="sy0">-</span> ReloadTimer <span class="sy0">&gt;=</span> ReloadRate <span class="sy0">/</span> <span class="nu0">2</span><span class="br0">)</span>
		<span class="br0">{</span>
			bReloadEffectDone <span class="sy0">=</span> <span class="kw6">true</span>;
			ClientReloadEffects<span class="br0">(</span><span class="br0">)</span>;
		<span class="br0">}</span>
	<span class="br0">}</span>
<span class="br0">}</span>
 
<span class="co1">//Can play animations for inserting individual bullets here, or other effects. </span>
<span class="co1">//Server-side only, so should call a replicated function here and play animations in it, </span>
<span class="co1">//rather than in this function itself.</span>
<span class="kw1">function</span> InsertBullet<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	ClipCount<span class="sy0">++</span>;
<span class="br0">}</span>
 
<span class="co1">//Show how many bullets left until reload.</span>
<span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw5">float</span> ChargeBar<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw1">local</span> <span class="kw5">float</span> CurrentClip, MaxClip;
 
	<span class="co1">//Store the int values as floats to avoid rounding errors.</span>
	CurrentClip <span class="sy0">=</span> ClipCount;
	MaxClip <span class="sy0">=</span> <span class="kw1">Default</span>.<span class="me0">ClipCount</span>;
 
	<span class="kw2">return</span> <span class="kw3">FMin</span><span class="br0">(</span><span class="nu0">1</span>, CurrentClip<span class="sy0">/</span>MaxClip<span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">function</span> <span class="kw5">byte</span> BestMode<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw2">if</span><span class="br0">(</span>ClipCount <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span>
		<span class="kw2">return</span> <span class="nu0">0</span>;
 
	<span class="kw2">return</span> <span class="nu0">1</span>;
<span class="br0">}</span>
 
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
	ClipCount<span class="sy0">=</span><span class="nu0">6</span>
	ReloadRate<span class="sy0">=</span><span class="nu0">1.0</span>
	ReloadAnim<span class="sy0">=</span>Reload
	ReloadAnimRate<span class="sy0">=</span><span class="nu0">1.0</span>
 
	bShowChargingBar<span class="sy0">=</span><span class="kw6">True</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>Bullets are inserted one at a time. If you wanted to completely fill the weapon in one go (as would be the case with most modern-style weapons) then change the bit in the InsertBullet function to <b>ClipCount = Default.ClipCount</b></p>
<p>To have reloading triggered from a key press, two functions need to be bound to one key. For example, in User.ini:</p>
<p><b>E=ReloadMeNow | OnRelease FinishReloading</b></p>
<p>To make it easier to bind for end-users, you can make a custom <a href="Legacy_GUIUserKeyBinding.html" title="Legacy:GUIUserKeyBinding">GUIUserKeyBinding</a>, which will make the bind show up in the controls menu. Here is an example:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> ReloadBinding <span class="kw1">extends</span> GUIUserKeyBinding;
 
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
	KeyData<span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">=</span><span class="br0">(</span>KeyLabel<span class="sy0">=</span><span class="st0">"YourMod"</span>,bIsSection<span class="sy0">=</span><span class="kw6">True</span><span class="br0">)</span>
	KeyData<span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">=</span><span class="br0">(</span>Alias<span class="sy0">=</span><span class="st0">"ReloadMeNow | OnRelease FinishReloading"</span>,KeyLabel<span class="sy0">=</span><span class="st0">"Reload"</span><span class="br0">)</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>As well as reloading from a key, it can also be done from alt-fire, like this:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> ReloadFire <span class="kw1">extends</span> <span class="kw8">WeaponFire</span>;
 
<span class="kw1">event</span> ModeDoFire<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	ReloadingWeapon<span class="br0">(</span><span class="kw9">Weapon</span><span class="br0">)</span>.<span class="me0">ReloadMeNow</span><span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">function</span> StopFiring<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	ReloadingWeapon<span class="br0">(</span><span class="kw9">Weapon</span><span class="br0">)</span>.<span class="me0">FinishReloading</span><span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">function</span> <span class="kw5">bool</span> IsFiring<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw2">return</span> <span class="kw6">false</span>;
<span class="br0">}</span>
 
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
	bModeExclusive<span class="sy0">=</span><span class="kw6">true</span>
	bWaitForRelease<span class="sy0">=</span><span class="kw6">true</span>
	FireRate<span class="sy0">=</span><span class="nu0">0.2</span>
	BotRefireRate<span class="sy0">=</span><span class="nu0">1.0</span>
	AmmoClass<span class="sy0">=</span><span class="kw1">class</span><span class="st0">'BallAmmo'</span>
<span class="br0">}</span>
</pre></div>
</div>
<p>Last but not least, to ensure that the firemode(s) can only fire whilst there is ammo in the clip:</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> ReloadFire <span class="kw1">extends</span> ProjectileFire
	<span class="kw1">abstract</span>;
 
<span class="kw1">var</span> <span class="kw5">float</span> LastClickTime;
 
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw5">Name</span> EmptyAnim;
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw5">float</span> EmptyAnimRate;
 
<span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw5">bool</span> AllowFire<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw2">if</span><span class="br0">(</span>ReloadingWeapon<span class="br0">(</span><span class="kw9">Weapon</span><span class="br0">)</span>.<span class="me0">bIsReloading</span><span class="br0">)</span>
		<span class="kw2">return</span> <span class="kw6">false</span>;
 
	<span class="kw2">if</span><span class="br0">(</span>ReloadingWeapon<span class="br0">(</span><span class="kw9">Weapon</span><span class="br0">)</span>.<span class="me0">ClipCount</span> <span class="sy0">&lt;</span> <span class="nu0">1</span><span class="br0">)</span>
	<span class="br0">{</span>
		<span class="kw2">if</span><span class="br0">(</span><span class="kw7">Level</span>.<span class="me0">TimeSeconds</span> <span class="sy0">-</span> LastClickTime <span class="sy0">&gt;</span> FireRate<span class="br0">)</span>
		<span class="br0">{</span>
			<span class="kw9">Weapon</span>.<span class="kw4">PlayOwnedSound</span><span class="br0">(</span>NoAmmoSound, <span class="kw7">SLOT_Interact</span>, <span class="kw7">TransientSoundVolume</span>,,,, <span class="kw6">false</span><span class="br0">)</span>;
			LastClickTime <span class="sy0">=</span> <span class="kw7">Level</span>.<span class="me0">TimeSeconds</span>;
 
			<span class="kw2">if</span><span class="br0">(</span><span class="kw9">Weapon</span>.<span class="kw4">HasAnim</span><span class="br0">(</span>EmptyAnim<span class="br0">)</span><span class="br0">)</span>
				<span class="kw9">weapon</span>.<span class="kw4">PlayAnim</span><span class="br0">(</span>EmptyAnim, EmptyAnimRate, <span class="nu0">0.0</span><span class="br0">)</span>;
		<span class="br0">}</span>
 
		<span class="kw2">return</span> <span class="kw6">false</span>;
	<span class="br0">}</span>
 
	LastClickTime <span class="sy0">=</span> <span class="kw7">Level</span>.<span class="me0">TimeSeconds</span>;
 
	<span class="kw2">return</span> <span class="kw6">Super</span>.<span class="me0">AllowFire</span><span class="br0">(</span><span class="br0">)</span>;
 
<span class="br0">}</span>
</pre></div>
</div>
<p>In this case it is a <a href="Legacy_ProjectileFire.html" title="Legacy:ProjectileFire">ProjectileFire</a>, but it applies exactly the same for <a href="Legacy_InstantFire.html" title="Legacy:InstantFire">InstantFire</a> classes.</p>
<p><a href="Category_Legacy_Tutorial.html" title="Category:Legacy Tutorial">Category:Legacy Tutorial</a></p>
<p><b>Stagger:</b> Does not seem to like UT2004 or vice versa. Does not compile as-is, spits out error over difference between consumeammo in reloadingweapon and weapon classes. Tried simply renaming consumeammo function, compiled successfully, but cannot select reloading weapon in game, gives the "(weapon name) is out of ammo" message, even if you enter allammo code.</p>
<p><b>Tarquin:</b> Do you people not LOOK at what happens after you have posted? Please reformat your text, it is currently unreadable.</p>
<p><b>Tarquin:</b> see <a rel="nofollow" class="external free" href="http://forums.beyondunreal.com/showthread.php?t=141177">http://forums.beyondunreal.com/showthread.php?t=141177</a> seems the code for this tute has a problem.</p>
<p><b>Solid Snake:</b> I wonder if that works. I doubt it...</p>
<p><b>MythOpus:</b> Stagger: It keeps saying the out of ammo message because you don't have a proper AmmoClass in the default properties of the weapon fire... If you subclass your weapons from the custom code above and add an ammo class it should work. Solid Snake: This code DOES work... just not too well&#160;:)</p>
<p><b>Solid Snake:</b> Great, I just did some syntax fixes. When I whack in my own reloading code, I'll post it here as well. This one is a shotgun type reloading I think, a bullet at a time. I'll be doing both methods I think.</p>
<p><b>MythOpus:</b> That explains a whole lot. I tried using this code for one of my mods awhile back... I used it for an assault rifle and it didn't work too well... I guess I know why now... Didn't think about it being for a shotgun&#160;:(. I cant wait for YOUR reloading code Though&#160;:D</p>
<p><b>Benoît</b> Ce tut est vraiment sympa, ca fait un bout de temps que je cherche de la doc sur les replications. Merci. / This tut's really great. I've been looking for good tuts about replications for a while. Thanks.</p>
<p><b>Benoît</b>&#160;: Are you sure about the declaration 'simulated function bool ConsumeAmmo(int Mode, float load, optional bool bAmountNeededIsMax)' (signature needed&#160;: function ConsumeAmmo(int Mode, float load))&#160;? I had a compilation error and had to modify a bit, but the rest works fine&#160;:)</p>
<p><b>Switch`:</b> To make it work with UT2004's bNoAmmoInstances feature you may try following changes: (untested!)</p>
<ol>
<li>Replace all instances of <tt>Ammo[0].AmmoAmount</tt> with <tt>AmmoAmount(0)</tt></li>
<li>Replace all instances of <tt>Ammo[0]==None</tt> with <tt>AmmoAmount(0)==0</tt></li>
<li>Remove the overloaded HasAmmo() function from ReloadingWeapon source, in FireMode[1] set AmmoPerFire=0 in defaultproperties</li>
<li>Use Super.ConsumeAmmo()</li>
</ol>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw5">bool</span> ConsumeAmmo<span class="br0">(</span> <span class="kw5">int</span> Mode, <span class="kw5">float</span> Load, <span class="kw1">optional</span> <span class="kw5">bool</span> bAmountNeededIsMax <span class="br0">)</span>
<span class="br0">{</span>
	<span class="kw2">if</span><span class="br0">(</span> <span class="kw6">Super</span>.<span class="me0">ConsumeAmmo</span><span class="br0">(</span>Mode, Load, bAmountNeededIsMax<span class="br0">)</span> <span class="br0">)</span>
	<span class="br0">{</span>
		<span class="kw2">if</span><span class="br0">(</span> Load <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="br0">)</span>
			ClipCount<span class="sy0">--</span>;
		<span class="kw2">return</span> <span class="kw6">true</span>;
	<span class="br0">}</span>
	<span class="kw2">return</span> <span class="kw6">false</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p><b>Kohan:</b> Bleh, it's not a magazine-based one. Can I warp some of your code to make it magazine-based? I'd put it in a separate tutorial, of course.</p>
<p><b>OlympusMons:</b> Yeah clipcount is alittle misleading as it is actually the amount of ammo in the clip, a quick fix would be to do this so when you reload the complete ammo is added in one hit. This is untested but you could try...</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">function</span> InsertBullet<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
    ClipCount<span class="sy0">=</span><span class="kw1">Default</span>.<span class="me0">ClipCount</span>;
<span class="br0">}</span>
</pre></div>
</div>
<p>For a better version you could make clipcount the amount of clips by doing ammo amount x ammo per clip, which should give you the amount of clips. Then you can make a ammo in clip variable which would replace the old clipcount, Im kinda thinking out loud here so you'll have to work it out alittle more perhaps. Im pretty sure Im going in the right direction, there is replication to take into consideration as well I think.</p>

<!-- 
NewPP limit report
CPU time usage: 0.103 seconds
Real time usage: 0.105 seconds
Preprocessor visited node count: 22/1000000
Preprocessor generated node count: 136/1000000
Post‐expand include size: 17/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key wiki:pcache:idhash:2626-0!*!0!*!*!*!* and timestamp 20161215142630 and revision id 6263
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://wiki.beyondunreal.com/Legacy:Reloading_Weapons?oldid=6263">https://wiki.beyondunreal.com/Legacy:Reloading_Weapons?oldid=6263</a>"</div>
					<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="https://wiki.beyondunreal.com/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="Category_Legacy_Tutorial.html" title="Category:Legacy Tutorial">Legacy Tutorial</a></li></ul></div></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-legacy" class="selected"><a href="Legacy_Reloading_Weapons.html">Legacy</a></li>
				<li id="ca-talk" class="new"><a href="https://wiki.beyondunreal.com/edit/Legacy_talk:Reloading_Weapons?redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-edit"><a href="https://wiki.beyondunreal.com/edit/Legacy:Reloading_Weapons" title="You can edit this page. Please use the preview button before saving [e]" accesskey="e">Edit</a></li>
				<li id="ca-history"><a href="https://wiki.beyondunreal.com/history/Legacy:Reloading_Weapons" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-createaccount"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=Legacy%3AReloading+Weapons&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=Legacy%3AReloading+Weapons" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="index.html" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-mainpage"><a href="index.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li>
											<li id="n-portal"><a href="Unreal_Wiki_Community_portal-2.html" title="About the project, what you can do, where to find things">Community portal</a></li>
											<li id="n-recentchanges"><a href="https://wiki.beyondunreal.com/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="https://wiki.beyondunreal.com/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
											<li id="n-Forums-.28General.29"><a href="https://forums.beyondunreal.com/forums/wiki-general.250/" rel="nofollow">Forums (General)</a></li>
											<li id="n-Forums-.28Technical.29"><a href="https://forums.beyondunreal.com/forums/wiki-technical.251/" rel="nofollow">Forums (Technical)</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="https://wiki.beyondunreal.com/" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Unreal Wiki [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="https://wiki.beyondunreal.com/Special:WhatLinksHere/Legacy:Reloading_Weapons" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="https://wiki.beyondunreal.com/Special:RecentChangesLinked/Legacy:Reloading_Weapons" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="https://wiki.beyondunreal.com/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="https://wiki.beyondunreal.com/Legacy:Reloading_Weapons?printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="https://wiki.beyondunreal.com/Legacy:Reloading_Weapons?oldid=6263" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="https://wiki.beyondunreal.com/info/Legacy:Reloading_Weapons" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="../licensebuttons.net/l/by-nc-sa/3.0/88x31.png" alt="Attribution-Noncommercial-Share Alike 3.0" width="88" height="31" /></a>
							</div>
					<div id="f-poweredbyico">
									<script async src="../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
        <!-- Home Page -->
        <ins class="adsbygoogle"
             style="display:inline-block;width:728px;height:90px"
             data-ad-client="ca-pub-9605963037553244"
             data-ad-slot="9528541415"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
							</div>
					<ul id="f-list">
									<li id="lastmod"> Last modified at 11:29, 24 August 2006.</li>
									<li id="copyright">Licensed as <a href="Unreal_Wiki_Copyrights.html" title="Unreal Wiki:Copyrights">Attribution-Noncommercial-Share Alike 3.0</a>.</li>
									<li id="privacy"><a href="Unreal_Wiki_Privacy_policy.html" title="Unreal Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="Unreal_Wiki_About.html" title="Unreal Wiki:About">About Unreal Wiki</a></li>
									<li id="disclaimer"><a href="Unreal_Wiki_General_disclaimer.html" title="Unreal Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.beyondunreal.com/w/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=monobook\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":95});
}</script></body>
<!-- Mirrored from wiki.beyondunreal.com/Legacy:Reloading_Weapons by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 07:55:22 GMT -->
</html>
