<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.beyondunreal.com/Legacy:Dma/JetPack by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 09:41:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>Legacy:Dma/JetPack - Unreal Wiki</title>
<meta name="generator" content="MediaWiki 1.25.1" />
<link rel="alternate" type="application/x-wiki" title="Edit" href="https://wiki.beyondunreal.com/edit/Legacy:Dma/JetPack" />
<link rel="edit" title="Edit" href="https://wiki.beyondunreal.com/edit/Legacy:Dma/JetPack" />
<link rel="shortcut icon" href="../w/uewiki-favicon.png" />
<link rel="search" type="application/opensearchdescription+xml" href="../w/opensearch_desc.php" title="Unreal Wiki" />
<link rel="EditURI" type="application/rsd+xml" href="../w/api251f.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="JetPack.html" />
<link rel="copyright" href="../Unreal_Wiki_Copyrights.html" />
<link rel="alternate" type="application/atom+xml" title="Unreal Wiki Atom feed" href="https://wiki.beyondunreal.com/Special:RecentChanges?feed=atom" />
<link rel="stylesheet" href="../w/load2743.css?debug=false&amp;lang=en&amp;modules=ext.geshi.language.uscript%7Cmediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if IE 6]><link rel="stylesheet" href="/w/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/w/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="../w/load484a.css?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=monobook&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: wiki:resourceloader:filter:minify-css:7:29b70323345a439ab9ed7007e0c178a6 */</style>
<script src="../w/load9316.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"Legacy","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":100,"wgPageName":"Legacy:Dma/JetPack","wgTitle":"Dma/JetPack","wgCurRevisionId":2642,"wgRevisionId":2642,"wgArticleId":978,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Legacy Custom Class (UT)","Legacy Custom Class (UT2004)"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Legacy:Dma/JetPack","wgRelevantArticleId":978,"wgIsProbablyEditable":true,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgCategoryTreePageCategoryOptions":"{\"mode\":0,\"hideprefix\":20,\"showcount\":true,\"namespaces\":false}"});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});
/* cache key: wiki:resourceloader:filter:minify-js:7:a5c52c063dc436c1ca7c9f456936a5e9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-100 ns-subject page-Legacy_Dma_JetPack skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
									<div id="siteNotice"><div id="localNotice" lang="en" dir="ltr"><p>Always snap to grid
</p></div></div>
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Legacy:Dma/JetPack</h1>

				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Unreal Wiki, The Unreal Engine Documentation Site</div>
					<div id="contentSub"><span class="subpages">&lt; <a href="../Legacy_Dma.html" title="Legacy:Dma">Legacy:Dma</a></span></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>I was just writing this to see how hard it would be...</p>
<p>Known bugs:</p>
<ul>
<li>No HUD notification of the fuel status.</li>
<li>Expire message doesn't disappear.</li>
<li>You can't see your own trails in first-person mode.</li>
<li>There isn't any physical jetpack attached to shoulder or spine bones.</li>
<li>Client-side simulation isn't right.</li>
</ul>
<p><b>Dma:</b> I just realized that PostNetBeginPlay is used to catch variable replications. And I was the one who posted it at <a href="../Legacy_Creating_Actors_And_Objects.html" title="Legacy:Creating Actors And Objects">Creating_Actors_And_Objects</a>. Looks like I forgot.&#160;:-)</p>
<p>If you have any hints about the proper method of replicating the acceleration caused by the jet pack so as to avoid ClientAdjustPosition calls (the jerkiness that results when the authoritative server tells the client where the pawn should be), I would be <b>very</b> grateful. The calls seem to have changed since UT1.</p>
<p>Also, feel free to make comments on this page. Feel free to chastise me for my overuse of the <b>simulated</b> keyword. Perhaps I should use an autonomous proxy or something.</p>
<p>This whole "project" is actually my excercise in understanding the player movement commands under lag and packet-loss conditions, not to mention the pitfalls of the visibility of attached objects and changing relevance of actors.</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="co1">//=============================================================================</span>
<span class="co1">// JetPack</span>
<span class="co1">// http://www.coe.uncc.edu/~danderse/</span>
<span class="co1">//=============================================================================</span>
<span class="kw1">class</span> JetPack <span class="kw1">extends</span> <span class="kw9">Powerups</span>;
 
<span class="kw1">replication</span> <span class="br0">{</span>
 
    <span class="co1">// Send these variables to the client.</span>
    <span class="kw1">reliable</span> <span class="kw2">if</span> <span class="br0">(</span><span class="kw7">Role</span><span class="sy0">==</span><span class="kw7">ROLE_Authority</span><span class="br0">)</span>
        Strength, AmbJetSound, JetTrailClass, JetTrail, SoundActor;
 
    <span class="co1">// Server calls these functions on the client.</span>
    <span class="kw1">reliable</span> <span class="kw2">if</span> <span class="br0">(</span><span class="kw7">Role</span><span class="sy0">==</span><span class="kw7">ROLE_Authority</span><span class="br0">)</span>
        ClientGotoState;
<span class="br0">}</span>
 
<span class="kw1">var</span> <span class="kw9">xEmitter</span> JetTrail;                  <span class="co1">// The Jet Trail.</span>
<span class="kw1">var</span> JetPackInteraction OurInteraction;  <span class="co1">// Our hud stuff!</span>
<span class="kw1">var</span> <span class="kw5">bool</span> bGotOwner;
 
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> class<span class="sy0">&lt;</span>xEmitter<span class="sy0">&gt;</span> JetTrail<span class="re0">Class</span>&lt; SEMI &gt;    <span class="co1">// This isn't used yet.</span>
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw5">sound</span> AmbJetSound;
 
<span class="kw1">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw5">float</span> Strength;
 
<span class="kw1">var</span> JetPackSound SoundActor;
<span class="kw1">var</span> <span class="kw5">int</span> TickCount;
 
<span class="co1">//=============================================================================</span>
<span class="co1">// This little piece of garbage waits until the owner is successfully</span>
<span class="co1">// replicated to the client.  This is a bizarre way to fix accessed nones.</span>
<span class="co1">//=============================================================================</span>
<span class="kw1">state</span> ActivateWhenGetOwner <span class="br0">{</span>
    <span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw3">BeginState</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
        <span class="kw2">if</span> <span class="br0">(</span><span class="kw7">Owner</span> <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
            <span class="kw3">log</span><span class="br0">(</span><span class="st0">"ActivateWhenGetOwner.  Owner="</span> <span class="sy0">$</span> <span class="kw7">Owner</span><span class="br0">)</span>;
            bNetNotify<span class="sy0">=</span><span class="kw6">false</span>;
            <span class="kw3">GotoState</span><span class="br0">(</span><span class="st0">'Activated'</span><span class="br0">)</span>;
        <span class="br0">}</span>
    <span class="br0">}</span>
 
    <span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw4">PostNetReceive</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
        <span class="kw6">Super</span>.<span class="kw4">PostNetReceive</span><span class="br0">(</span><span class="br0">)</span>;
        <span class="kw3">log</span><span class="br0">(</span><span class="st0">"Got PostNetReceive.  Owner="</span> <span class="sy0">$</span> <span class="kw7">Owner</span><span class="br0">)</span>;
        <span class="kw2">if</span> <span class="br0">(</span><span class="kw7">Owner</span> <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
            bNetNotify<span class="sy0">=</span><span class="kw6">false</span>;
            <span class="kw3">GotoState</span><span class="br0">(</span><span class="st0">'Activated'</span><span class="br0">)</span>;
        <span class="br0">}</span>
    <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="co1">//=============================================================================</span>
<span class="co1">// I hate this.  'Activate' is not simulated so it must manually</span>
<span class="co1">// instruct the client to ALSO go into the 'Activated' state.  </span>
<span class="co1">//</span>
<span class="co1">// However, Owner (and probably some other properties) are not </span>
<span class="co1">// valid for the first few ticks.  Therefore, I must instruct the </span>
<span class="co1">// client to go to the intermediate state of 'ActivateWhenGetOwner',</span>
<span class="co1">// which uses the new PostNetReceive() notification function that </span>
<span class="co1">// is enabled when bNetNotify=true.  Since the 'Activated' state must</span>
<span class="co1">// have access to Owner, I make the client wait until it gets an Owner</span>
<span class="co1">// before activating.  </span>
 
<span class="co1">// This usually only takes a few ticks.</span>
<span class="co1">//=============================================================================</span>
<span class="kw1">simulated</span> <span class="kw1">function</span> ClientGotoState<span class="br0">(</span><span class="kw5">name</span> NewState<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw3">log</span><span class="br0">(</span><span class="st0">"ClientGotoState: "</span> <span class="sy0">$</span> <span class="kw5">String</span><span class="br0">(</span>NewState<span class="br0">)</span><span class="br0">)</span>;
    <span class="kw3">GotoState</span><span class="br0">(</span>NewState<span class="br0">)</span>;
<span class="br0">}</span>
 
 
<span class="kw1">function</span> PerformMove<span class="br0">(</span><span class="kw9">PlayerController</span> PC, <span class="kw5">vector</span> Accel, <span class="kw5">float</span> DeltaTime<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">local</span> SavedMove sm;
 
    sm <span class="sy0">=</span> PC.<span class="me0">getFreeMove</span><span class="br0">(</span><span class="br0">)</span>;
    sm.<span class="me0">SetMoveFor</span><span class="br0">(</span>PC, DeltaTime, Accel, PC.<span class="me0">DoubleClickDir</span><span class="br0">)</span>;
    sm.<span class="me0">SavedLocation</span> <span class="sy0">=</span> PC.<span class="kw9">Pawn</span>.<span class="kw7">Location</span>;
    sm.<span class="me0">SavedVelocity</span> <span class="sy0">=</span> PC.<span class="kw9">Pawn</span>.<span class="kw7">Velocity</span>;
<span class="br0">}</span>
 
 
 
<span class="kw1">state</span> Activated <span class="br0">{</span>
    <span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw3">BeginState</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
        <span class="kw1">local</span> <span class="kw9">Pawn</span> P;
        <span class="kw1">local</span> <span class="kw9">PlayerController</span> PC;
 
        <span class="co1">// Be sure that we are no longer being distracted by</span>
        <span class="co1">// notifications of replication events.</span>
        bNetNotify<span class="sy0">=</span><span class="kw6">false</span>;
 
        P <span class="sy0">=</span> <span class="kw9">Pawn</span><span class="br0">(</span><span class="kw7">Owner</span><span class="br0">)</span>;
 
        <span class="kw2">if</span> <span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span> <span class="br0">{</span>
            <span class="co1">// Give the player's spinebone an effect.  Make sure this works.</span>
            JetTrail <span class="sy0">=</span> <span class="kw4">spawn</span><span class="br0">(</span><span class="kw1">class</span><span class="st0">'SpeedTrail'</span>, P,, P.<span class="kw7">Location</span>, P.<span class="kw7">Rotation</span><span class="br0">)</span>; 
 
            JetTrail.<span class="kw4">SetPhysics</span><span class="br0">(</span><span class="kw7">PHYS_None</span><span class="br0">)</span>;
            JetTrail.<span class="me0">bSuspendWhenNotVisible</span><span class="sy0">=</span><span class="kw6">false</span>;
 
            <span class="kw2">if</span> <span class="br0">(</span>P <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
                P.<span class="kw4">AttachToBone</span><span class="br0">(</span>JetTrail, <span class="st0">'Bip01 Spine2'</span><span class="br0">)</span>;
                JetTrail.<span class="kw4">SetRelativeLocation</span><span class="br0">(</span><span class="kw3">Vect</span><span class="br0">(</span><span class="sy0">-</span><span class="nu0">10</span>,<span class="nu0">50</span>,<span class="sy0">-</span><span class="nu0">50</span><span class="br0">)</span><span class="br0">)</span>;
            <span class="br0">}</span>
        <span class="br0">}</span>
 
        <span class="kw2">if</span> <span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span> <span class="br0">{</span>
            <span class="kw3">log</span><span class="br0">(</span><span class="st0">"Calling spawn..."</span><span class="br0">)</span>;
            SoundActor <span class="sy0">=</span> <span class="kw4">Spawn</span><span class="br0">(</span><span class="kw1">class</span><span class="st0">'JetPackSound'</span>,P,,P.<span class="kw7">Location</span>, P.<span class="kw7">Rotation</span><span class="br0">)</span>;
            <span class="kw3">log</span><span class="br0">(</span><span class="st0">"Spawn got: "</span> <span class="sy0">$</span> SoundActor<span class="br0">)</span>;
        <span class="br0">}</span>
 
 
        <span class="co1">// Add some stuff to the HUD.</span>
        <span class="kw2">if</span> <span class="br0">(</span><span class="kw7">Level</span>.<span class="me0">NetMode</span> <span class="sy0">!=</span> NM_DedicatedServer<span class="br0">)</span> <span class="br0">{</span>
            PC <span class="sy0">=</span> <span class="kw9">PlayerController</span><span class="br0">(</span>P.<span class="kw9">Controller</span><span class="br0">)</span>;
            <span class="kw2">if</span> <span class="br0">(</span>PC <span class="sy0">!=</span> <span class="kw5">None</span> <span class="sy0">&amp;&amp;</span> Viewport<span class="br0">(</span>PC.<span class="kw8">Player</span><span class="br0">)</span> <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
                <span class="co1">// Player is being controlled locally at the time of activation!</span>
                <span class="co1">// Pre-existing Global Interactions:</span>
                <span class="co1">// GUIController'Package.InteractionMaster0.GUIController0'</span>
                <span class="co1">// ExtendedConsole'Package.InteractionMaster0.ExtendedConsole0'</span>
 
                <span class="co1">// Create a local interaction.</span>
                OurInteraction <span class="sy0">=</span> JetPackInteraction<span class="br0">(</span>
                    PC.<span class="kw8">Player</span>.<span class="kw8">InteractionMaster</span>.<span class="me0">AddInteraction</span><span class="br0">(</span><span class="st0">"JetPack.JetPackInteraction"</span>, PC.<span class="kw8">Player</span><span class="br0">)</span><span class="br0">)</span>;
            <span class="br0">}</span>
        <span class="br0">}</span>
 
        <span class="kw6">Super</span>.<span class="kw3">BeginState</span><span class="br0">(</span><span class="br0">)</span>;
    <span class="br0">}</span>
 
    <span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw3">EndState</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
        <span class="kw2">if</span> <span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span> <span class="sy0">&amp;&amp;</span> JetTrail <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
            JetTrail.<span class="kw4">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
        <span class="br0">}</span>
 
        <span class="kw2">if</span> <span class="br0">(</span>SoundActor <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
            SoundActor.<span class="me0">SetSound</span><span class="br0">(</span><span class="kw5">None</span><span class="br0">)</span>;
            SoundActor.<span class="kw4">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
        <span class="br0">}</span>
 
        <span class="co1">// Get rid of our HUD interaction.</span>
        <span class="kw2">if</span> <span class="br0">(</span>OurInteraction <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
            OurInteraction.<span class="me0">DieAlready</span><span class="br0">(</span><span class="br0">)</span>;
            OurInteraction <span class="sy0">=</span> <span class="kw5">None</span>;
        <span class="br0">}</span>
 
        <span class="kw6">Super</span>.<span class="kw3">EndState</span><span class="br0">(</span><span class="br0">)</span>;
    <span class="br0">}</span>
 
    <span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw4">Tick</span><span class="br0">(</span><span class="kw5">float</span> DeltaTime<span class="br0">)</span> <span class="br0">{</span>
        <span class="kw1">local</span> <span class="kw9">PlayerController</span> PC;
        <span class="kw1">local</span> <span class="kw9">Pawn</span> P;
        <span class="kw1">local</span> <span class="kw5">vector</span> X,Y,Z;
        <span class="kw1">local</span> <span class="kw5">vector</span> Accel;
 
        P <span class="sy0">=</span> <span class="kw9">Pawn</span><span class="br0">(</span><span class="kw7">Owner</span><span class="br0">)</span>;
        PC <span class="sy0">=</span> <span class="kw9">PlayerController</span><span class="br0">(</span>P.<span class="kw9">Controller</span><span class="br0">)</span>;
 
        <span class="kw2">if</span> <span class="br0">(</span><span class="br0">(</span>PC <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> <span class="br0">(</span>P <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
            <span class="kw2">if</span> <span class="br0">(</span><span class="br0">(</span>PC.<span class="me0">bDuck</span> <span class="sy0">!=</span> <span class="nu0">0</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> <span class="br0">(</span>P.<span class="kw7">Physics</span> <span class="sy0">==</span> <span class="kw7">PHYS_Falling</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
 
                <span class="co1">// Turn on the Jet Trail.  Unpause the xEmitter.</span>
                <span class="kw2">if</span> <span class="br0">(</span>JetTrail <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
                    JetTrail.<span class="me0">mRegenPause</span><span class="sy0">=</span><span class="kw6">False</span>;
                <span class="br0">}</span>
 
                <span class="co1">// Thrust the player.</span>
                <span class="kw3">GetAxes</span><span class="br0">(</span>PC.<span class="kw7">Rotation</span>, X, Y, Z<span class="br0">)</span>;
                <span class="co1">// Z = Normal(Z);</span>
                Accel <span class="sy0">=</span> Z<span class="sy0">*</span>Strength;
<span class="coMULTI">/*
                // Try to replicate client movement to server.
                if (Role &lt; ROLE_Authority) {
                    PerformMove(PC, Accel, DeltaTime);
                }
*/</span>
                P.<span class="me0">AddVelocity</span><span class="br0">(</span>Z<span class="sy0">*</span>Strength<span class="sy0">*</span>DeltaTime<span class="br0">)</span>;
 
                <span class="kw2">if</span> <span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">&lt;</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span> <span class="br0">{</span>
                    PC.<span class="me0">ShortServerMove</span><span class="br0">(</span><span class="kw7">Level</span>.<span class="me0">TimeSeconds</span>, P.<span class="kw7">Location</span>, PC.<span class="me0">bRun</span><span class="sy0">!=</span><span class="nu0">0</span>, PC.<span class="me0">bDuck</span><span class="sy0">!=</span><span class="nu0">0</span>, PC.<span class="me0">bJumpStatus</span>, P.<span class="kw7">Rotation</span>.<span class="me0">Roll</span> <span class="sy0">/</span> <span class="nu0">256</span>, <span class="nu0">0</span><span class="br0">)</span>;
                <span class="br0">}</span>
 
<span class="co1">//              log("Would replicate move - accel = " $ String(-4*Accel));</span>
                <span class="kw2">if</span> <span class="br0">(</span><span class="kw7">Level</span>.<span class="me0">NetMode</span> <span class="sy0">!=</span> NM_DedicatedServer<span class="br0">)</span> <span class="br0">{</span>
<span class="co1">//                  log("Replicating move - accel = " $ String(-4*Accel));</span>
<span class="co1">//                  PC.ReplicateMove(DeltaTime, -4*Accel, PC.DoubleClickDir, rot(0,0,0));</span>
                <span class="br0">}</span>
 
                <span class="co1">// Turn on the jetpack sound.</span>
                <span class="kw2">if</span> <span class="br0">(</span>SoundActor <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
                    SoundActor.<span class="me0">SetSound</span><span class="br0">(</span>AmbJetSound<span class="br0">)</span>;
                <span class="br0">}</span>
 
                <span class="co1">// Make it burn fuel.</span>
                Charge <span class="sy0">-=</span> <span class="br0">(</span>DeltaTime <span class="sy0">*</span> <span class="nu0">100</span><span class="br0">)</span>;
                <span class="kw2">if</span> <span class="br0">(</span>Charge <span class="sy0">&lt;=</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>
                    UsedUp<span class="br0">(</span><span class="br0">)</span>;
                <span class="br0">}</span>
 
            <span class="br0">}</span> <span class="kw2">else</span> <span class="br0">{</span>
 
                <span class="co1">// Turn off the Jet Trail.  Pause the xEmitter.</span>
                <span class="kw2">if</span> <span class="br0">(</span>JetTrail <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
                    JetTrail.<span class="me0">mRegenPause</span><span class="sy0">=</span><span class="kw6">True</span>;
                <span class="br0">}</span>
 
                <span class="co1">// Turn off the jetpack sound.  </span>
                <span class="kw2">if</span> <span class="br0">(</span>SoundActor <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
                    SoundActor.<span class="me0">SetSound</span><span class="br0">(</span><span class="kw5">None</span><span class="br0">)</span>;
                <span class="br0">}</span>
            <span class="br0">}</span> <span class="co1">// if (not) thrusting</span>
            <span class="co1">// ...</span>
        <span class="br0">}</span>
<span class="co1">//      Global.Tick(DeltaTime);</span>
    <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="co1">// We are no longer being held.</span>
<span class="kw1">function</span> <span class="kw4">Destroyed</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw3">GotoState</span><span class="br0">(</span><span class="st0">''</span><span class="br0">)</span>;
 
    <span class="co1">// Get rid of our HUD interaction.</span>
    <span class="kw2">if</span> <span class="br0">(</span>OurInteraction <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
        OurInteraction.<span class="me0">DieAlready</span><span class="br0">(</span><span class="br0">)</span>;
        OurInteraction <span class="sy0">=</span> <span class="kw5">None</span>;
    <span class="br0">}</span>
 
    <span class="co1">// Remove from player's inventory.</span>
    <span class="kw6">Super</span>.<span class="kw4">Destroyed</span><span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">function</span> Activate<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw2">if</span><span class="br0">(</span> bActivatable <span class="br0">)</span> <span class="br0">{</span>
        <span class="kw3">GoToState</span><span class="br0">(</span><span class="st0">'Activated'</span><span class="br0">)</span>;
        <span class="co1">// I suppose the first part is redundant below.</span>
        <span class="kw2">if</span> <span class="br0">(</span><span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">==</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> <span class="br0">(</span><span class="kw7">Level</span>.<span class="me0">NetMode</span> <span class="sy0">!=</span> NM_ListenServer<span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
            <span class="co1">// The client is being told to activate once it gets an owner.</span>
            ClientGotoState<span class="br0">(</span><span class="st0">'ActivateWhenGetOwner'</span><span class="br0">)</span>;
        <span class="br0">}</span>
    <span class="br0">}</span>
<span class="br0">}</span>
 
 
<span class="kw1">simulated</span> <span class="kw1">function</span> <span class="kw4">PostBeginPlay</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
   <span class="kw3">Enable</span><span class="br0">(</span><span class="st0">'Tick'</span><span class="br0">)</span>;
   <span class="kw6">Super</span>.<span class="kw4">PostBeginPlay</span><span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
   <span class="kw7">RemoteRole</span><span class="sy0">=</span><span class="kw7">ROLE_SimulatedProxy</span>
   ExpireMessage<span class="sy0">=</span><span class="st0">"Your jetpack ran out of gas."</span>
   bAutoActivate<span class="sy0">=</span><span class="kw6">True</span>
   bActivatable<span class="sy0">=</span><span class="kw6">True</span>
   bNetNotify<span class="sy0">=</span><span class="kw6">True</span>
   PickupClass<span class="sy0">=</span><span class="kw1">class</span><span class="st0">'JetPackPickup'</span>
   Charge<span class="sy0">=</span><span class="nu0">10000</span>
   Strength<span class="sy0">=</span><span class="nu0">3000</span>
   AmbJetSound<span class="sy0">=</span><span class="kw5">Sound</span><span class="st0">'WeaponSounds.BaseGunTech.BTranslocatorHoverModule'</span>
   JetTrailClass<span class="sy0">=</span><span class="kw1">class</span><span class="st0">'RocketTrailSmoke'</span>;
<span class="br0">}</span>
</pre></div>
</div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="kw1">class</span> JetPackInteraction <span class="kw1">extends</span> <span class="kw8">Interaction</span>;
 
<span class="kw1">var</span> <span class="kw5">int</span> Fuel;
 
<span class="kw1">function</span> GetFuelFromViewTarget<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">local</span> <span class="kw9">Pawn</span> VT;
    <span class="kw1">local</span> JetPack JP;
    VT <span class="sy0">=</span> <span class="kw9">Pawn</span><span class="br0">(</span>ViewportOwner.<span class="kw9">Actor</span>.<span class="me0">ViewTarget</span><span class="br0">)</span>;
 
    <span class="kw2">if</span> <span class="br0">(</span>VT <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
        <span class="co1">// Viewport is looking at a pawn.</span>
        JP <span class="sy0">=</span> JetPack<span class="br0">(</span>VT.<span class="me0">FindInventoryType</span><span class="br0">(</span><span class="kw1">class</span><span class="st0">'JetPack'</span><span class="br0">)</span><span class="br0">)</span>;
        <span class="kw2">if</span> <span class="br0">(</span>JP <span class="sy0">!=</span> <span class="kw5">None</span><span class="br0">)</span> <span class="br0">{</span>
            Fuel <span class="sy0">=</span> JP.<span class="me0">Charge</span>;
        <span class="br0">}</span>
    <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="kw1">function</span> Initialized<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw3">log</span><span class="br0">(</span><span class="kw6">self</span><span class="sy0">@</span><span class="st0">"I'm alive"</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">function</span> PostRender<span class="br0">(</span> <span class="kw8">canvas</span> <span class="kw8">Canvas</span> <span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw1">local</span> <span class="kw9">Pawn</span> VT;
    VT <span class="sy0">=</span> <span class="kw9">Pawn</span><span class="br0">(</span>ViewportOwner.<span class="kw9">Actor</span>.<span class="me0">ViewTarget</span><span class="br0">)</span>;
 
    GetFuelFromViewTarget<span class="br0">(</span><span class="br0">)</span>;
    <span class="kw8">Canvas</span>.<span class="me0">SetPos</span><span class="br0">(</span><span class="nu0">20</span>,<span class="nu0">300</span><span class="br0">)</span>;
    <span class="kw8">Canvas</span>.<span class="kw7">Style</span> <span class="sy0">=</span> <span class="nu0">1</span>;
    <span class="kw8">Canvas</span>.<span class="me0">SetDrawColor</span><span class="br0">(</span><span class="nu0">255</span>,<span class="nu0">255</span>,<span class="nu0">255</span><span class="br0">)</span>;
    <span class="kw8">Canvas</span>.<span class="me0">DrawText</span><span class="br0">(</span><span class="st0">"Fuel remaining: "</span> <span class="sy0">$</span> <span class="kw5">String</span><span class="br0">(</span>Fuel<span class="br0">)</span><span class="br0">)</span>;
<span class="br0">}</span>
 
 
<span class="co1">// Stops the magic.</span>
<span class="kw1">function</span> DieAlready<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw3">log</span><span class="br0">(</span><span class="st0">"JPI: Dying!"</span><span class="br0">)</span>;
 
    <span class="co1">// Dunno why.</span>
    bVisible<span class="sy0">=</span><span class="kw6">False</span>;
    bActive<span class="sy0">=</span><span class="kw6">False</span>;
    bNativeEvents<span class="sy0">=</span><span class="kw6">False</span>;
    bRequiresTick<span class="sy0">=</span><span class="kw6">False</span>;
 
    <span class="co1">// Remove ourself.</span>
    Master.<span class="me0">RemoveInteraction</span><span class="br0">(</span><span class="kw6">Self</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="co1">// Called when level changes.</span>
<span class="kw1">function</span> NotifyLevelChange<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
    DieAlready<span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
    bVisible<span class="sy0">=</span><span class="kw6">true</span>
    bActive<span class="sy0">=</span><span class="kw6">True</span>
<span class="br0">}</span>
</pre></div>
</div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr">
<div class="uscript source-uscript">
<pre class="de1">
<span class="co1">//=============================================================================</span>
<span class="co1">// JetPackSound.</span>
<span class="co1">//=============================================================================</span>
<span class="kw1">class</span> JetPackSound <span class="kw1">extends</span> <span class="kw9">Actor</span>;
 
<span class="kw1">replication</span> <span class="br0">{</span>
   <span class="kw1">reliable</span> <span class="kw2">if</span> <span class="br0">(</span><span class="kw7">Role</span> <span class="sy0">&lt;</span> <span class="kw7">ROLE_Authority</span><span class="br0">)</span>
      ServerSetSound;
<span class="br0">}</span>
 
<span class="kw1">function</span> ServerSetSound<span class="br0">(</span><span class="kw5">Sound</span> S<span class="br0">)</span> <span class="br0">{</span>
   <span class="kw9">AmbientSound</span><span class="sy0">=</span>S;
<span class="br0">}</span>
 
<span class="kw1">function</span> SetSound<span class="br0">(</span><span class="kw5">Sound</span> S<span class="br0">)</span> <span class="br0">{</span>
   <span class="kw9">AmbientSound</span><span class="sy0">=</span>S;
   ServerSetSound<span class="br0">(</span>S<span class="br0">)</span>;
<span class="br0">}</span>
 
 
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
   <span class="kw7">RemoteRole</span><span class="sy0">=</span><span class="kw7">ROLE_None</span>
   <span class="kw7">Physics</span><span class="sy0">=</span><span class="kw7">PHYS_Trailer</span>
   <span class="kw7">SoundVolume</span><span class="sy0">=</span><span class="nu0">200</span>
   <span class="kw7">SoundPitch</span><span class="sy0">=</span><span class="nu0">56</span>
   bAlwaysRelevant<span class="sy0">=</span><span class="kw6">true</span>
   bHidden<span class="sy0">=</span><span class="kw6">true</span>
<span class="br0">}</span>
</pre></div>
</div>
<p><a href="../Category_Legacy_Custom_Class_(UT).html" title="Category:Legacy Custom Class (UT)">Category:Legacy Custom Class (UT)</a>//<a href="../Category_Legacy_Custom_Class_(UT2004).html" title="Category:Legacy Custom Class (UT2004)">Category:Legacy Custom Class (UT2004)</a></p>
<h3><span class="mw-headline" id="Comments">Comments</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="https://wiki.beyondunreal.com/edit/Legacy:Dma/JetPack?section=1" title="Edit section: Comments">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><b>SocratesJohnson</b>: WRT ClientAdjustPosition() jerkiness, I experienced the same thing while working on my <a href="../Legacy_SocratesJohnson/Freefall.html" title="Legacy:SocratesJohnson/Freefall">Freefall</a> mutator. It seems to happen when a client explicitly tries to set the velocity of the Pawn. Try just working with Acceleration i.e. change the P.AddVelocity(Z*Strength*DeltaTime) line to adjust acceleration instead, for a start, perhaps make it decay over time. I don't have the Pawn source in front of me but just modifying P.Acceleration seemed to work in my case and that gets replicated back to the server when the physics engine does its thing. I'm pretty new to UnrealScript so your milage may vary.&#160;:D I'd love to see this in action!</p>

<!-- 
NewPP limit report
CPU time usage: 0.101 seconds
Real time usage: 0.102 seconds
Preprocessor visited node count: 32/1000000
Preprocessor generated node count: 84/1000000
Postâ€expand include size: 22/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key wiki:pcache:idhash:978-0!*!0!*!*!*!* and timestamp 20161215155541 and revision id 2642
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://wiki.beyondunreal.com/Legacy:Dma/JetPack?oldid=2642">https://wiki.beyondunreal.com/Legacy:Dma/JetPack?oldid=2642</a>"</div>
					<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="https://wiki.beyondunreal.com/Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="../Category_Legacy_Custom_Class_(UT).html" title="Category:Legacy Custom Class (UT)">Legacy Custom Class (UT)</a></li><li><a href="../Category_Legacy_Custom_Class_(UT2004).html" title="Category:Legacy Custom Class (UT2004)">Legacy Custom Class (UT2004)</a></li></ul></div></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-legacy" class="selected"><a href="JetPack.html">Legacy</a></li>
				<li id="ca-talk" class="new"><a href="https://wiki.beyondunreal.com/edit/Legacy_talk:Dma/JetPack?redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-edit"><a href="https://wiki.beyondunreal.com/edit/Legacy:Dma/JetPack" title="You can edit this page. Please use the preview button before saving [e]" accesskey="e">Edit</a></li>
				<li id="ca-history"><a href="https://wiki.beyondunreal.com/history/Legacy:Dma/JetPack" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-anonuserpage"><a href="../User_188.162.37.html" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">188.162.37.3</a></li>
													<li id="pt-anontalk"><a href="../User_talk_188.162.37.html" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li>
													<li id="pt-createaccount"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=Legacy%3ADma%2FJetPack&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="https://wiki.beyondunreal.com/Special:UserLogin?returnto=Legacy%3ADma%2FJetPack" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="../index.html" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-mainpage"><a href="../index.html" title="Visit the main page [z]" accesskey="z">Main Page</a></li>
											<li id="n-portal"><a href="../Unreal_Wiki_Community_portal-2.html" title="About the project, what you can do, where to find things">Community portal</a></li>
											<li id="n-recentchanges"><a href="https://wiki.beyondunreal.com/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="https://wiki.beyondunreal.com/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
											<li id="n-Forums-.28General.29"><a href="https://forums.beyondunreal.com/forums/wiki-general.250/" rel="nofollow">Forums (General)</a></li>
											<li id="n-Forums-.28Technical.29"><a href="https://forums.beyondunreal.com/forums/wiki-technical.251/" rel="nofollow">Forums (Technical)</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="https://wiki.beyondunreal.com/" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Unreal Wiki [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="https://wiki.beyondunreal.com/Special:WhatLinksHere/Legacy:Dma/JetPack" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="https://wiki.beyondunreal.com/Special:RecentChangesLinked/Legacy:Dma/JetPack" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="https://wiki.beyondunreal.com/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="https://wiki.beyondunreal.com/Legacy:Dma/JetPack?printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="https://wiki.beyondunreal.com/Legacy:Dma/JetPack?oldid=2642" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="https://wiki.beyondunreal.com/info/Legacy:Dma/JetPack" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="../../licensebuttons.net/l/by-nc-sa/3.0/88x31.png" alt="Attribution-Noncommercial-Share Alike 3.0" width="88" height="31" /></a>
							</div>
					<div id="f-poweredbyico">
									<script async src="../../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
        <!-- Home Page -->
        <ins class="adsbygoogle"
             style="display:inline-block;width:728px;height:90px"
             data-ad-client="ca-pub-9605963037553244"
             data-ad-slot="9528541415"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
							</div>
					<ul id="f-list">
									<li id="lastmod"> Last modified at 06:28, 19 November 2007.</li>
									<li id="copyright">Licensed as <a href="../Unreal_Wiki_Copyrights.html" title="Unreal Wiki:Copyrights">Attribution-Noncommercial-Share Alike 3.0</a>.</li>
									<li id="privacy"><a href="../Unreal_Wiki_Privacy_policy.html" title="Unreal Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="../Unreal_Wiki_About.html" title="Unreal Wiki:About">About Unreal Wiki</a></li>
									<li id="disclaimer"><a href="../Unreal_Wiki_General_disclaimer.html" title="Unreal Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>if(window.jQuery)jQuery.ready();</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://wiki.beyondunreal.com/w/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=monobook\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":93});
}</script></body>
<!-- Mirrored from wiki.beyondunreal.com/Legacy:Dma/JetPack by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 16 Dec 2016 09:41:47 GMT -->
</html>
